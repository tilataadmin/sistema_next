<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="25.06.11.19.30">
    
    <title>Manual - Indicadores - Mi Dashboard - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Tarjeta para reportar bugs */
        .bug-report-card {
            background: var(--system-secondary-color, #667eea);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        /* Botón flotante para reportar bugs */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #dc3545) !important;
            border-color: var(--system-primary-color, #dc3545) !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Estilos para el contenido del manual */
        .section-title {
            color: var(--system-primary-color, #1B365D);
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            margin-top: 2rem;
        }

        .step-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 0.75rem;
        }

        .feature-list li {
            margin-bottom: 0.5rem;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0d6efd;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .success-box {
            background: #d1e7dd;
            border-left: 4px solid #198754;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .danger-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        /* Preview de tarjeta de dashboard */
        .dashboard-card-preview {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 1.25rem;
            margin: 1rem 0;
            background: white;
        }

        .indicator-value-preview {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            margin: 1rem 0;
        }

        .sparkline-preview {
            height: 60px;
            background: linear-gradient(to right, 
                rgba(102, 126, 234, 0.1) 0%, 
                rgba(102, 126, 234, 0.3) 50%, 
                rgba(102, 126, 234, 0.1) 100%);
            border-radius: 4px;
            margin: 0.75rem 0;
            position: relative;
        }

        .sparkline-preview::after {
            content: '';
            position: absolute;
            bottom: 10px;
            left: 5%;
            right: 5%;
            height: 2px;
            background: linear-gradient(to right, 
                #667eea 0%, #667eea 20%, 
                #667eea 40%, #667eea 60%, 
                #667eea 80%, #667eea 100%);
            border-radius: 2px;
        }

        .goal-comparison-preview {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 0.75rem;
            margin-top: 0.75rem;
        }

        .formula-preview {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 4px;
            color: #6c757d;
            margin-top: 0.75rem;
        }

        .no-data-preview {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        /* Resumen stats */
        .summary-stat {
            text-align: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .summary-stat i {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .summary-stat h5 {
            margin: 0.5rem 0 0.25rem;
            font-weight: 700;
        }

        .faq-item {
            margin-bottom: 1rem;
        }

        .faq-item h6 {
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.5rem;
        }

        .tab-preview {
            display: inline-block;
            padding: 0.5rem 1rem;
            border: 1px solid #dee2e6;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            margin-right: 0.25rem;
        }

        .tab-preview.active {
            background: white;
            border-bottom: 2px solid white;
            margin-bottom: -1px;
            color: #667eea;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Indicadores
                        </h1>
                        <p class="subtitle mb-0">Mi Dashboard</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/indicators/dashboard.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-8 mx-auto">

                <!-- INFORMACIÓN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong id="display-module">Indicadores</strong></h5>
                            <p class="text-muted mb-0 small" id="display-page">Mi Dashboard</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras algún problema,<br>
                                puedes reportarlo usando el botón de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- SECCIÓN 1: ¿QUÉ ES? -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-bar-chart-line me-2"></i>
                        ¿Qué es Mi Dashboard?
                    </h2>
                    
                    <div class="step-card">
                        <p class="lead">
                            Mi Dashboard es tu <strong>panel de visualización personalizado</strong> donde 
                            puedes ver los resultados calculados de tus indicadores y el valor de tus 
                            variables independientes.
                        </p>
                        
                        <p>
                            A diferencia de las pantallas de gestión donde creas y configuras indicadores, 
                            aquí <strong>visualizas los resultados</strong>: valores calculados, comparaciones 
                            con metas, tendencias históricas y el estado general de tus métricas.
                        </p>

                        <div class="info-box">
                            <strong><i class="bi bi-info-circle me-2"></i>¿Cómo funciona?</strong>
                            <ol class="mb-0 mt-2">
                                <li>Primero configuras qué indicadores y variables quieres ver (en "Configurar Mi Dashboard")</li>
                                <li>Luego seleccionas un año académico y opcionalmente un mes</li>
                                <li>El sistema calcula automáticamente los valores y te los presenta en tarjetas visuales</li>
                            </ol>
                        </div>

                        <p>
                            Los indicadores se calculan aplicando sus fórmulas sobre los valores capturados 
                            de las variables. Si alguna variable no tiene datos, el indicador mostrará 
                            "Sin datos para calcular".
                        </p>
                    </div>
                </section>

                <!-- SECCIÓN 2: CARACTERÍSTICAS PRINCIPALES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-star me-2"></i>
                        Características principales
                    </h2>
                    
                    <div class="step-card">
                        <ul class="feature-list">
                            <li>
                                <strong>Cálculo automático:</strong> Los indicadores se calculan 
                                en tiempo real al seleccionar el período
                            </li>
                            <li>
                                <strong>Comparación con metas:</strong> Cada indicador muestra si 
                                cumple o no su meta configurada
                            </li>
                            <li>
                                <strong>Sparklines:</strong> Mini gráficos que muestran la tendencia 
                                histórica de cada elemento
                            </li>
                            <li>
                                <strong>Códigos de color:</strong> Verde si cumple la meta, rojo 
                                si no la cumple
                            </li>
                            <li>
                                <strong>Vista de tendencias:</strong> Gráficos completos con la 
                                evolución histórica de tus métricas
                            </li>
                            <li>
                                <strong>Resumen general:</strong> Panel con estadísticas globales 
                                de tu dashboard
                            </li>
                            <li>
                                <strong>Filtros flexibles:</strong> Consulta por año completo o 
                                por mes específico
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 3: ENTENDER LAS METAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-bullseye me-2"></i>
                        Cómo se evalúan las metas
                    </h2>
                    
                    <div class="step-card">
                        <p>
                            Cada indicador puede tener una meta configurada con diferentes criterios 
                            de evaluación. El dashboard evalúa automáticamente si el valor calculado 
                            cumple con la meta:
                        </p>

                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Tipo de Meta</th>
                                        <th>Criterio</th>
                                        <th>Ejemplo</th>
                                        <th>Cumple si...</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><span class="badge bg-success">↑ Mayor es mejor</span></td>
                                        <td>El valor debe superar la meta</td>
                                        <td>Tasa de aprobación ≥ 85%</td>
                                        <td>Valor ≥ Meta</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-info">↓ Menor es mejor</span></td>
                                        <td>El valor debe estar por debajo</td>
                                        <td>Deserción ≤ 5%</td>
                                        <td>Valor ≤ Meta</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-danger">⛔ No debe superar</span></td>
                                        <td>Límite máximo estricto</td>
                                        <td>Ratio estudiantes/docente ≤ 30</td>
                                        <td>Valor ≤ Límite</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-warning text-dark">⚠️ No debe bajar de</span></td>
                                        <td>Límite mínimo estricto</td>
                                        <td>Asistencia ≥ 80%</td>
                                        <td>Valor ≥ Límite</td>
                                    </tr>
                                    <tr>
                                        <td><span class="badge bg-secondary">↔️ Mantener en rango</span></td>
                                        <td>Debe estar entre min y max</td>
                                        <td>Promedio entre 75 y 90</td>
                                        <td>Min ≤ Valor ≤ Max</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="info-box">
                            <strong><i class="bi bi-info-circle me-2"></i>Indicadores visuales:</strong>
                            <ul class="mb-0 mt-2">
                                <li><i class="bi bi-check-circle-fill text-success me-1"></i> <strong>Check verde:</strong> La meta se cumple</li>
                                <li><i class="bi bi-exclamation-circle-fill text-warning me-1"></i> <strong>Exclamación amarilla:</strong> La meta no se cumple</li>
                                <li>El <strong>valor numérico</strong> también cambia de color: verde si cumple, rojo si no</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 4: ANTES DE COMENZAR -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-clipboard-check me-2"></i>
                        Antes de comenzar
                    </h2>
                    
                    <div class="step-card">
                        <h5>Requisitos previos:</h5>
                        <ul>
                            <li>Tener acceso al módulo de Indicadores</li>
                            <li>Tener el permiso "Ver mi dashboard" asignado</li>
                            <li>Haber configurado al menos un indicador o variable en tu dashboard</li>
                        </ul>

                        <h5 class="mt-4">Para ver resultados necesitas:</h5>
                        <ul>
                            <li>
                                <strong>Variables con datos capturados:</strong> Los indicadores 
                                usan los valores de las variables para calcular
                            </li>
                            <li>
                                <strong>Datos en el período seleccionado:</strong> Si seleccionas 
                                un año sin datos, verás "Sin datos"
                            </li>
                        </ul>

                        <div class="warning-box">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Ten en cuenta:</strong>
                            Si ves muchos indicadores con "Sin datos para calcular", verifica que:
                            <ul class="mb-0 mt-2">
                                <li>Las variables tengan valores capturados para el período</li>
                                <li>Hayas seleccionado el año académico correcto</li>
                                <li>Las variables manuales hayan sido digitadas</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 5: GUÍA PASO A PASO -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-list-ol me-2"></i>
                        Guía paso a paso
                    </h2>

                    <!-- Paso 1 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">1</span>
                            Seleccionar el período a consultar
                        </h4>
                        
                        <p>Al entrar, verás los filtros en la parte superior:</p>

                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Año Académico</label>
                                <select class="form-select" disabled>
                                    <option selected>2024-2025</option>
                                </select>
                                <small class="text-muted">Requerido</small>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label fw-bold">Mes (opcional)</label>
                                <select class="form-select" disabled>
                                    <option selected>Promedio anual</option>
                                </select>
                                <small class="text-muted">Para ver un mes específico</small>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <button class="btn btn-primary w-100" disabled>
                                    <i class="bi bi-arrow-clockwise me-1"></i>Actualizar Resultados
                                </button>
                            </div>
                        </div>

                        <p><strong>Opciones de filtro:</strong></p>
                        <ul>
                            <li>
                                <strong>Solo año académico:</strong> Muestra el promedio anual 
                                (para variables mensuales calcula el promedio de todos los meses)
                            </li>
                            <li>
                                <strong>Año + mes específico:</strong> Muestra los valores exactos 
                                de ese mes
                            </li>
                        </ul>

                        <div class="info-box">
                            <strong><i class="bi bi-info-circle me-2"></i>Tip:</strong>
                            El sistema selecciona automáticamente el año académico vigente al entrar.
                        </div>
                    </div>

                    <!-- Paso 2 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">2</span>
                            Entender el panel de resumen
                        </h4>
                        
                        <p>
                            Una vez que selecciones un año y hagas clic en "Actualizar Resultados", 
                            aparecerá un panel de resumen con 6 estadísticas:
                        </p>

                        <div class="row g-2 mb-3">
                            <div class="col-4 col-md-2">
                                <div class="summary-stat">
                                    <i class="bi bi-speedometer2 text-primary"></i>
                                    <h5>12</h5>
                                    <small class="text-muted">Indicadores</small>
                                </div>
                            </div>
                            <div class="col-4 col-md-2">
                                <div class="summary-stat">
                                    <i class="bi bi-graph-up text-secondary"></i>
                                    <h5>5</h5>
                                    <small class="text-muted">Variables</small>
                                </div>
                            </div>
                            <div class="col-4 col-md-2">
                                <div class="summary-stat">
                                    <i class="bi bi-check-circle text-success"></i>
                                    <h5>14</h5>
                                    <small class="text-muted">Calculados</small>
                                </div>
                            </div>
                            <div class="col-4 col-md-2">
                                <div class="summary-stat">
                                    <i class="bi bi-exclamation-triangle text-warning"></i>
                                    <h5>3</h5>
                                    <small class="text-muted">Sin Datos</small>
                                </div>
                            </div>
                            <div class="col-4 col-md-2">
                                <div class="summary-stat">
                                    <i class="bi bi-bullseye text-info"></i>
                                    <h5>8</h5>
                                    <small class="text-muted">Metas Logradas</small>
                                </div>
                            </div>
                            <div class="col-4 col-md-2">
                                <div class="summary-stat">
                                    <i class="bi bi-trophy text-warning"></i>
                                    <h5>10</h5>
                                    <small class="text-muted">Metas Totales</small>
                                </div>
                            </div>
                        </div>

                        <ul>
                            <li><strong>Indicadores:</strong> Total de indicadores en tu dashboard</li>
                            <li><strong>Variables:</strong> Total de variables independientes</li>
                            <li><strong>Calculados:</strong> Elementos que pudieron calcularse con datos disponibles</li>
                            <li><strong>Sin Datos:</strong> Elementos sin datos suficientes para calcular</li>
                            <li><strong>Metas Logradas:</strong> Indicadores que cumplen su meta</li>
                            <li><strong>Metas Totales:</strong> Indicadores que tienen meta configurada</li>
                        </ul>
                    </div>

                    <!-- Paso 3 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">3</span>
                            Interpretar las tarjetas de indicadores
                        </h4>
                        
                        <p>
                            Los indicadores se muestran en tarjetas con información visual 
                            sobre su estado:
                        </p>

                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Indicador con datos y meta cumplida:</strong></p>
                                <div class="dashboard-card-preview">
                                    <h6 class="mb-1">Tasa de Aprobación</h6>
                                    <p class="text-muted small mb-2">Porcentaje de estudiantes aprobados</p>
                                    
                                    <div class="indicator-value-preview" style="color: #198754;">
                                        87.5%
                                    </div>
                                    
                                    <div class="sparkline-preview"></div>
                                    
                                    <div class="goal-comparison-preview">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-check-circle-fill text-success me-2" style="font-size: 1.25rem;"></i>
                                            <div class="flex-grow-1">
                                                <small class="text-muted d-block">Meta mínima</small>
                                                <strong>85%</strong>
                                            </div>
                                            <span class="badge bg-success-subtle text-success">+2.9%</span>
                                        </div>
                                    </div>
                                    
                                    <div class="formula-preview">
                                        VAR_Aprobados / VAR_Total * 100
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Indicador con meta no cumplida:</strong></p>
                                <div class="dashboard-card-preview">
                                    <h6 class="mb-1">Tasa de Deserción</h6>
                                    <p class="text-muted small mb-2">Porcentaje de estudiantes retirados</p>
                                    
                                    <div class="indicator-value-preview" style="color: #dc3545;">
                                        8.2%
                                    </div>
                                    
                                    <div class="sparkline-preview"></div>
                                    
                                    <div class="goal-comparison-preview">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-exclamation-circle-fill text-warning me-2" style="font-size: 1.25rem;"></i>
                                            <div class="flex-grow-1">
                                                <small class="text-muted d-block">Meta máxima</small>
                                                <strong>5%</strong>
                                            </div>
                                            <span class="badge bg-danger-subtle text-danger">⚠️ Excede</span>
                                        </div>
                                    </div>
                                    
                                    <div class="formula-preview">
                                        VAR_Retirados / VAR_Matriculados * 100
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-box mt-3">
                            <strong><i class="bi bi-info-circle me-2"></i>Elementos de la tarjeta:</strong>
                            <ul class="mb-0 mt-2">
                                <li><strong>Título y descripción:</strong> Identifican el indicador</li>
                                <li><strong>Valor grande:</strong> Resultado del cálculo (color indica si cumple meta)</li>
                                <li><strong>Sparkline:</strong> Mini gráfico de tendencia histórica</li>
                                <li><strong>Comparación de meta:</strong> Muestra la meta y la diferencia</li>
                                <li><strong>Fórmula:</strong> La expresión matemática usada para calcular</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Paso 4 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">4</span>
                            Indicadores sin datos
                        </h4>
                        
                        <p>
                            Cuando un indicador no puede calcularse porque faltan datos de 
                            alguna variable, se muestra así:
                        </p>

                        <div class="no-data-preview">
                            <h6 class="mb-2">Eficiencia Presupuestal</h6>
                            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 2.5rem;"></i>
                            <p class="mt-2 mb-0">
                                <strong>Sin datos para calcular</strong><br>
                                <small class="text-muted">Sin datos capturados para alguna variable</small>
                            </p>
                            <div class="formula-preview mt-3" style="background: white;">
                                VAR_Ejecutado / VAR_Presupuesto * 100
                            </div>
                        </div>

                        <p class="mt-3"><strong>¿Por qué puede aparecer "Sin datos"?</strong></p>
                        <ul>
                            <li>La variable no tiene valores capturados para el período seleccionado</li>
                            <li>La variable es manual y no se ha digitado el valor</li>
                            <li>La consulta SQL de la variable no retornó resultados</li>
                            <li>El nombre de la variable en la fórmula no coincide exactamente</li>
                        </ul>
                    </div>

                    <!-- Paso 5 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">5</span>
                            Interpretar las tarjetas de variables
                        </h4>
                        
                        <p>
                            Las variables independientes se muestran en una sección separada, 
                            debajo de los indicadores:
                        </p>

                        <div class="dashboard-card-preview" style="max-width: 350px;">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="mb-0">Total Estudiantes</h6>
                                <span class="badge bg-info-subtle text-info">ANUAL</span>
                            </div>
                            <p class="text-muted small mb-2">Estudiantes matriculados en el período</p>
                            
                            <div class="indicator-value-preview" style="color: #198754;">
                                1,234
                            </div>
                            
                            <div class="sparkline-preview"></div>
                            
                            <div class="goal-comparison-preview">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-check-circle-fill text-success me-2"></i>
                                    <div class="flex-grow-1">
                                        <small class="text-muted d-block">Meta</small>
                                        <strong>1,200</strong>
                                    </div>
                                    <span class="badge bg-success-subtle text-success">+2.8%</span>
                                </div>
                            </div>
                        </div>

                        <p class="mt-3">
                            Las variables muestran el valor capturado directamente, sin cálculos. 
                            Incluyen un badge indicando si son <strong>ANUAL</strong> o <strong>MENSUAL</strong>.
                        </p>
                    </div>

                    <!-- Paso 6 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">6</span>
                            Ver tendencias históricas
                        </h4>
                        
                        <p>
                            La segunda pestaña "Tendencias" muestra gráficos más grandes con la 
                            evolución histórica de tus indicadores y variables:
                        </p>

                        <div class="mb-3" style="border-bottom: 1px solid #dee2e6; padding-bottom: 0.5rem;">
                            <span class="tab-preview">
                                <i class="bi bi-speedometer2 me-1"></i>Mis Indicadores y Variables
                            </span>
                            <span class="tab-preview active">
                                <i class="bi bi-graph-up me-1"></i>Tendencias
                            </span>
                        </div>

                        <div class="card">
                            <div class="card-body">
                                <h6>Tasa de Aprobación</h6>
                                <div style="height: 150px; background: linear-gradient(to top right, rgba(102, 126, 234, 0.1), rgba(102, 126, 234, 0.3)); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                    <span class="text-muted">
                                        <i class="bi bi-graph-up me-2"></i>
                                        Gráfico de línea con datos históricos
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="info-box mt-3">
                            <strong><i class="bi bi-info-circle me-2"></i>Nota:</strong>
                            Los gráficos de tendencias requieren al menos 3 períodos de datos 
                            históricos. Si no hay suficientes datos, verás un mensaje indicándolo.
                        </div>
                    </div>

                    <!-- Paso 7 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">7</span>
                            Modificar tu dashboard
                        </h4>
                        
                        <p>
                            Si necesitas agregar o quitar indicadores de tu dashboard:
                        </p>

                        <ol>
                            <li>Haz clic en <strong>"Configurar Dashboard"</strong> en la barra de filtros</li>
                            <li>Selecciona o deselecciona los elementos deseados</li>
                            <li>Guarda los cambios</li>
                            <li>Regresa a "Mi Dashboard" para ver los resultados actualizados</li>
                        </ol>

                        <a href="#" class="btn btn-outline-secondary" onclick="return false;">
                            <i class="bi bi-gear me-1"></i>Configurar Dashboard
                        </a>
                    </div>
                </section>

                <!-- SECCIÓN 6: SOLUCIÓN DE PROBLEMAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-question-circle me-2"></i>
                        Solución de problemas comunes
                    </h2>

                    <div class="step-card">
                        <h5>Todos mis indicadores muestran "Sin datos"</h5>
                        <ul>
                            <li>Verifica que hayas seleccionado el año académico correcto</li>
                            <li>Confirma que las variables tengan valores capturados para ese período</li>
                            <li>Si las variables son manuales, verifica que se hayan digitado los valores</li>
                            <li>Revisa que los nombres de las variables en las fórmulas coincidan exactamente</li>
                        </ul>

                        <h5 class="mt-4">El dashboard está vacío</h5>
                        <ul>
                            <li>Ve a "Configurar Dashboard" y selecciona al menos un indicador o variable</li>
                            <li>Guarda la configuración y regresa</li>
                        </ul>

                        <h5 class="mt-4">Los sparklines no se muestran</h5>
                        <ul>
                            <li>Los sparklines necesitan al menos 2 períodos de datos históricos</li>
                            <li>Si es un indicador o variable nuevo, aún no hay suficiente historial</li>
                        </ul>

                        <h5 class="mt-4">Las metas no aparecen</h5>
                        <ul>
                            <li>Las metas se configuran por año académico en la gestión de indicadores</li>
                            <li>Verifica que el indicador tenga una meta configurada para el año seleccionado</li>
                        </ul>

                        <h5 class="mt-4">El valor calculado parece incorrecto</h5>
                        <ul>
                            <li>Revisa la fórmula del indicador en la tarjeta</li>
                            <li>Verifica los valores de las variables en el período</li>
                            <li>Para variables mensuales sin mes seleccionado, se muestra el promedio</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 7: BUENAS PRÁCTICAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-check2-circle me-2"></i>
                        Buenas prácticas
                    </h2>

                    <div class="step-card">
                        <ul class="feature-list">
                            <li>
                                <strong>Revisa regularmente:</strong> Consulta tu dashboard 
                                periódicamente para detectar tendencias a tiempo
                            </li>
                            <li>
                                <strong>Configura metas realistas:</strong> Las metas deben ser 
                                alcanzables pero desafiantes
                            </li>
                            <li>
                                <strong>Mantén los datos actualizados:</strong> Asegúrate de que 
                                las variables se capturen a tiempo
                            </li>
                            <li>
                                <strong>Usa la vista de tendencias:</strong> No te quedes solo 
                                con el valor actual, revisa la evolución
                            </li>
                            <li>
                                <strong>Investiga los "Sin datos":</strong> Si un indicador no 
                                calcula, identifica qué variable falta
                            </li>
                            <li>
                                <strong>Ajusta tu selección:</strong> Si un indicador ya no es 
                                relevante, quítalo de tu dashboard
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 8: PREGUNTAS FRECUENTES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-chat-dots me-2"></i>
                        Preguntas frecuentes
                    </h2>

                    <div class="step-card">
                        <div class="faq-item">
                            <h6>¿Cada cuánto se actualizan los valores?</h6>
                            <p>
                                Los valores se calculan cada vez que haces clic en "Actualizar Resultados". 
                                No hay actualización automática, debes solicitarla manualmente.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Qué significa "Promedio anual" en el filtro de mes?</h6>
                            <p>
                                Si no seleccionas un mes específico, para las variables mensuales 
                                el sistema calcula el promedio de todos los meses con datos en ese año.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Puedo exportar los datos del dashboard?</h6>
                            <p>
                                Actualmente no hay una función de exportación directa. Puedes 
                                tomar capturas de pantalla o consultar los datos en las pantallas 
                                de gestión de variables.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Por qué el sparkline no muestra datos?</h6>
                            <p>
                                Los sparklines requieren al menos 2 períodos de datos históricos. 
                                Si el indicador o variable es nuevo, aún no hay suficiente historial.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Los demás usuarios pueden ver mi dashboard?</h6>
                            <p>
                                No, tu dashboard es personal. Cada usuario ve solo los indicadores 
                                y variables que configuró para sí mismo.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Qué pasa si cambio la fórmula de un indicador?</h6>
                            <p>
                                El dashboard calculará con la fórmula actualizada. Los valores 
                                históricos también se recalcularán con la nueva fórmula.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Puedo ver indicadores de años anteriores?</h6>
                            <p>
                                Sí, simplemente cambia el año académico en el filtro. Puedes 
                                consultar cualquier año que tenga datos capturados.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Las metas cambian según el año?</h6>
                            <p>
                                Sí, las metas se configuran por año académico. Cada año puede 
                                tener metas diferentes para el mismo indicador.
                            </p>
                        </div>
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- FIN DEL CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- TARJETA PARA REPORTAR BUGS -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../report-bug.html" class="btn btn-danger btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Indicadores',
            modulePath: 'indicators',
            pageTitle: 'Mi Dashboard',
            pagePath: 'dashboard.html',
            moduleDescription: 'Visualiza tus indicadores calculados y variables independientes'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
