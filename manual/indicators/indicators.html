<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="25.06.11.18.00">
    
    <title>Manual - Indicadores - Gestión de Indicadores - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Tarjeta para reportar bugs */
        .bug-report-card {
            background: var(--system-secondary-color, #667eea);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        /* Botón flotante para reportar bugs */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #dc3545) !important;
            border-color: var(--system-primary-color, #dc3545) !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Estilos para el contenido del manual */
        .section-title {
            color: var(--system-primary-color, #1B365D);
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            margin-top: 2rem;
        }

        .step-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 0.75rem;
        }

        .feature-list li {
            margin-bottom: 0.5rem;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0d6efd;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .success-box {
            background: #d1e7dd;
            border-left: 4px solid #198754;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .danger-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        .formula-example {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 0.75rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin: 0.5rem 0;
        }

        .variable-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-family: 'Courier New', monospace;
        }

        .goal-type-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .goal-type-table th,
        .goal-type-table td {
            border: 1px solid #dee2e6;
            padding: 0.75rem;
            text-align: left;
        }

        .goal-type-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .format-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .format-decimal { background: #e0f2fe; color: #0c4a6e; }
        .format-percentage { background: #f0fdf4; color: #166534; }
        .format-integer { background: #fef3c7; color: #92400e; }

        .faq-item {
            margin-bottom: 1rem;
        }

        .faq-item h6 {
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.5rem;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Indicadores
                        </h1>
                        <p class="subtitle mb-0">Gestión de Indicadores</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/indicators/indicators.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-8 mx-auto">

                <!-- INFORMACIÓN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong id="display-module">Indicadores</strong></h5>
                            <p class="text-muted mb-0 small" id="display-page">Gestión de Indicadores</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras algún problema,<br>
                                puedes reportarlo usando el botón de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- SECCIÓN 1: ¿QUÉ ES? -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-speedometer2 me-2"></i>
                        ¿Qué son los Indicadores?
                    </h2>
                    
                    <div class="step-card">
                        <p class="lead">
                            Los <strong>indicadores</strong> son métricas calculadas automáticamente 
                            a partir de fórmulas matemáticas que combinan variables. Son los KPIs 
                            (Key Performance Indicators) que permiten medir el desempeño institucional.
                        </p>
                        
                        <p>
                            Mientras las <strong>variables</strong> almacenan datos crudos (como "Total de 
                            estudiantes" o "Estudiantes aprobados"), los <strong>indicadores</strong> 
                            calculan métricas significativas combinando esas variables con fórmulas.
                        </p>

                        <div class="success-box">
                            <strong><i class="bi bi-lightbulb me-2"></i>Ejemplo práctico:</strong>
                            <br><br>
                            <strong>Indicador:</strong> Tasa de Aprobación<br>
                            <strong>Fórmula:</strong> 
                            <div class="formula-example">
                                (VAR_Estudiantes_Aprobados / VAR_Total_Estudiantes) * 100
                            </div>
                            <strong>Variables usadas:</strong>
                            <ul class="mb-0 mt-2">
                                <li><span class="variable-tag">VAR_Estudiantes_Aprobados</span> = 450</li>
                                <li><span class="variable-tag">VAR_Total_Estudiantes</span> = 500</li>
                            </ul>
                            <strong>Resultado:</strong> 90% (formato porcentaje)
                        </div>

                        <p>
                            El sistema calcula automáticamente el valor del indicador cuando las 
                            variables tienen datos capturados, permitiendo establecer metas y 
                            comparar el desempeño a través del tiempo.
                        </p>
                    </div>
                </section>

                <!-- SECCIÓN 2: CARACTERÍSTICAS PRINCIPALES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-star me-2"></i>
                        Características principales
                    </h2>
                    
                    <div class="step-card">
                        <ul class="feature-list">
                            <li>
                                <strong>Fórmulas matemáticas:</strong> Combina variables usando 
                                operadores (+, -, *, /) y paréntesis para crear cálculos complejos
                            </li>
                            <li>
                                <strong>Validación automática:</strong> El sistema verifica que la 
                                fórmula sea válida antes de guardar
                            </li>
                            <li>
                                <strong>Formatos de resultado:</strong> Decimal (85.5), Porcentaje (85.5%), 
                                o Entero (86)
                            </li>
                            <li>
                                <strong>Metas por año:</strong> Define objetivos específicos para cada 
                                año académico con diferentes criterios de evaluación
                            </li>
                            <li>
                                <strong>Categorización:</strong> Organiza indicadores en categorías 
                                para mejor navegación
                            </li>
                            <li>
                                <strong>Estados:</strong> Activo, Inactivo o En Pruebas para controlar 
                                qué indicadores están operativos
                            </li>
                            <li>
                                <strong>Propiedad:</strong> Cada indicador tiene un propietario que 
                                es el único que puede editarlo
                            </li>
                        </ul>

                        <h5 class="mt-4">Formatos de resultado disponibles:</h5>
                        <ul>
                            <li>
                                <span class="format-badge format-decimal">DECIMAL</span> 
                                - Números con decimales (ej: 85.5, 92.75)
                            </li>
                            <li>
                                <span class="format-badge format-percentage">PERCENTAGE</span> 
                                - Valores porcentuales (ej: 85.5%, 92.75%)
                            </li>
                            <li>
                                <span class="format-badge format-integer">INTEGER</span> 
                                - Números enteros redondeados (ej: 86, 93)
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 3: TIPOS DE METAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-bullseye me-2"></i>
                        Tipos de Metas
                    </h2>
                    
                    <div class="step-card">
                        <p>
                            Las metas definen los objetivos que deseas alcanzar con cada indicador. 
                            Existen <strong>cinco tipos</strong> de meta según cómo se evalúa el cumplimiento:
                        </p>

                        <table class="goal-type-table">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">Tipo</th>
                                    <th style="width: 35%;">Descripción</th>
                                    <th style="width: 40%;">Ejemplo</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>↑ Mayor es mejor</strong></td>
                                    <td>El valor debe superar la meta para considerarse exitoso</td>
                                    <td>Tasa de aprobación ≥ 85%<br><small class="text-muted">Si el resultado es 87%, se cumple la meta</small></td>
                                </tr>
                                <tr>
                                    <td><strong>↓ Menor es mejor</strong></td>
                                    <td>El valor debe estar por debajo de la meta</td>
                                    <td>Tasa de deserción ≤ 5%<br><small class="text-muted">Si el resultado es 3%, se cumple la meta</small></td>
                                </tr>
                                <tr>
                                    <td><strong>⛔ No debe superar</strong></td>
                                    <td>Establece un límite máximo que no debe excederse</td>
                                    <td>Ratio estudiantes/docente ≤ 30<br><small class="text-muted">Alerta si supera 30</small></td>
                                </tr>
                                <tr>
                                    <td><strong>⚠️ No debe bajar de</strong></td>
                                    <td>Establece un límite mínimo que debe mantenerse</td>
                                    <td>Asistencia ≥ 80%<br><small class="text-muted">Alerta si baja de 80%</small></td>
                                </tr>
                                <tr>
                                    <td><strong>↔️ Mantener en rango</strong></td>
                                    <td>El valor debe estar dentro de un rango específico</td>
                                    <td>Promedio entre 75 y 90<br><small class="text-muted">Alerta si sale del rango</small></td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="info-box">
                            <strong><i class="bi bi-info-circle me-2"></i>¿Por qué diferentes tipos?</strong>
                            <p class="mb-0">
                                No todos los indicadores se evalúan igual. Para una "Tasa de Aprobación" 
                                queremos que sea lo más alta posible, pero para "Tasa de Deserción" 
                                queremos que sea lo más baja posible. Los tipos de meta permiten 
                                configurar correctamente cómo se mide el éxito de cada indicador.
                            </p>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 4: ANTES DE COMENZAR -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-clipboard-check me-2"></i>
                        Antes de comenzar
                    </h2>
                    
                    <div class="step-card">
                        <h5>Requisitos previos:</h5>
                        <ul>
                            <li>Tener acceso al módulo de Indicadores</li>
                            <li>Tener el permiso "Indicadores" asignado</li>
                            <li>
                                <strong>Importante:</strong> Deben existir variables activas en el sistema 
                                para poder crear indicadores
                            </li>
                        </ul>

                        <h5 class="mt-4">Planificación recomendada:</h5>
                        <p>Antes de crear un indicador, define:</p>
                        <ul>
                            <li>¿Qué métrica quieres calcular?</li>
                            <li>¿Qué variables necesitas para el cálculo?</li>
                            <li>¿Cuál es la fórmula matemática?</li>
                            <li>¿En qué formato debe mostrarse el resultado?</li>
                            <li>¿Cuál es la meta para cada año académico?</li>
                            <li>¿Cómo se evalúa el éxito (mayor es mejor, menor es mejor, etc.)?</li>
                        </ul>

                        <div class="warning-box">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Importante:</strong>
                            Asegúrate de que las variables que necesitas ya existan y estén activas 
                            antes de crear el indicador. Si una variable no existe, primero debes 
                            crearla en el módulo de Variables.
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 5: GUÍA PASO A PASO -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-list-ol me-2"></i>
                        Guía paso a paso
                    </h2>

                    <!-- Paso 1 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">1</span>
                            Entender el panel de indicadores
                        </h4>
                        
                        <p>Al ingresar a la pantalla de Gestión de Indicadores, encontrarás:</p>

                        <ul>
                            <li>
                                <strong>Barra de controles:</strong> Botones "Actualizar" y "Nuevo Indicador"
                            </li>
                            <li>
                                <strong>Filtros:</strong> Búsqueda por texto, propietario, estado y categoría
                            </li>
                            <li>
                                <strong>Tarjetas de indicadores:</strong> Cada indicador muestra su nombre, 
                                estado, formato, fórmula, propietario y categorías
                            </li>
                            <li>
                                <strong>Panel de estadísticas:</strong> Total de indicadores, activos, 
                                metas configuradas y con benchmarks
                            </li>
                        </ul>

                        <p><strong>Identificación visual de las tarjetas:</strong></p>
                        <ul>
                            <li>
                                <strong>Badge de estado:</strong> Verde (Activo), Amarillo (En Pruebas), 
                                Gris (Inactivo)
                            </li>
                            <li>
                                <strong>Badge de formato:</strong> Indica si el resultado es decimal, 
                                porcentaje o entero
                            </li>
                            <li>
                                <strong>Fórmula:</strong> Se muestra en un recuadro gris con formato monoespaciado
                            </li>
                            <li>
                                <strong>Categorías:</strong> Badges de colores debajo de la fórmula
                            </li>
                        </ul>

                        <div class="info-box">
                            <strong><i class="bi bi-info-circle me-2"></i>Permisos de edición:</strong>
                            Solo verás los botones de edición, metas y cambio de estado en los 
                            indicadores que tú creaste. Para los demás indicadores, solo podrás 
                            ver los detalles en modo lectura.
                        </div>
                    </div>

                    <!-- Paso 2 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">2</span>
                            Crear un indicador básico
                        </h4>
                        
                        <p>Para crear tu primer indicador:</p>

                        <ol>
                            <li>Haz clic en el botón <strong>"Nuevo Indicador"</strong></li>
                            <li>
                                <strong>Información básica:</strong>
                                <ul>
                                    <li>Escribe un <strong>nombre</strong> descriptivo</li>
                                    <li>Agrega una <strong>descripción</strong> que explique qué mide</li>
                                    <li>Selecciona el <strong>formato del resultado</strong></li>
                                    <li>Deja el estado en <strong>"Activo"</strong> (o "En Pruebas" si quieres probarlo primero)</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Categorías:</strong> Selecciona una o más categorías para organizar el indicador
                            </li>
                            <li>
                                <strong>Fórmula:</strong> Escribe la expresión matemática (ver siguiente paso)
                            </li>
                            <li>Haz clic en <strong>"Crear Indicador"</strong></li>
                        </ol>

                        <div class="success-box">
                            <strong><i class="bi bi-lightbulb me-2"></i>Ejemplo de indicador básico:</strong>
                            <br><br>
                            <strong>Nombre:</strong> Promedio de Estudiantes por Docente<br>
                            <strong>Descripción:</strong> Relación entre el total de estudiantes y el número de docentes<br>
                            <strong>Formato:</strong> Decimal<br>
                            <strong>Fórmula:</strong>
                            <div class="formula-example">
                                VAR_Total_Estudiantes / VAR_Total_Docentes
                            </div>
                        </div>
                    </div>

                    <!-- Paso 3 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">3</span>
                            Construir la fórmula matemática
                        </h4>
                        
                        <p>La fórmula es el corazón del indicador. Define cómo se calcula el valor.</p>

                        <p><strong>Operadores permitidos:</strong></p>
                        <ul>
                            <li><code>+</code> Suma</li>
                            <li><code>-</code> Resta</li>
                            <li><code>*</code> Multiplicación</li>
                            <li><code>/</code> División</li>
                            <li><code>( )</code> Paréntesis para agrupar operaciones</li>
                        </ul>

                        <p><strong>Para insertar variables:</strong></p>
                        <ol>
                            <li>Debajo del campo de fórmula verás las <strong>variables disponibles</strong></li>
                            <li>Puedes filtrar las variables por categoría usando el selector</li>
                            <li>Haz clic en una variable para insertarla en la posición del cursor</li>
                            <li>Las variables tienen el formato: <span class="variable-tag">VAR_Nombre_Variable</span></li>
                        </ol>

                        <p><strong>Ejemplos de fórmulas:</strong></p>
                        
                        <p><em>Fórmula simple (división):</em></p>
                        <div class="formula-example">
                            VAR_Presupuesto_Ejecutado / VAR_Presupuesto_Total * 100
                        </div>

                        <p><em>Fórmula con paréntesis:</em></p>
                        <div class="formula-example">
                            (VAR_Estudiantes_Aprobados + VAR_Estudiantes_Condicionales) / VAR_Total_Estudiantes * 100
                        </div>

                        <p><em>Fórmula compuesta:</em></p>
                        <div class="formula-example">
                            (VAR_Ingresos - VAR_Gastos) / VAR_Ingresos * 100
                        </div>

                        <div class="warning-box">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Validación obligatoria:</strong>
                            Siempre haz clic en <strong>"Validar Fórmula"</strong> antes de guardar. 
                            El sistema verificará que:
                            <ul class="mb-0 mt-2">
                                <li>La fórmula contenga al menos una variable</li>
                                <li>Todas las variables referenciadas existan en el sistema</li>
                                <li>No haya caracteres inválidos</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Paso 4 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">4</span>
                            Configurar metas por año académico
                        </h4>
                        
                        <p>Las metas definen los objetivos que quieres alcanzar con el indicador.</p>

                        <p><strong>Para agregar una meta:</strong></p>
                        <ol>
                            <li>En la sección "Metas por Año Académico", haz clic en <strong>"Agregar Meta"</strong></li>
                            <li>Selecciona el <strong>año académico</strong></li>
                            <li>
                                Selecciona el <strong>tipo de meta</strong>:
                                <ul>
                                    <li>↑ Mayor es mejor</li>
                                    <li>↓ Menor es mejor</li>
                                    <li>⛔ No debe superar</li>
                                    <li>⚠️ No debe bajar de</li>
                                    <li>↔️ Mantener en rango</li>
                                </ul>
                            </li>
                            <li>
                                Ingresa el <strong>valor meta</strong> 
                                (si es tipo "rango", también ingresa el valor máximo)
                            </li>
                            <li>Opcionalmente, agrega una <strong>descripción</strong> explicativa</li>
                        </ol>

                        <p>Puedes agregar múltiples metas para diferentes años académicos.</p>

                        <div class="info-box">
                            <strong><i class="bi bi-info-circle me-2"></i>Tip:</strong>
                            La etiqueta del campo de valor cambia según el tipo de meta seleccionado 
                            para ayudarte a entender qué valor debes ingresar.
                        </div>
                    </div>

                    <!-- Paso 5 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">5</span>
                            Asignar categorías
                        </h4>
                        
                        <p>Las categorías ayudan a organizar y filtrar los indicadores.</p>

                        <p><strong>Para asignar categorías:</strong></p>
                        <ol>
                            <li>En la sección "Categorías", verás una lista con checkboxes</li>
                            <li>Cada categoría muestra su ícono y color</li>
                            <li>Marca las categorías que apliquen a tu indicador</li>
                            <li>Puedes seleccionar múltiples categorías</li>
                        </ol>

                        <p>
                            Las categorías son las mismas que se usan en el módulo de Tareas, 
                            lo que permite una organización consistente en todo el sistema.
                        </p>
                    </div>

                    <!-- Paso 6 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">6</span>
                            Buscar y filtrar indicadores
                        </h4>
                        
                        <p>Cuando tengas muchos indicadores, puedes encontrar rápidamente el que necesitas:</p>

                        <ul>
                            <li>
                                <strong>Búsqueda por texto:</strong> Escribe parte del nombre o descripción
                            </li>
                            <li>
                                <strong>Filtro por propietario:</strong> Ve solo tus indicadores o los de 
                                un usuario específico
                            </li>
                            <li>
                                <strong>Filtro por estado:</strong> Activos, Inactivos o En Pruebas
                            </li>
                            <li>
                                <strong>Filtro por categoría:</strong> Muestra solo indicadores de una 
                                categoría específica
                            </li>
                        </ul>

                        <p>
                            <strong>Nota:</strong> Por defecto, al cargar la página se filtran los 
                            indicadores para mostrar solo los tuyos.
                        </p>
                    </div>

                    <!-- Paso 7 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">7</span>
                            Editar un indicador
                        </h4>
                        
                        <p>Solo puedes editar los indicadores que tú creaste.</p>

                        <p><strong>Para editar un indicador:</strong></p>
                        <ol>
                            <li>Localiza el indicador (debe mostrar los botones de acción)</li>
                            <li>Haz clic en el botón <strong>lápiz</strong> <i class="bi bi-pencil"></i></li>
                            <li>Se abrirá el formulario con todos los datos actuales</li>
                            <li>Modifica los campos necesarios</li>
                            <li>Si modificas la fórmula, recuerda validarla</li>
                            <li>Haz clic en <strong>"Actualizar Indicador"</strong></li>
                        </ol>

                        <p><strong>Para gestionar metas:</strong></p>
                        <ol>
                            <li>Haz clic en el botón <strong>diana</strong> <i class="bi bi-bullseye"></i></li>
                            <li>Se abrirá el formulario de edición enfocado en las metas</li>
                            <li>Agrega, modifica o elimina metas según necesites</li>
                            <li>Guarda los cambios</li>
                        </ol>
                    </div>

                    <!-- Paso 8 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">8</span>
                            Ver detalles de indicadores de otros usuarios
                        </h4>
                        
                        <p>
                            Para indicadores que no son tuyos, puedes ver toda la información 
                            pero no editarla.
                        </p>

                        <p><strong>Para ver detalles:</strong></p>
                        <ol>
                            <li>Haz clic en el botón <strong>"Ver"</strong> <i class="bi bi-eye"></i></li>
                            <li>
                                Se mostrará un panel con:
                                <ul>
                                    <li>Nombre y descripción completa</li>
                                    <li>Propietario del indicador</li>
                                    <li>Estado actual</li>
                                    <li>Formato del resultado</li>
                                    <li>Fórmula matemática</li>
                                    <li>Categorías asignadas</li>
                                    <li>Metas configuradas con sus tipos y valores</li>
                                </ul>
                            </li>
                            <li>Cierra el panel con la X en la esquina</li>
                        </ol>
                    </div>

                    <!-- Paso 9 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">9</span>
                            Cambiar estado de un indicador
                        </h4>
                        
                        <p>Solo puedes cambiar el estado de tus propios indicadores.</p>

                        <p><strong>Estados disponibles:</strong></p>
                        <ul>
                            <li>
                                <strong>Activo:</strong> El indicador está operativo y se mostrará 
                                en reportes y dashboards
                            </li>
                            <li>
                                <strong>En Pruebas:</strong> El indicador existe pero aún no está 
                                listo para producción
                            </li>
                            <li>
                                <strong>Inactivo:</strong> El indicador está deshabilitado
                            </li>
                        </ul>

                        <p><strong>Para cambiar el estado:</strong></p>
                        <ol>
                            <li>
                                Haz clic en el botón <strong>pausa/play</strong> 
                                <i class="bi bi-pause"></i>/<i class="bi bi-play"></i>
                            </li>
                            <li>Confirma la acción</li>
                            <li>El indicador cambiará entre Activo e Inactivo</li>
                        </ol>

                        <div class="info-box">
                            <strong><i class="bi bi-info-circle me-2"></i>Tip:</strong>
                            Si necesitas cambiar a "En Pruebas", usa el botón de edición y 
                            cambia el estado desde el formulario.
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 6: SOLUCIÓN DE PROBLEMAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-question-circle me-2"></i>
                        Solución de problemas comunes
                    </h2>

                    <div class="step-card">
                        <h5>La validación de fórmula falla</h5>
                        <ul>
                            <li>Verifica que todas las variables existan y estén activas</li>
                            <li>Asegúrate de escribir correctamente el nombre: <code>VAR_Nombre_Con_Guiones_Bajos</code></li>
                            <li>No uses caracteres especiales fuera de los operadores permitidos</li>
                            <li>Verifica que los paréntesis estén balanceados</li>
                        </ul>

                        <h5 class="mt-4">No veo los botones de edición</h5>
                        <ul>
                            <li>Solo puedes editar indicadores que tú creaste</li>
                            <li>Si necesitas modificar un indicador de otro usuario, contacta al propietario</li>
                            <li>Verifica que tienes los permisos correctos asignados</li>
                        </ul>

                        <h5 class="mt-4">No encuentro una variable</h5>
                        <ul>
                            <li>La variable podría estar inactiva (solo se muestran variables activas)</li>
                            <li>Usa el filtro de categorías para reducir la lista</li>
                            <li>Verifica que la variable exista en el módulo de Variables</li>
                        </ul>

                        <h5 class="mt-4">El indicador no calcula correctamente</h5>
                        <ul>
                            <li>Revisa que la fórmula sea matemáticamente correcta</li>
                            <li>Verifica que las variables tengan datos capturados</li>
                            <li>Asegúrate de que el orden de operaciones sea correcto (usa paréntesis)</li>
                            <li>Revisa que el formato de resultado sea el apropiado</li>
                        </ul>

                        <h5 class="mt-4">No puedo agregar metas</h5>
                        <ul>
                            <li>Deben existir años académicos configurados en el sistema</li>
                            <li>Si no hay años académicos, contacta al administrador</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 7: BUENAS PRÁCTICAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-check2-circle me-2"></i>
                        Buenas prácticas
                    </h2>

                    <div class="step-card">
                        <ul class="feature-list">
                            <li>
                                <strong>Nombres descriptivos:</strong> 
                                "Tasa de Aprobación Estudiantil" es mejor que "Indicador 1"
                            </li>
                            <li>
                                <strong>Descripciones completas:</strong> 
                                Explica qué mide el indicador, cómo se interpreta y por qué es importante
                            </li>
                            <li>
                                <strong>Valida siempre la fórmula:</strong> 
                                Antes de guardar, usa el botón de validación para evitar errores
                            </li>
                            <li>
                                <strong>Usa el estado "En Pruebas":</strong> 
                                Para nuevos indicadores que aún no están validados completamente
                            </li>
                            <li>
                                <strong>Define metas realistas:</strong> 
                                Basadas en datos históricos y objetivos institucionales
                            </li>
                            <li>
                                <strong>Elige el tipo de meta correcto:</strong> 
                                No todos los indicadores son "mayor es mejor"
                            </li>
                            <li>
                                <strong>Categoriza consistentemente:</strong> 
                                Usa las mismas categorías que en otros módulos para facilitar la navegación
                            </li>
                            <li>
                                <strong>Documenta las fórmulas complejas:</strong> 
                                En la descripción, explica cómo se calcula y qué significa cada variable
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 8: PREGUNTAS FRECUENTES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-chat-dots me-2"></i>
                        Preguntas frecuentes
                    </h2>

                    <div class="step-card">
                        <div class="faq-item">
                            <h6>¿Puedo usar la misma variable en varios indicadores?</h6>
                            <p>
                                Sí, una variable puede ser utilizada por múltiples indicadores. 
                                Por ejemplo, "Total de Estudiantes" puede usarse tanto en "Tasa de Aprobación" 
                                como en "Estudiantes por Docente".
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Qué pasa si una variable no tiene datos?</h6>
                            <p>
                                El indicador no podrá calcularse si alguna de sus variables no tiene 
                                datos capturados para el período seleccionado. El sistema mostrará 
                                un mensaje indicando qué datos faltan.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Puedo tener múltiples metas para el mismo año?</h6>
                            <p>
                                No, solo puedes tener una meta por año académico para cada indicador. 
                                Si necesitas modificar la meta de un año, edita la existente.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Qué diferencia hay entre "En Pruebas" e "Inactivo"?</h6>
                            <p>
                                "En Pruebas" indica que el indicador está siendo configurado o validado, 
                                pero eventualmente se activará. "Inactivo" indica que el indicador ya 
                                no se usa o está temporalmente deshabilitado.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Puedo eliminar un indicador?</h6>
                            <p>
                                Actualmente, los indicadores solo pueden desactivarse, no eliminarse 
                                permanentemente. Esto preserva el historial y las configuraciones 
                                en caso de que se necesiten reactivar.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Cómo sé si mi fórmula es correcta matemáticamente?</h6>
                            <p>
                                El validador verifica la sintaxis y que las variables existan, pero 
                                no valida la lógica matemática. Asegúrate de que tu fórmula tenga 
                                sentido conceptual antes de guardar.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Puedo ver indicadores de otros usuarios?</h6>
                            <p>
                                Sí, puedes ver los detalles de cualquier indicador usando el botón "Ver". 
                                Sin embargo, solo puedes editar los indicadores que tú creaste.
                            </p>
                        </div>

                        <div class="faq-item">
                            <h6>¿Qué son los "Benchmarks" en las estadísticas?</h6>
                            <p>
                                Los benchmarks son valores de referencia externos (como promedios 
                                nacionales o estándares de la industria) que permiten comparar 
                                el desempeño del indicador con otras instituciones.
                            </p>
                        </div>
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- FIN DEL CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- TARJETA PARA REPORTAR BUGS -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../report-bug.html" class="btn btn-danger btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Indicadores',
            modulePath: 'indicators',
            pageTitle: 'Gestión de Indicadores',
            pagePath: 'indicators.html',
            moduleDescription: 'Crea y administra indicadores calculados automáticamente con fórmulas'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
