<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="25.11.08.15.00">
    
    <title>Manual - Seguimientos - Gestionar Asuntos No Escalados - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Tarjeta para reportar bugs */
        .bug-report-card {
            background: var(--system-secondary-color, #667eea);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        /* Botón flotante para reportar bugs */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #dc3545) !important;
            border-color: var(--system-primary-color, #dc3545) !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Estilos específicos para el manual */
        .section-title {
            color: var(--system-primary-color, #1B365D);
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding-bottom: 0.5rem;
            margin-top: 2rem;
            margin-bottom: 1.5rem;
        }

        .step-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 1rem;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #0dcaf0;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .success-box {
            background: #d1e7dd;
            border-left: 4px solid #198754;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .danger-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .feature-list {
            list-style: none;
            padding-left: 0;
        }

        .feature-list li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .feature-list li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #198754;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .keyboard-shortcut {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9rem;
        }

        .table-example {
            font-size: 0.9rem;
            margin: 1rem 0;
        }

        .code-inline {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
            color: #d63384;
        }

        .btn-example {
            display: inline-block;
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 4px;
            margin: 2px;
        }

        .btn-close-example {
            background-color: #dc3545;
            color: white;
            border: 1px solid #dc3545;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Seguimientos
                        </h1>
                        <p class="subtitle mb-0">Gestionar y cerrar asuntos no escalados</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/follow-ups/manage-unescalated-issues.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-10 mx-auto">

                <!-- INFORMACIÓN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong>Seguimientos</strong></h5>
                            <p class="text-muted mb-0 small">Gestionar Asuntos No Escalados</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras algún problema,<br>
                                puedes reportarlo usando el botón de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- CONTENIDO DEL MANUAL -->

                <!-- Descripción General -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-info-circle me-2"></i>
                        ¿Qué es Gestionar Asuntos No Escalados?
                    </h2>
                    
                    <div class="step-card">
                        <p class="lead">
                            Esta función permite a los <strong>directores de curso</strong> gestionar y cerrar 
                            definitivamente los asuntos individuales clasificados como <strong>"No Escalables"</strong> 
                            de los estudiantes de sus cursos asignados.
                        </p>
                        
                        <p>
                            Los asuntos no escalados son situaciones que han sido evaluadas como puntuales o 
                            menores, que pueden ser completamente manejadas y resueltas a nivel del curso sin 
                            necesidad de intervención de coordinación o niveles superiores de dirección.
                        </p>

                        <div class="info-box">
                            <strong><i class="bi bi-lightbulb me-2"></i>Propósito principal:</strong>
                            Permitir que los directores de curso cierren el ciclo de gestión de asuntos menores, 
                            manteniendo un historial completo pero sacándolos de las vistas activas una vez 
                            han sido adecuadamente atendidos y resueltos.
                        </div>

                        <div class="danger-box">
                            <strong><i class="bi bi-exclamation-octagon me-2"></i>Acción irreversible:</strong>
                            El cierre de un asunto es <strong>definitivo y permanente</strong>. Una vez cerrado, 
                            el registro queda como parte del historial del estudiante pero NO puede reabrirse 
                            ni modificarse. Esta es una decisión de diseño intencional para mantener integridad 
                            en los registros históricos.
                        </div>

                        <div class="warning-box">
                            <strong><i class="bi bi-shield-exclamation me-2"></i>Acceso restringido:</strong>
                            Esta función está disponible únicamente para usuarios con el permiso 
                            <span class="code-inline">"Gestionar asuntos no escalados"</span>. 
                            Generalmente son directores de curso o coordinadores académicos.
                        </div>
                    </div>
                </section>

                <!-- Diferencia con otras funciones -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-diagram-3 me-2"></i>
                        Relación con otras funciones de seguimientos
                    </h2>
                    
                    <div class="step-card">
                        <p>
                            La gestión de asuntos en SchoolNet se divide en varias funciones especializadas. 
                            Es importante entender cuándo usar cada una:
                        </p>

                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h5 class="text-success">
                                    <i class="bi bi-shield-check me-2"></i>
                                    Gestionar Asuntos No Escalados (ESTA FUNCIÓN)
                                </h5>
                                <p><strong>Propósito:</strong> Cerrar asuntos menores ya resueltos</p>
                                <p><strong>Filtro:</strong></p>
                                <ul>
                                    <li><span class="code-inline">is_escalable = 'NO'</span></li>
                                    <li><span class="code-inline">is_open = 'SI'</span></li>
                                    <li>Estudiantes de tus cursos</li>
                                </ul>
                                <p><strong>Acciones disponibles:</strong></p>
                                <ul>
                                    <li>Cerrar el asunto (marca <span class="code-inline">is_open = 'NO'</span>)</li>
                                </ul>
                                <p><strong>Cuándo usar:</strong></p>
                                <ul>
                                    <li>Asunto puntual ya fue atendido a nivel del curso</li>
                                    <li>No requiere más seguimiento</li>
                                    <li>Quieres sacarlo de la vista activa</li>
                                </ul>
                            </div>

                            <div class="col-md-6">
                                <h5 class="text-primary">
                                    <i class="bi bi-clipboard-check me-2"></i>
                                    Revisar Asuntos Individuales
                                </h5>
                                <p><strong>Propósito:</strong> Clasificar si un asunto es escalable o no</p>
                                <p><strong>Filtro:</strong></p>
                                <ul>
                                    <li><span class="code-inline">is_open = 'SI'</span></li>
                                    <li>Estudiantes de tus cursos</li>
                                    <li>Todos los asuntos (escalables y no escalables)</li>
                                </ul>
                                <p><strong>Acciones disponibles:</strong></p>
                                <ul>
                                    <li>Cambiar <span class="code-inline">is_escalable</span> entre SI/NO</li>
                                </ul>
                                <p><strong>Cuándo usar:</strong></p>
                                <ul>
                                    <li>Acabas de recibir un nuevo reporte</li>
                                    <li>Necesitas evaluar gravedad</li>
                                    <li>Decides si escalar o no</li>
                                </ul>
                            </div>
                        </div>

                        <div class="info-box mt-3">
                            <strong><i class="bi bi-info-circle me-2"></i>Flujo completo típico:</strong>
                            <ol class="mb-0 mt-2">
                                <li><strong>Registro:</strong> Docente crea asunto individual</li>
                                <li><strong>Clasificación:</strong> Director usa "Revisar Asuntos" para marcarlo como escalable SI/NO</li>
                                <li><strong>Gestión:</strong>
                                    <ul>
                                        <li>Si es escalable → Coordinación usa "Gestionar Asuntos Escalables" (otra función)</li>
                                        <li>Si es NO escalable → Director usa "Gestionar Asuntos No Escalados" (ESTA FUNCIÓN)</li>
                                    </ul>
                                </li>
                                <li><strong>Cierre:</strong> El asunto se cierra y queda en historial</li>
                            </ol>
                        </div>
                    </div>
                </section>

                <!-- Características principales -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-star me-2"></i>
                        Características principales
                    </h2>
                    
                    <div class="step-card">
                        <ul class="feature-list">
                            <li><strong>Vista filtrada automática:</strong> Solo muestra asuntos NO escalables de tus cursos</li>
                            <li><strong>Fotografías de estudiantes:</strong> Visualización rápida para identificación</li>
                            <li><strong>Tabla simplificada:</strong> Información esencial sin acciones complejas</li>
                            <li><strong>Cierre con confirmación:</strong> Modal de advertencia antes de cerrar definitivamente</li>
                            <li><strong>Información contextual:</strong> Reportante, fecha y descripción visible</li>
                            <li><strong>Contador en tiempo real:</strong> Muestra cantidad de asuntos pendientes de cierre</li>
                            <li><strong>Función refrescar:</strong> Actualización de datos sin recargar página</li>
                            <li><strong>Protección contra duplicados:</strong> Previene cierres múltiples accidentales</li>
                            <li><strong>Actualización automática:</strong> Al cerrar, el asunto desaparece inmediatamente de la lista</li>
                            <li><strong>Sin edición de contenido:</strong> Esta función no permite editar descripciones (decisión de diseño)</li>
                            <li><strong>Responsive design:</strong> Adaptación a dispositivos móviles y tablets</li>
                            <li><strong>Descripciones con scroll:</strong> Visualización completa de textos largos</li>
                        </ul>

                        <div class="warning-box mt-3">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Funcionalidad simplificada intencionalmente:</strong>
                            Esta función se enfoca <strong>exclusivamente en cerrar</strong> asuntos no escalados. 
                            No permite:
                            <ul class="mb-0 mt-2">
                                <li>Editar la descripción del asunto</li>
                                <li>Agregar conclusiones o estrategias</li>
                                <li>Cambiar categorías</li>
                                <li>Cambiar el estado escalable</li>
                            </ul>
                            <p class="mb-0 mt-2">
                                <em>Esto es intencional: los asuntos no escalables son menores y no requieren 
                                documentación adicional. Si un asunto resulta más complejo, debe reclasificarse 
                                como escalable desde "Revisar Asuntos Individuales".</em>
                            </p>
                        </div>
                    </div>
                </section>

                <!-- Antes de comenzar -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-clipboard-check me-2"></i>
                        Antes de comenzar
                    </h2>
                    
                    <div class="step-card">
                        <h5>Requisitos previos:</h5>
                        <ul>
                            <li>Tener permisos para "Gestionar asuntos no escalados"</li>
                            <li>Estar asignado como director de al menos un curso</li>
                            <li>Conocer los protocolos institucionales sobre cierre de asuntos</li>
                            <li>Haber revisado y atendido adecuadamente cada asunto antes de cerrarlo</li>
                        </ul>

                        <div class="danger-box">
                            <strong><i class="bi bi-exclamation-octagon me-2"></i>Advertencia crítica sobre el cierre:</strong>
                            <ul class="mb-0 mt-2">
                                <li><strong>El cierre es PERMANENTE e IRREVERSIBLE</strong></li>
                                <li>No existe función de "reabrir" asuntos cerrados</li>
                                <li>Una vez cerrado, el registro queda en historial pero fuera de vistas activas</li>
                                <li>Asegúrate de que el asunto ha sido completamente atendido</li>
                                <li>Verifica que no requiere más seguimiento</li>
                                <li>Confirma que no necesita ser escalado antes de cerrar</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <strong><i class="bi bi-info-circle me-2"></i>Sobre los asuntos mostrados:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Solo verás asuntos de estudiantes de cursos donde eres director</li>
                                <li>Solo asuntos marcados como <span class="code-inline">is_escalable = 'NO'</span></li>
                                <li>Solo asuntos con estado <span class="code-inline">is_open = 'SI'</span></li>
                                <li>Se muestran hasta 150 registros más recientes</li>
                                <li>Los registros están ordenados por fecha descendente</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Evaluación antes del cierre:</strong>
                            Antes de cerrar un asunto, verifica:
                            <ul class="mb-0 mt-2">
                                <li>¿Se atendió adecuadamente la situación?</li>
                                <li>¿Se comunicó con los involucrados (estudiante, familia, reportante)?</li>
                                <li>¿Quedaron acciones pendientes que requieran seguimiento?</li>
                                <li>¿La situación realmente es menor o podría escalar?</li>
                                <li>¿Hay registro suficiente del manejo dado?</li>
                            </ul>
                        </div>

                        <div class="success-box">
                            <strong><i class="bi bi-lightbulb me-2"></i>Buenas prácticas:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Habla con el estudiante antes de cerrar el asunto</li>
                                <li>Comunica al reportante que el asunto fue atendido</li>
                                <li>Documenta en el observador del estudiante si es pertinente</li>
                                <li>Si tienes dudas sobre cerrar, consulta con coordinación</li>
                                <li>Revisa periódicamente para no acumular asuntos sin cerrar</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Paso a paso -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-list-ol me-2"></i>
                        Guía paso a paso
                    </h2>

                    <!-- Paso 1 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">1</span>
                            Acceder al módulo y visualizar asuntos
                        </h4>
                        
                        <p>
                            Al ingresar a la página, el sistema carga automáticamente todos los asuntos 
                            no escalados abiertos de tus cursos asignados.
                        </p>

                        <p><strong>Durante la carga inicial verás:</strong></p>
                        <ul>
                            <li>Una pantalla de carga con mensaje "Cargando asuntos no escalados..."</li>
                            <li>El sistema consulta la base de datos filtrando por:
                                <ul>
                                    <li>Tu correo como director de curso</li>
                                    <li><span class="code-inline">is_escalable = 'NO'</span></li>
                                    <li><span class="code-inline">is_open = 'SI'</span></li>
                                </ul>
                            </li>
                            <li>Se cargan las fotografías desde el sistema de almacenamiento</li>
                        </ul>

                        <div class="info-box">
                            <strong><i class="bi bi-list-check me-2"></i>Encabezado de la tabla:</strong>
                            En la parte superior se muestra:
                            <ul class="mb-0 mt-2">
                                <li><strong>Título:</strong> "Asuntos No Escalados" con contador de registros</li>
                                <li><strong>Botón Refrescar:</strong> Para actualizar datos manualmente</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <strong><i class="bi bi-info-circle me-2"></i>Si no aparecen asuntos:</strong>
                            Verás un mensaje indicando: "No hay asuntos no escalados pendientes"<br>
                            Esto puede significar que:
                            <ul class="mb-0 mt-2">
                                <li>No hay asuntos no escalados abiertos para tus cursos</li>
                                <li>Todos los asuntos ya fueron cerrados</li>
                                <li>Todos los asuntos de tus cursos son escalables</li>
                                <li>No estás asignado como director de ningún curso</li>
                            </ul>
                        </div>

                        <div class="success-box">
                            <strong><i class="bi bi-check-circle me-2"></i>Vista limpia:</strong>
                            Esta función muestra solo lo esencial para facilitar la gestión rápida de cierres. 
                            No verás información innecesaria ni opciones complejas.
                        </div>
                    </div>

                    <!-- Paso 2 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">2</span>
                            Revisar la tabla de asuntos no escalados
                        </h4>
                        
                        <p>
                            La tabla principal muestra todos los asuntos organizados en columnas simplificadas.
                        </p>

                        <p><strong>Estructura de la tabla:</strong></p>
                        <div class="table-responsive">
                            <table class="table table-bordered table-sm table-example">
                                <thead class="table-primary">
                                    <tr>
                                        <th style="width: 10%;">Foto</th>
                                        <th style="width: 25%;">Estudiante</th>
                                        <th style="width: 12%;">Fecha</th>
                                        <th style="width: 40%;">Descripción</th>
                                        <th style="width: 13%;">Cerrar</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><em>[Foto 50x50px]</em></td>
                                        <td>
                                            <strong>Nombre completo</strong><br>
                                            <small>Código: XXXX</small><br>
                                            <small>Curso: 11-A</small>
                                        </td>
                                        <td>08/11/2025</td>
                                        <td>
                                            <strong>Reportado por:</strong> Juan Pérez<br>
                                            <em>[Descripción truncada con scroll...]</em>
                                        </td>
                                        <td>
                                            <button class="btn btn-close-example btn-example">
                                                <i class="bi bi-lock me-1"></i>Cerrar
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="info-box">
                            <strong><i class="bi bi-image me-2"></i>Columna de Foto:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Muestra la fotografía del estudiante si está disponible</li>
                                <li>La URL se construye con: <span class="code-inline">config_url_photos + student_code + '.jpg'</span></li>
                                <li>Si no hay foto, el espacio queda en blanco</li>
                                <li>Tamaño: 50x50px con bordes redondeados</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <strong><i class="bi bi-person me-2"></i>Columna de Estudiante:</strong>
                            Muestra tres líneas de información:
                            <ul class="mb-0 mt-2">
                                <li><strong>Línea 1:</strong> Nombre completo en azul y negrita</li>
                                <li><strong>Línea 2:</strong> Código del estudiante en texto pequeño</li>
                                <li><strong>Línea 3:</strong> Nombre del curso en texto pequeño</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <strong><i class="bi bi-calendar me-2"></i>Columna de Fecha:</strong>
                            Fecha en que se registró el asunto, formato DD/MM/YYYY
                        </div>

                        <div class="info-box">
                            <strong><i class="bi bi-file-text me-2"></i>Columna de Descripción:</strong>
                            <ul class="mb-0 mt-2">
                                <li><strong>Primera línea:</strong> "Reportado por: [Nombre del reportante]"</li>
                                <li><strong>Contenido:</strong> Descripción del asunto (limpia de HTML)</li>
                                <li>Área con scroll vertical si el texto es largo (max 120px altura)</li>
                                <li>Fondo gris claro para facilitar lectura</li>
                                <li>Truncada a 200 caracteres con "..." si es muy larga</li>
                            </ul>
                        </div>

                        <div class="info-box">
                            <strong><i class="bi bi-lock me-2"></i>Columna de Cerrar:</strong>
                            Botón rojo con ícono de candado:
                            <ul class="mb-0 mt-2">
                                <li>Texto: "Cerrar"</li>
                                <li>Acción: Abre modal de confirmación</li>
                                <li>Tooltip: "Cerrar asunto definitivamente"</li>
                            </ul>
                        </div>

                        <div class="success-box">
                            <strong><i class="bi bi-mouse me-2"></i>Navegación en la tabla:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Desplázate verticalmente para ver todos los registros</li>
                                <li>En móviles, la tabla tiene scroll horizontal</li>
                                <li>Puedes hacer zoom con el navegador (Ctrl + / Ctrl -)</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Paso 3 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">3</span>
                            Leer y verificar el asunto antes de cerrar
                        </h4>
                        
                        <p>
                            Antes de cerrar cualquier asunto, es <strong>fundamental</strong> leerlo cuidadosamente 
                            y asegurarse de que ha sido adecuadamente atendido.
                        </p>

                        <p><strong>Preguntas que debes responder afirmativamente antes de cerrar:</strong></p>
                        <ul>
                            <li><strong>¿Se atendió la situación?</strong> ¿Hablaste con el estudiante? ¿Se tomaron acciones?</li>
                            <li><strong>¿Se comunicó con los involucrados?</strong> ¿El reportante sabe que fue atendido?</li>
                            <li><strong>¿No hay acciones pendientes?</strong> ¿Quedó algo por hacer que requiera seguimiento?</li>
                            <li><strong>¿Es realmente menor?</strong> ¿No podría escalar o complicarse?</li>
                            <li><strong>¿Está documentado?</strong> ¿Quedó registro en observador si era necesario?</li>
                        </ul>

                        <div class="danger-box">
                            <strong><i class="bi bi-exclamation-octagon me-2"></i>No cierres un asunto si:</strong>
                            <ul class="mb-0 mt-2">
                                <li>No has hablado aún con el estudiante</li>
                                <li>Quedaron acciones o compromisos pendientes</li>
                                <li>La situación podría repetirse o escalar</li>
                                <li>El reportante espera retroalimentación que no has dado</li>
                                <li>Tienes dudas sobre si está completamente resuelto</li>
                                <li>Descubres que debería ser escalable</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <strong><i class="bi bi-lightbulb me-2"></i>Si el asunto resulta ser más complejo:</strong>
                            <ol class="mb-0 mt-2">
                                <li>NO lo cierres desde esta función</li>
                                <li>Ve a "Revisar Asuntos Individuales"</li>
                                <li>Cambia su clasificación a <span class="code-inline">is_escalable = 'SI'</span></li>
                                <li>Coordina con el nivel apropiado (coordinación académica o convivencia)</li>
                                <li>Espera a que ellos lo gestionen y cierren</li>
                            </ol>
                        </div>

                        <div class="info-box">
                            <strong><i class="bi bi-chat-dots me-2"></i>Comunicación con el reportante:</strong>
                            Es buena práctica:
                            <ul class="mb-0 mt-2">
                                <li>Informar al reportante (docente/usuario) que el asunto fue atendido</li>
                                <li>Explicar brevemente qué acciones se tomaron</li>
                                <li>Agradecer por reportar la situación</li>
                                <li>Esto fortalece la cultura de seguimiento institucional</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Paso 4 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">4</span>
                            Cerrar el asunto definitivamente
                        </h4>
                        
                        <p>
                            Una vez verificado que el asunto ha sido adecuadamente atendido, puedes proceder a cerrarlo.
                        </p>

                        <p><strong>Para cerrar un asunto:</strong></p>
                        <ol>
                            <li>Localiza la fila del asunto en la tabla</li>
                            <li>Haz clic en el botón rojo 
                                <button class="btn btn-close-example btn-example btn-sm">
                                    <i class="bi bi-lock me-1"></i>Cerrar
                                </button>
                            </li>
                            <li>Se abrirá un <strong>modal de confirmación</strong></li>
                        </ol>

                        <div class="info-box">
                            <strong><i class="bi bi-window me-2"></i>Contenido del modal de confirmación:</strong>
                            El modal muestra:
                            <ul class="mb-0 mt-2">
                                <li><strong>Título:</strong> "Confirmar Cierre" con ícono de candado</li>
                                <li><strong>Alerta amarilla:</strong> Información del estudiante y fecha del asunto</li>
                                <li><strong>Alerta roja:</strong> Advertencias importantes sobre el cierre:
                                    <ul>
                                        <li>"Estás a punto de cerrar definitivamente este asunto"</li>
                                        <li>"El asunto dejará de aparecer en esta lista"</li>
                                        <li>"Esta acción no se puede deshacer"</li>
                                        <li>"Asegúrate de haber completado la conclusión y estrategia antes de cerrar" 
                                            <em>(nota: en esta función no hay conclusión/estrategia, es un texto residual del código base)</em>
                                        </li>
                                    </ul>
                                </li>
                                <li><strong>Pregunta de confirmación:</strong> "¿Estás seguro de que deseas cerrar este asunto?"</li>
                                <li><strong>Botones:</strong>
                                    <ul>
                                        <li>Gris "Cancelar" - Cierra el modal sin hacer cambios</li>
                                        <li>Rojo "Cerrar Asunto Definitivamente" - Ejecuta el cierre</li>
                                    </ul>
                                </li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <strong><i class="bi bi-clock me-2"></i>Si tienes dudas en este punto:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Haz clic en "Cancelar"</li>
                                <li>Revisa nuevamente el asunto</li>
                                <li>Verifica que todo esté completo</li>
                                <li>Consulta con alguien si es necesario</li>
                                <li>Puedes volver a intentar cerrar más tarde</li>
                            </ul>
                        </div>

                        <p class="mt-3"><strong>Si confirmas el cierre:</strong></p>
                        <ol>
                            <li>Haz clic en el botón rojo "Cerrar Asunto Definitivamente"</li>
                            <li>El botón cambia a: 
                                <span class="code-inline">"[spinner] Cerrando..."</span> y se deshabilita
                            </li>
                            <li>El sistema realiza la actualización en la base de datos</li>
                            <li>Si es exitoso:
                                <ul>
                                    <li>Aparece mensaje verde: "Asunto cerrado exitosamente"</li>
                                    <li>El modal se cierra automáticamente</li>
                                    <li>El asunto <strong>desaparece inmediatamente</strong> de la tabla</li>
                                    <li>El contador de asuntos se actualiza</li>
                                </ul>
                            </li>
                            <li>Si hay error:
                                <ul>
                                    <li>Aparece mensaje rojo con descripción del error</li>
                                    <li>El botón se habilita de nuevo</li>
                                    <li>Puedes intentar nuevamente</li>
                                </ul>
                            </li>
                        </ol>

                        <div class="success-box">
                            <strong><i class="bi bi-check-circle me-2"></i>¿Qué sucede técnicamente al cerrar?</strong>
                            <ul class="mb-0 mt-2">
                                <li>Se actualiza el campo <span class="code-inline">is_open = 'NO'</span> en <span class="code-inline">stm_students_topics</span></li>
                                <li>El registro queda permanentemente cerrado</li>
                                <li>Se elimina de todas las vistas de asuntos "abiertos"</li>
                                <li>Permanece en el historial del estudiante para consultas futuras</li>
                                <li>NO se puede reabrir (esto es intencional)</li>
                            </ul>
                        </div>

                        <div class="danger-box">
                            <strong><i class="bi bi-shield-exclamation me-2"></i>Recordatorio final:</strong>
                            <ul class="mb-0 mt-2">
                                <li>El cierre es <strong>PERMANENTE</strong></li>
                                <li>No hay función de "reabrir"</li>
                                <li>No hay "deshacer"</li>
                                <li>Si cierras por error, solo un administrador con acceso directo a la base de datos podría revertirlo</li>
                                <li>Asegúrate antes de confirmar</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Paso 5 -->
                    <div class="step-card">
                        <h4>
                            <span class="step-number">5</span>
                            Refrescar datos cuando sea necesario
                        </h4>
                        
                        <p>
                            Si necesitas actualizar la información mostrada sin recargar toda la página, 
                            usa el botón 
                            <button class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-arrow-clockwise me-1"></i>Refrescar
                            </button> 
                            ubicado en el encabezado de la tabla.
                        </p>

                        <p><strong>Razones para refrescar:</strong></p>
                        <ul>
                            <li>Se han registrado nuevos asuntos no escalados desde otros usuarios</li>
                            <li>Se reclasificaron asuntos como NO escalables desde "Revisar Asuntos"</li>
                            <li>Quieres verificar que el cierre se procesó correctamente</li>
                            <li>Has estado trabajando mucho tiempo en la página</li>
                            <li>Necesitas confirmar la cantidad actual de asuntos pendientes</li>
                        </ul>

                        <div class="info-box">
                            <strong><i class="bi bi-arrow-clockwise me-2"></i>Proceso de refresco:</strong>
                            <ul class="mb-0 mt-2">
                                <li>Aparece mensaje "Actualizando datos..." debajo de la tabla</li>
                                <li>La tabla se atenúa visualmente (opacidad 0.5)</li>
                                <li>Se consulta nuevamente la base de datos</li>
                                <li>Se regenera toda la tabla con datos frescos</li>
                                <li>Toma aproximadamente 2-3 segundos</li>
                                <li>Aparece mensaje verde de confirmación</li>
                            </ul>
                        </div>

                        <div class="success-box">
                            <strong><i class="bi bi-check-circle me-2"></i>Actualización automática después de cerrar:</strong>
                            No necesitas usar el botón "Refrescar" después de cerrar un asunto. 
                            El sistema automáticamente:
                            <ul class="mb-0 mt-2">
                                <li>Elimina el asunto de la lista en memoria</li>
                                <li>Re-renderiza la tabla completa</li>
                                <li>Actualiza el contador de asuntos</li>
                                <li>Todo esto sucede instantáneamente</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Cerrar modales -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-x-circle me-2"></i>
                        Cerrar modales sin ejecutar acciones
                    </h2>

                    <div class="step-card">
                        <p>
                            Si abres el modal de confirmación pero decides no cerrar el asunto, 
                            tienes varias formas de salir:
                        </p>

                        <h5>Métodos para cerrar el modal:</h5>
                        <ul>
                            <li><strong>Botón "Cancelar":</strong> Click en el botón gris en la parte inferior</li>
                            <li><strong>Botón X:</strong> Click en la X blanca en la esquina superior derecha del modal</li>
                            <li><strong>Tecla Escape:</strong> Presionar <span class="keyboard-shortcut">Esc</span> en el teclado</li>
                            <li><strong>Click fuera del modal:</strong> Click en el área oscura alrededor del modal</li>
                        </ul>

                        <div class="info-box">
                            <strong><i class="bi bi-shield-check me-2"></i>Seguridad:</strong>
                            Todas estas acciones cierran el modal <strong>sin realizar cambios</strong>. 
                            El asunto permanece abierto en la tabla. Puedes cerrar el modal cuantas veces 
                            quieras sin consecuencias.
                        </div>
                    </div>
                </section>

                <!-- Solución de problemas -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-question-circle me-2"></i>
                        Solución de problemas comunes
                    </h2>

                    <div class="step-card">
                        <h5>No se cargan los asuntos al abrir la página</h5>
                        <ul>
                            <li>Verifica tu conexión a internet</li>
                            <li>Recarga la página completamente (Ctrl + Shift + R)</li>
                            <li>Verifica que estés logueado correctamente</li>
                            <li>Confirma que tienes el permiso "Gestionar asuntos no escalados"</li>
                            <li>Verifica que estés asignado como director de al menos un curso</li>
                            <li>Contacta al administrador si el problema persiste</li>
                        </ul>

                        <h5 class="mt-3">La pantalla de carga no desaparece</h5>
                        <ul>
                            <li>Espera al menos 10 segundos</li>
                            <li>Verifica tu conexión a internet</li>
                            <li>Abre la consola del navegador (F12) y busca errores</li>
                            <li>Recarga la página si pasan más de 30 segundos</li>
                            <li>Intenta en otro navegador</li>
                        </ul>

                        <h5 class="mt-3">Las fotografías de los estudiantes no aparecen</h5>
                        <ul>
                            <li>Es normal si los estudiantes no tienen código asignado</li>
                            <li>Es normal si no hay fotografías cargadas en el sistema</li>
                            <li>La falta de fotos NO afecta la funcionalidad</li>
                            <li>Contacta al administrador si todas las fotos faltan repentinamente</li>
                        </ul>

                        <h5 class="mt-3">Veo asuntos que debería ver en otra función</h5>
                        <p>Si ves asuntos que parecen complejos o que deberían estar escalados:</p>
                        <ul>
                            <li>Verifica que realmente sean <span class="code-inline">is_escalable = 'NO'</span></li>
                            <li>Puede que fueron clasificados incorrectamente</li>
                            <li>NO los cierres desde esta función</li>
                            <li>Ve a "Revisar Asuntos Individuales"</li>
                            <li>Cámbialos a <span class="code-inline">is_escalable = 'SI'</span></li>
                            <li>Luego coordina su gestión apropiada</li>
                        </ul>

                        <h5 class="mt-3">El botón "Cerrar" no responde</h5>
                        <ul>
                            <li>Verifica que no haya otra operación en progreso</li>
                            <li>Espera a que termine cualquier proceso de cierre anterior</li>
                            <li>Recarga la página si el botón permanece deshabilitado</li>
                            <li>Verifica tu conexión a internet</li>
                        </ul>

                        <h5 class="mt-3">El modal de confirmación no se abre</h5>
                        <ul>
                            <li>Verifica que hiciste clic en el botón correcto</li>
                            <li>Espera unos segundos y vuelve a intentar</li>
                            <li>Recarga la página</li>
                            <li>Verifica que JavaScript esté habilitado</li>
                            <li>Prueba en otro navegador</li>
                        </ul>

                        <h5 class="mt-3">Error al cerrar el asunto</h5>
                        <ul>
                            <li>Lee el mensaje de error específico que aparece</li>
                            <li>Verifica tu conexión a internet</li>
                            <li>Espera unos segundos y vuelve a intentar</li>
                            <li>Si dice "hay una operación en proceso", espera a que termine</li>
                            <li>Recarga la página si el error persiste</li>
                            <li>Contacta al administrador con el mensaje de error específico</li>
                        </ul>

                        <h5 class="mt-3">El asunto cerrado sigue apareciendo en la lista</h5>
                        <ul>
                            <li>Verifica que apareció el mensaje "Asunto cerrado exitosamente"</li>
                            <li>Haz clic en el botón "Refrescar" para actualizar</li>
                            <li>Si después de refrescar sigue ahí, puede que el cierre no se procesó</li>
                            <li>Revisa en la base de datos si tienes acceso</li>
                            <li>Intenta cerrar nuevamente</li>
                            <li>Contacta al administrador si persiste</li>
                        </ul>

                        <h5 class="mt-3">Cerré un asunto por error</h5>
                        <ul>
                            <li>Lamentablemente, no hay función de "deshacer"</li>
                            <li>El cierre es permanente por diseño</li>
                            <li>Contacta inmediatamente al administrador del sistema</li>
                            <li>Explica qué asunto cerraste y por qué fue un error</li>
                            <li>El administrador puede revertirlo con acceso directo a la base de datos</li>
                            <li>Documenta la situación para referencia futura</li>
                        </ul>

                        <h5 class="mt-3">No puedo cerrar ningún asunto (mensaje de operación en proceso)</h5>
                        <ul>
                            <li>Significa que hay un cierre pendiente</li>
                            <li>Espera a que termine (máximo 30 segundos)</li>
                            <li>Si persiste, recarga la página</li>
                            <li>Puede haber un problema de conexión que dejó el sistema esperando</li>
                        </ul>

                        <h5 class="mt-3">La tabla no se adapta bien a mi móvil</h5>
                        <ul>
                            <li>La tabla tiene scroll horizontal en pantallas pequeñas</li>
                            <li>Desliza horizontalmente para ver todas las columnas</li>
                            <li>Puedes rotar el dispositivo a horizontal</li>
                            <li>Considera usar una tablet o computadora para mejor experiencia</li>
                        </ul>

                        <h5 class="mt-3">La descripción está cortada o no se ve completa</h5>
                        <ul>
                            <li>Las descripciones largas tienen scroll vertical en su celda</li>
                            <li>Desplázate dentro del área gris para leer todo</li>
                            <li>El área tiene máximo 120px de altura</li>
                            <li>Está truncada a 200 caracteres con "..."</li>
                            <li>Si necesitas ver el contenido original completo, contacta al reportante</li>
                        </ul>
                    </div>
                </section>

                <!-- Buenas prácticas -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-award me-2"></i>
                        Buenas prácticas para directores de curso
                    </h2>

                    <div class="step-card">
                        <ul class="feature-list">
                            <li>Revisa esta función periódicamente (al menos 2 veces por semana)</li>
                            <li>No acumules asuntos no escalados sin cerrar</li>
                            <li>Lee completamente cada asunto antes de decidir cerrarlo</li>
                            <li>Comunica con el estudiante antes de cerrar (al menos una conversación)</li>
                            <li>Informa al reportante que el asunto fue atendido</li>
                            <li>Documenta en el observador del estudiante si es pertinente</li>
                            <li>Si tienes dudas sobre cerrar, consulta con coordinación o colegas</li>
                            <li>No cierres asuntos "para limpiar la lista" sin atenderlos adecuadamente</li>
                            <li>Verifica que no haya acciones pendientes antes de cerrar</li>
                            <li>Si un asunto resulta más complejo, reclasifícalo como escalable</li>
                            <li>Mantén coherencia entre el cierre del asunto y el observador del estudiante</li>
                            <li>Usa el botón refrescar al inicio de cada sesión de trabajo</li>
                            <li>Establece una rutina de cierre (ej: viernes en la tarde)</li>
                            <li>Prioriza cerrar asuntos más antiguos que ya están resueltos</li>
                            <li>Ante situaciones reiterativas, considera si realmente son "no escalables"</li>
                        </ul>

                        <div class="info-box mt-3">
                            <strong><i class="bi bi-calendar-check me-2"></i>Sugerencia de rutina semanal:</strong>
                            <ul class="mb-0 mt-2">
                                <li><strong>Lunes:</strong> Revisa nuevos asuntos reportados el fin de semana</li>
                                <li><strong>Miércoles:</strong> Atiende asuntos pendientes, habla con estudiantes</li>
                                <li><strong>Viernes:</strong> Cierra asuntos ya resueltos de la semana</li>
                            </ul>
                        </div>

                        <div class="success-box mt-3">
                            <strong><i class="bi bi-people me-2"></i>Impacto de buenas prácticas:</strong>
                            Un buen manejo de asuntos no escalados:
                            <ul class="mb-0 mt-2">
                                <li>Mantiene limpia y útil la vista de gestión</li>
                                <li>Facilita identificar asuntos recientes que requieren atención</li>
                                <li>Fortalece la relación director-estudiante-familia</li>
                                <li>Demuestra seguimiento efectivo a docentes reportantes</li>
                                <li>Mantiene historial completo pero organizado</li>
                                <li>Permite a coordinación enfocarse en asuntos complejos</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Aspectos técnicos -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-gear me-2"></i>
                        Aspectos técnicos importantes
                    </h2>

                    <div class="step-card">
                        <h5>Filtrado de datos por director</h5>
                        <p>
                            La consulta a la base de datos filtra automáticamente usando:
                        </p>
                        <pre class="bg-light p-3 rounded"><code>stm_students_topics
  → students (student_id)
    → courses (student_course)
      → WHERE course_director_email = [tu_correo]
  → workers (email) [para nombre del reportante]</code></pre>

                        <p>Condiciones adicionales aplicadas:</p>
                        <ul>
                            <li><span class="code-inline">is_escalable = 'NO'</span> - Solo asuntos NO escalables</li>
                            <li><span class="code-inline">is_open = 'SI'</span> - Solo asuntos abiertos</li>
                            <li><span class="code-inline">ORDER BY topic_date DESC</span> - Más recientes primero</li>
                            <li><span class="code-inline">LIMIT 150</span> - Máximo 150 registros por carga</li>
                        </ul>

                        <h5 class="mt-4">Campos del registro</h5>
                        <p>La aplicación trabaja con los siguientes campos de <span class="code-inline">stm_students_topics</span>:</p>
                        <ul>
                            <li><strong>topic_id:</strong> ID único del registro (usado para operaciones)</li>
                            <li><strong>student_id:</strong> ID del estudiante asociado</li>
                            <li><strong>topic_date:</strong> Fecha del registro (YYYY-MM-DD)</li>
                            <li><strong>topic_description:</strong> Descripción completa (HTML, se limpia para mostrar)</li>
                            <li><strong>email:</strong> Correo de quien creó el registro</li>
                            <li><strong>is_escalable:</strong> Valor fijo 'NO' en esta vista</li>
                            <li><strong>is_open:</strong> Campo que se actualiza a 'NO' al cerrar</li>
                        </ul>

                        <h5 class="mt-4">Proceso de cierre de asunto</h5>
                        <p>Cuando confirmas cerrar un asunto:</p>
                        <ol>
                            <li>Se verifica que no haya otra operación en curso (<span class="code-inline">enviandoOperacion = true</span>)</li>
                            <li>Se deshabilita el botón y se muestra spinner</li>
                            <li>Se realiza petición PATCH a: <span class="code-inline">/stm_students_topics?topic_id=eq.[ID]</span></li>
                            <li>Body de la petición: <span class="code-inline">{ is_open: 'NO' }</span></li>
                            <li>Si es exitoso:
                                <ul>
                                    <li>Se filtra el asunto de <span class="code-inline">datosGlobales.asuntos</span></li>
                                    <li>Se re-renderiza la tabla completa</li>
                                    <li>Se muestra mensaje de éxito</li>
                                    <li>Se cierra el modal automáticamente</li>
                                </ul>
                            </li>
                            <li>Si hay error:
                                <ul>
                                    <li>Se muestra mensaje de error descriptivo</li>
                                    <li>El asunto permanece en la tabla</li>
                                    <li>El botón se habilita para reintentar</li>
                                </ul>
                            </li>
                            <li>Se resetea <span class="code-inline">enviandoOperacion = false</span></li>
                        </ol>

                        <h5 class="mt-4">Protecciones implementadas</h5>
                        <p>El código incluye múltiples capas de protección:</p>
                        <ul>
                            <li><strong>Variable <span class="code-inline">enviandoOperacion</span>:</strong> Previene cierres simultáneos</li>
                            <li><strong>Deshabilitación de botón:</strong> El botón se deshabilita durante el cierre</li>
                            <li><strong>Modal de confirmación:</strong> Requiere confirmación explícita antes de cerrar</li>
                            <li><strong>Manejo de errores:</strong> Try-catch con mensajes descriptivos</li>
                            <li><strong>Actualización inmediata de UI:</strong> Previene confusión visual</li>
                        </ul>

                        <h5 class="mt-4">Carga de fotografías</h5>
                        <p>Las fotos se cargan desde Supabase Storage:</p>
                        <ul>
                            <li>URL base obtenida de <span class="code-inline">system_config.photos_url</span></li>
                            <li>URL completa: <span class="code-inline">photos_url + student_code + '.jpg'</span></li>
                            <li>Atributo <span class="code-inline">onerror</span> oculta imagen si no existe</li>
                            <li>Tamaño fijo: 50x50px con <span class="code-inline">object-fit: cover</span></li>
                        </ul>

                        <h5 class="mt-4">Funciones globales exportadas</h5>
                        <p>Estas funciones están disponibles globalmente:</p>
                        <ul>
                            <li><span class="code-inline">window.abrirModalCerrar(topicId)</span> - Abre modal de cierre</li>
                            <li><span class="code-inline">window.cerrarModalCerrar()</span> - Cierra modal sin cambios</li>
                            <li><span class="code-inline">window.confirmarCerrarAsunto()</span> - Ejecuta el cierre</li>
                            <li><span class="code-inline">window.refrescarDatos()</span> - Recarga datos desde BD</li>
                        </ul>

                        <h5 class="mt-4">Estructura de datos en memoria</h5>
                        <p>El objeto <span class="code-inline">datosGlobales</span> contiene:</p>
                        <pre class="bg-light p-3 rounded"><code>{
  asuntos: [
    {
      topic_id: number,
      student_id: number,
      topic_date: string,
      topic_description: string,
      topic_email: string,
      student_code: string,
      student_first_name: string,
      student_last_name_1: string,
      course_name: string,
      worker_first_name: string,
      worker_last_name_1: string
    },
    // ... más registros
  ],
  config_url_photos: string
}</code></pre>

                        <h5 class="mt-4">Renderizado eficiente</h5>
                        <p>La tabla se construye usando DocumentFragment:</p>
                        <ul>
                            <li>Se crea un fragment en memoria</li>
                            <li>Se agregan todas las filas al fragment</li>
                            <li>Se inserta el fragment completo al DOM de una sola vez</li>
                            <li>Esto minimiza reflows y mejora rendimiento con muchos registros</li>
                        </ul>

                        <h5 class="mt-4">Eventos del modal</h5>
                        <p>El modal se puede cerrar mediante:</p>
                        <ul>
                            <li>Click en botón "Cancelar" → llama <span class="code-inline">cerrarModalCerrar()</span></li>
                            <li>Click en botón X → llama <span class="code-inline">cerrarModalCerrar()</span></li>
                            <li>Tecla Escape → evento <span class="code-inline">keydown</span> global</li>
                            <li>Click fuera del modal → evento <span class="code-inline">click</span> en overlay</li>
                        </ul>
                    </div>
                </section>

                <!-- Preguntas frecuentes -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-chat-dots me-2"></i>
                        Preguntas frecuentes
                    </h2>

                    <div class="step-card">
                        <h5>¿Por qué esta función no permite agregar conclusiones o estrategias?</h5>
                        <p>
                            Es una decisión de diseño intencional. Los asuntos no escalados son, por definición, 
                            situaciones menores que pueden manejarse directamente a nivel del curso. No requieren 
                            documentación adicional formal. Si un asunto resulta requerir conclusiones o estrategias 
                            formales, probablemente debería ser escalable y manejarse desde otra función.
                        </p>

                        <h5 class="mt-3">¿Puedo reabrir un asunto que cerré?</h5>
                        <p>
                            No. El cierre es permanente e irreversible por diseño. Esta decisión mantiene integridad 
                            en los registros históricos y previene manipulación de datos. Si cerraste un asunto por 
                            error, contacta al administrador del sistema.
                        </p>

                        <h5 class="mt-3">¿Qué pasa con los asuntos cerrados? ¿Se borran?</h5>
                        <p>
                            NO se borran. Los asuntos cerrados permanecen en la base de datos como parte del 
                            historial del estudiante. Simplemente dejan de aparecer en las vistas de asuntos 
                            "abiertos". Pueden consultarse mediante reportes históricos o consultas directas 
                            a la base de datos.
                        </p>

                        <h5 class="mt-3">¿Los coordinadores pueden ver asuntos que yo cierro?</h5>
                        <p>
                            Sí, los coordinadores y administradores con permisos apropiados pueden acceder 
                            al historial completo de asuntos de cualquier estudiante, incluyendo los cerrados. 
                            El cierre solo saca el asunto de vistas activas, no lo oculta del historial.
                        </p>

                        <h5 class="mt-3">¿Puedo cerrar asuntos de estudiantes que no son de mis cursos?</h5>
                        <p>
                            No, el sistema filtra automáticamente para mostrar solo asuntos de estudiantes de 
                            cursos donde estás registrado como director. No verás ni podrás cerrar asuntos de 
                            otros cursos.
                        </p>

                        <h5 class="mt-3">¿Se notifica a alguien cuando cierro un asunto?</h5>
                        <p>
                            Actualmente no. El cierre de asuntos no escalados no genera notificaciones automáticas. 
                            Es responsabilidad del director comunicar manualmente con el reportante si es necesario. 
                            Esta funcionalidad de notificaciones podría agregarse en futuras versiones.
                        </p>

                        <h5 class="mt-3">¿Qué diferencia hay entre cerrar aquí vs. que coordinación cierre un asunto escalable?</h5>
                        <p>
                            Técnicamente, ambos realizan la misma acción: cambiar <span class="code-inline">is_open</span> 
                            a 'NO'. La diferencia está en:
                        </p>
                        <ul>
                            <li><strong>Esta función:</strong> Para asuntos NO escalables, gestión directa del director</li>
                            <li><strong>Gestionar escalables:</strong> Para asuntos escalables, requiere documentación adicional (conclusiones, estrategias)</li>
                            <li>Ambos cierran permanentemente el asunto</li>
                            <li>Ambos lo sacan de vistas activas</li>
                        </ul>

                        <h5 class="mt-3">¿Puedo cerrar múltiples asuntos al mismo tiempo?</h5>
                        <p>
                            No hay función de cierre masivo. Debes cerrar cada asunto individualmente, uno por uno. 
                            Esto es intencional para forzar la revisión cuidadosa de cada caso antes de cerrarlo.
                        </p>

                        <h5 class="mt-3">¿Hay un límite de asuntos que puedo ver en la lista?</h5>
                        <p>
                            Sí, la consulta tiene un límite de 150 registros. Si tienes más de 150 asuntos no 
                            escalados abiertos, solo verás los 150 más recientes. Esto es un indicador de que 
                            deberías cerrar asuntos resueltos más frecuentemente.
                        </p>

                        <h5 class="mt-3">¿Por qué algunos asuntos no tienen nombre de reportante?</h5>
                        <p>
                            Si la columna de reportante está vacía, puede significar:
                        </p>
                        <ul>
                            <li>El usuario que lo creó no tiene nombres registrados en <span class="code-inline">workers</span></li>
                            <li>El correo del registro no coincide con ningún usuario en la tabla</li>
                            <li>Error de sincronización entre tablas</li>
                        </ul>

                        <h5 class="mt-3">¿Qué pasa si cierro un asunto y luego la situación vuelve a ocurrir?</h5>
                        <p>
                            Si la situación se repite:
                        </p>
                        <ul>
                            <li>El docente debe crear un NUEVO registro del nuevo incidente</li>
                            <li>NO se reabre el asunto anterior</li>
                            <li>Esto permite rastrear reincidencias</li>
                            <li>Si hay múltiples registros del mismo estudiante, considera si es realmente "no escalable"</li>
                            <li>Patrones repetitivos suelen requerir escalamiento</li>
                        </ul>

                        <h5 class="mt-3">¿Puedo exportar o imprimir la lista de asuntos antes de cerrarlos?</h5>
                        <p>
                            Actualmente no hay función directa de exportación en esta página. Sin embargo:
                        </p>
                        <ul>
                            <li>Puedes usar la función de impresión del navegador (Ctrl + P)</li>
                            <li>Puedes hacer screenshots de la tabla</li>
                            <li>Para reportes formales, consulta el módulo de reportes del sistema</li>
                            <li>Los administradores pueden generar reportes desde la base de datos</li>
                        </ul>

                        <h5 class="mt-3">¿Esta función muestra asuntos EAE?</h5>
                        <p>
                            Sí, si un asunto EAE (<span class="code-inline">is_eae = true</span>) está marcado como 
                            <span class="code-inline">is_escalable = 'NO'</span>, aparecerá en esta lista. 
                            Sin embargo, asuntos EAE rara vez deberían ser "no escalables" ya que por naturaleza 
                            requieren seguimiento especializado.
                        </p>

                        <h5 class="mt-3">¿El cierre afecta el observador del estudiante?</h5>
                        <p>
                            No directamente. El observador del estudiante es una funcionalidad separada. Sin embargo, 
                            es buena práctica mantener coherencia: si un asunto ameritó registro en el observador, 
                            asegúrate de que esa anotación refleje que el asunto fue atendido y cerrado.
                        </p>
                    </div>
                </section>

                <!-- TARJETA PARA REPORTAR BUGS -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../report-bug.html" class="btn btn-danger btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Seguimientos',
            modulePath: 'follow-ups',
            pageTitle: 'Gestionar Asuntos No Escalados',
            pagePath: 'manage-unescalated-issues.html',
            moduleDescription: 'Gestionar y cerrar asuntos no escalados'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            // Actualizar title
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
