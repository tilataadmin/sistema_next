<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSI√ìN DE LA P√ÅGINA -->
    <meta name="page-version" content="25.11.08.10.20">
    
    <title>Manual - [NOMBRE_MODULO] - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSI√ìN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Tarjeta de construcci√≥n m√°s compacta */
        .construction-card {
            background: #fff3cd;
            border: 2px dashed var(--system-tertiary-color, #ffc107);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .construction-icon {
            font-size: 3rem;
            color: var(--system-tertiary-color, #ffc107);
            margin-bottom: 0.75rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Tarjeta para reportar bugs */
        .bug-report-card {
            background: var(--system-secondary-color, #667eea);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        /* Bot√≥n flotante para reportar bugs */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #dc3545) !important;
            border-color: var(--system-primary-color, #dc3545) !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: [NOMBRE_MODULO]
                        </h1>
                        <p class="subtitle mb-0">[DESCRIPCION_MODULO]</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../modules/[MODULO_PATH]/[PAGINA_PATH]" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al M√≥dulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-8 mx-auto">

                <!-- MENSAJE DE CONSTRUCCI√ìN -->
                <div class="construction-card">
                    <i class="bi bi-tools construction-icon"></i>
                    <h4 class="mb-2">üìñ Estamos trabajando en esta secci√≥n</h4>
                    <p class="mb-0">
                        El manual para esta p√°gina est√° en construcci√≥n. Pronto estar√° disponible 
                        con instrucciones detalladas para aprovechar al m√°ximo esta funcionalidad.
                    </p>
                </div>

                <!-- INFORMACI√ìN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong id="display-module">[NOMBRE_MODULO]</strong></h5>
                            <p class="text-muted mb-0 small" id="display-page">[NOMBRE_PAGINA]</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras alg√∫n problema,<br>
                                puedes reportarlo usando el bot√≥n de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- TARJETA PARA REPORTAR BUGS -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¬øEncontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, rep√≥rtalo aqu√≠.
                    </p>
                    <a href="../manual/report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOT√ìN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../manual/report-bug.html" class="btn btn-danger btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CR√çTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;
        let currentPage = null;
        let detectedModule = null;

        // ==========================================
        // CONFIGURACI√ìN DE LA P√ÅGINA
        // ==========================================
        // PERSONALIZAR ESTOS VALORES PARA CADA P√ÅGINA
        const PAGE_CONFIG = {
            moduleName: '[NOMBRE_MODULO]',
            modulePath: '[MODULO_PATH]', // Ej: 'security', 'hr', 'config'
            pageTitle: '[NOMBRE_PAGINA]',
            pagePath: '[PAGINA_PATH]', // Ej: 'users.html', 'index.html'
            moduleDescription: '[DESCRIPCION_MODULO]'
        };

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üìñ Iniciando p√°gina de manual...');
            
            try {
                // Cargar colores corporativos primero
                await loadAndApplyBrandColors();
                
                // Obtener sesi√≥n del usuario
                const session = getStoredSession();
                if (!session || !session.user) {
                    showMessage('Debes iniciar sesi√≥n para acceder al manual', 'danger');
                    setTimeout(() => {
                        window.location.href = '../login.html';
                    }, 2000);
                    return;
                }

                currentUser = session.user;
                
                // Actualizar informaci√≥n en la p√°gina
                updatePageInfo();
                
                console.log('‚úÖ P√°gina lista');
                
            } catch (error) {
                console.error('‚ùå Error inicializando p√°gina:', error);
                showMessage('Error al cargar la p√°gina: ' + error.message, 'danger');
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACI√ìN DE LA P√ÅGINA
        // ==========================================
        function updatePageInfo() {
            // Actualizar enlaces al m√≥dulo
            const moduleLinks = document.querySelectorAll('[href*="[MODULO_PATH]"]');
            moduleLinks.forEach(link => {
                link.href = link.href.replace('[MODULO_PATH]', PAGE_CONFIG.modulePath);
            });

            const pageLinks = document.querySelectorAll('[href*="[PAGINA_PATH]"]');
            pageLinks.forEach(link => {
                link.href = link.href.replace('[PAGINA_PATH]', PAGE_CONFIG.pagePath);
            });

            // Actualizar textos
            const moduloElements = document.querySelectorAll('#display-module');
            moduloElements.forEach(el => {
                el.textContent = PAGE_CONFIG.moduleName;
            });

            const pageElements = document.querySelectorAll('#display-page');
            pageElements.forEach(el => {
                el.textContent = PAGE_CONFIG.pageTitle;
            });

            // Actualizar todos los placeholders en el HTML
            document.body.innerHTML = document.body.innerHTML
                .replace(/\[NOMBRE_MODULO\]/g, PAGE_CONFIG.moduleName)
                .replace(/\[NOMBRE_PAGINA\]/g, PAGE_CONFIG.pageTitle)
                .replace(/\[DESCRIPCION_MODULO\]/g, PAGE_CONFIG.moduleDescription);

            // Actualizar title
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }

    </script>
</body>
</html>
