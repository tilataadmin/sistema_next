<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="26.02.08.21.30">
    
    <title>Manual - Servicios - Transporte de Personal - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Secciones del manual */
        .section-title {
            color: var(--system-primary-color, #1B365D);
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding-bottom: 0.5rem;
            margin-top: 2.5rem;
            margin-bottom: 1.5rem;
        }

        .step-card {
            background: #f8f9fa;
            border-left: 4px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }

        .step-number {
            background: var(--system-primary-color, #1B365D);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 0.75rem;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #0dcaf0;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .tip-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .faq-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .faq-question {
            font-weight: 600;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.75rem;
        }

        /* Tarjeta para reportar bugs - COLOR PRIMARIO */
        .bug-report-card {
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        /* Botón flotante para reportar bugs - COLOR PRIMARIO */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background-color: var(--system-primary-color, #1B365D) !important;
            border-color: var(--system-primary-color, #1B365D) !important;
            color: white !important;
        }

        .floating-bug-button:hover,
        .floating-bug-button:focus,
        .floating-bug-button:active {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
            background-color: var(--system-primary-color, #1B365D) !important;
            border-color: var(--system-primary-color, #1B365D) !important;
            color: white !important;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Lista de características */
        .feature-list {
            list-style: none;
            padding-left: 0;
        }

        .feature-list li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .feature-list li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Subsecciones */
        .subsection-title {
            color: var(--system-primary-color, #1B365D);
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            padding-left: 1rem;
            border-left: 3px solid var(--system-primary-color, #1B365D);
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Servicios
                        </h1>
                        <p class="subtitle mb-0">Transporte de Personal</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/services/staff-transport.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-10 mx-auto">

                <!-- INFORMACIÓN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong id="display-module">Servicios</strong></h5>
                            <p class="text-muted mb-0 small" id="display-page">Transporte de Personal</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras algún problema,<br>
                                puedes reportarlo usando el botón de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- CONTENIDO DEL MANUAL -->
                <!-- ============================================ -->

                <!-- SECCIÓN 1: ¿Qué es? -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-info-circle me-2"></i>
                        ¿Qué es el Transporte de Personal?
                    </h2>
                    
                    <div class="step-card">
                        <p class="lead">
                            El módulo de <strong>Transporte de Personal</strong> gestiona el servicio de transporte 
                            diario para trabajadores del colegio (docentes, administrativos, personal de apoyo). 
                            Es especialmente útil cuando el colegio contrata rutas de transporte con un proveedor externo 
                            y necesita llevar un control diario para liquidar el pago mensual.
                        </p>
                        
                        <p><strong>¿Cómo funciona el proceso completo?</strong></p>
                        <ol>
                            <li><strong>Configurar rutas:</strong> Creas las rutas de transporte con sus tarifas 
                                (ejemplo: "Ruta Norte", "Ruta Sur")</li>
                            <li><strong>Registro diario:</strong> Cada día, marcas cuáles rutas se realizaron y cuáles no</li>
                            <li><strong>Resumen mensual:</strong> Al final del mes, el sistema calcula automáticamente 
                                cuántos recorridos hubo por ruta y el total a pagar</li>
                            <li><strong>Liquidación:</strong> Usas el resumen mensual como soporte para pagar al proveedor</li>
                        </ol>

                        <div class="info-box">
                            <i class="bi bi-lightbulb text-info me-2"></i>
                            <strong>¿Por qué es importante?</strong>
                            <ul class="mt-2 mb-0">
                                <li>Antes: Se pagaba un valor fijo mensual sin importar si todas las rutas se realizaban todos los días</li>
                                <li>Ahora: Solo se paga por los recorridos realmente realizados</li>
                                <li>Beneficio: Ahorro significativo cuando hay días festivos, puentes, recesos, o cuando 
                                    una ruta específicamente no se realiza</li>
                            </ul>
                        </div>

                        <div class="warning-box">
                            <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                            <strong>Diferencia con otros transportes:</strong> Este módulo es SOLO para el transporte 
                            de personal/trabajadores. Los transportes de estudiantes (extracurriculares, salidas pedagógicas, 
                            salidas deportivas) se gestionan en sus respectivos módulos.
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 2: Características principales -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-star me-2"></i>
                        Características principales
                    </h2>
                    
                    <div class="step-card">
                        <ul class="feature-list">
                            <li><strong>Gestión de rutas sencilla:</strong> Crea y edita rutas con nombre, capacidad 
                                y valor por viaje.</li>
                            
                            <li><strong>Registro diario rápido:</strong> Interfaz visual con toggles (interruptores) 
                                para marcar rápidamente qué rutas se realizaron.</li>
                            
                            <li><strong>Histórico de registros:</strong> Puedes consultar cualquier fecha pasada para 
                                ver qué se registró ese día.</li>
                            
                            <li><strong>Congelamiento de tarifas:</strong> Cuando registras un día, el valor de la tarifa 
                                se congela. Cambios futuros en la ruta NO afectan registros pasados.</li>
                            
                            <li><strong>Resumen mensual automático:</strong> El sistema calcula automáticamente el total 
                                de recorridos por ruta y el monto a pagar.</li>
                            
                            <li><strong>Liquidación precisa:</strong> La tabla de resumen mensual sirve como soporte 
                                oficial para pagar al proveedor.</li>
                            
                            <li><strong>Vigencia de tarifas:</strong> Cada ruta tiene una fecha "Vigente desde" para 
                                documentar cuándo entró en vigor esa tarifa.</li>
                            
                            <li><strong>Control de rutas activas/inactivas:</strong> Desactiva rutas que ya no se usan 
                                sin eliminarlas (mantiene historial).</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 3: Antes de comenzar -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-clipboard-check me-2"></i>
                        Antes de comenzar
                    </h2>
                    
                    <div class="step-card">
                        <h5 class="mb-3">Requisitos previos:</h5>
                        
                        <ul>
                            <li><strong>Permiso necesario:</strong> Debes tener el permiso "Transporte de personal" activo.</li>
                            
                            <li><strong>Contrato con proveedor:</strong> Debe existir un contrato con un proveedor de 
                                transporte que especifique las rutas y tarifas.</li>
                            
                            <li><strong>Definir las rutas:</strong> Identifica cuáles son las rutas que el proveedor 
                                ofrece (ejemplo: Ruta Norte, Ruta Sur, Ruta Centro).</li>
                            
                            <li><strong>Conocer las tarifas:</strong> Debes saber cuánto cuesta cada viaje por ruta 
                                según el contrato.</li>
                        </ul>

                        <h5 class="mt-4 mb-3">Flujo inicial de configuración:</h5>
                        <ol>
                            <li>Crear todas las rutas de transporte (una sola vez al inicio)</li>
                            <li>Cada día hábil, registrar cuáles rutas se realizaron</li>
                            <li>Al final del mes, revisar el resumen mensual</li>
                            <li>Usar el resumen como soporte para pagar al proveedor</li>
                        </ol>

                        <div class="tip-box">
                            <i class="bi bi-lightbulb text-success me-2"></i>
                            <strong>Recomendación:</strong> Configura las rutas al inicio del año escolar. Luego, solo 
                            necesitas hacer el registro diario (toma menos de 1 minuto por día). El resumen mensual 
                            se genera automáticamente.
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 4: Gestionar Rutas -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-signpost-2 me-2"></i>
                        Gestionar Rutas de Transporte
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3">¿Qué es una ruta?</h5>
                        <p>
                            Una ruta es un recorrido fijo de transporte de personal. Por ejemplo:
                        </p>
                        <ul>
                            <li><strong>Ruta Norte:</strong> Recoge trabajadores en el norte de la ciudad</li>
                            <li><strong>Ruta Sur:</strong> Recoge trabajadores en el sur de la ciudad</li>
                            <li><strong>Ruta Cajicá:</strong> Recoge trabajadores de municipios cercanos</li>
                        </ul>

                        <p>
                            Cada ruta tiene un vehículo asignado con capacidad específica y un valor por viaje.
                        </p>

                        <h5 class="mt-4 mb-3">Crear una ruta:</h5>
                        <ol>
                            <li>En el panel "Rutas de Transporte", haz clic en el botón para expandirlo</li>
                            <li>Haz clic en <strong>"Nueva Ruta"</strong></li>
                            <li>Completa los campos:
                                <ul>
                                    <li><strong>Nombre de la ruta</strong> (obligatorio): Nombre descriptivo 
                                        (ejemplo: "Ruta Oriente")</li>
                                    <li><strong>Capacidad del vehículo</strong> (obligatorio): Cuántos pasajeros 
                                        caben (ejemplo: 15, 20, 30)</li>
                                    <li><strong>Valor por viaje</strong> (obligatorio): Cuánto cuesta cada recorrido 
                                        según el contrato (ejemplo: $50,000)</li>
                                    <li><strong>Vigente desde</strong> (obligatorio): Fecha en que esta tarifa entró 
                                        en vigor (para trazabilidad)</li>
                                    <li><strong>Activa</strong>: Switch marcado (verde) significa que la ruta está 
                                        activa y aparecerá en el registro diario</li>
                                </ul>
                            </li>
                            <li>Haz clic en <strong>"Guardar"</strong></li>
                        </ol>

                        <h5 class="mt-4 mb-3">Editar una ruta:</h5>
                        <ol>
                            <li>En la tabla de rutas, haz clic en el botón de <strong>editar</strong> (ícono de lápiz)</li>
                            <li>Modifica los campos necesarios</li>
                            <li>Si cambias el valor por viaje, actualiza también "Vigente desde" con la fecha del cambio</li>
                            <li>Para desactivar una ruta que ya no se usa, desmarca el switch "Activa"</li>
                            <li>Guarda los cambios</li>
                        </ol>

                        <div class="warning-box">
                            <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                            <strong>Sobre cambios de tarifa:</strong> Si cambias el "Valor por viaje" de una ruta, 
                            esto NO afecta los registros diarios pasados. Los registros ya guardados mantienen el valor 
                            congelado que tenían al momento de registrarse. El nuevo valor solo aplica para registros futuros.
                        </div>

                        <h5 class="mt-4 mb-3">Campo "Vigente desde":</h5>
                        <p>
                            Este campo documenta desde qué fecha está vigente la tarifa actual. Es importante para:
                        </p>
                        <ul>
                            <li>Auditorías y revisiones de contratos</li>
                            <li>Verificar cuándo se actualizaron las tarifas</li>
                            <li>Justificar costos en diferentes períodos</li>
                        </ul>

                        <h5 class="mt-4 mb-3">Desactivar vs Eliminar:</h5>
                        <p>
                            <strong>NO se pueden eliminar rutas</strong> que tienen registros históricos (para mantener 
                            trazabilidad). Si una ruta ya no se usa:
                        </p>
                        <ul>
                            <li>Desmarca el switch "Activa"</li>
                            <li>La ruta desaparecerá del registro diario</li>
                            <li>Los registros históricos se mantienen</li>
                            <li>La ruta sigue apareciendo en los resúmenes mensuales de meses anteriores</li>
                        </ul>

                        <h5 class="mt-4 mb-3">Buenas prácticas:</h5>
                        <ul>
                            <li>Usa nombres claros y consistentes (Ruta Norte, no "Ruta 1")</li>
                            <li>Actualiza "Vigente desde" cada vez que cambies el valor</li>
                            <li>No desactives rutas a mitad de mes (espera a que termine el mes para claridad en resumen)</li>
                            <li>Revisa anualmente las tarifas con el proveedor y actualiza si es necesario</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 5: Registro Diario -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-calendar-check me-2"></i>
                        Registro Diario
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3">¿Qué es el registro diario?</h5>
                        <p>
                            Es el proceso de marcar, cada día hábil, cuáles rutas se realizaron y cuáles no. 
                            Por ejemplo, si hay un paro de transporte o un día festivo local, algunas rutas pueden 
                            no realizarse y NO deberían cobrarse.
                        </p>

                        <h5 class="mt-4 mb-3">Cómo hacer el registro diario:</h5>
                        <ol>
                            <li><strong>Seleccionar la fecha:</strong> En la sección "Registro Diario", selecciona 
                                la fecha que quieres registrar
                                <ul>
                                    <li>Por defecto aparece la fecha de hoy</li>
                                    <li>Puedes seleccionar fechas pasadas si olvidaste registrar</li>
                                    <li>No puedes registrar fechas futuras</li>
                                </ul>
                            </li>
                            
                            <li><strong>Revisar la lista de rutas:</strong> El sistema muestra todas las rutas activas 
                                en tarjetas, cada una con:
                                <ul>
                                    <li>Nombre de la ruta</li>
                                    <li>Capacidad del vehículo</li>
                                    <li>Valor por viaje</li>
                                    <li>Toggle switch (interruptor) verde/gris</li>
                                    <li>Estado: "✅ Realizado" o "❌ No realizado"</li>
                                </ul>
                            </li>
                            
                            <li><strong>Marcar cada ruta:</strong> Para cada ruta, activa el toggle si se realizó:
                                <ul>
                                    <li><strong>Toggle ACTIVADO (verde):</strong> La ruta se realizó ese día → 
                                        se cobrará en la liquidación</li>
                                    <li><strong>Toggle DESACTIVADO (gris):</strong> La ruta NO se realizó ese día → 
                                        NO se cobrará</li>
                                    <li>Al cambiar el toggle, el texto cambia inmediatamente</li>
                                </ul>
                            </li>
                            
                            <li><strong>Guardar:</strong> Una vez marcaste todas las rutas, haz clic en 
                                <strong>"Guardar Registro del Día"</strong>
                                <ul>
                                    <li>El sistema guarda el estado de TODAS las rutas</li>
                                    <li>Congela el valor de cada ruta al momento de guardar</li>
                                    <li>Aparece un mensaje de confirmación</li>
                                </ul>
                            </li>
                        </ol>

                        <h5 class="mt-4 mb-3">Registro de días anteriores:</h5>
                        <p>
                            Si olvidaste registrar un día pasado:
                        </p>
                        <ol>
                            <li>Selecciona esa fecha en el selector</li>
                            <li>El sistema carga:
                                <ul>
                                    <li>Si YA hay un registro guardado: muestra el estado guardado (puedes modificarlo)</li>
                                    <li>Si NO hay registro: todas las rutas aparecen sin marcar (por defecto "No realizado")</li>
                                </ul>
                            </li>
                            <li>Marca las rutas que se realizaron</li>
                            <li>Guarda</li>
                        </ol>

                        <div class="info-box">
                            <i class="bi bi-info-circle text-info me-2"></i>
                            <strong>¿Puedo corregir un registro pasado?</strong> Sí. Selecciona la fecha, modifica 
                            los toggles según corresponda, y guarda nuevamente. El sistema actualiza el registro.
                        </div>

                        <h5 class="mt-4 mb-3">Casos especiales:</h5>

                        <h6 class="subsection-title">Día festivo o receso:</h6>
                        <ul>
                            <li>Si ninguna ruta operó: deja todos los toggles desactivados y guarda</li>
                            <li>El registro queda como "todas no realizadas" ese día</li>
                            <li>NO se cobra nada ese día</li>
                        </ul>

                        <h6 class="subsection-title">Solo algunas rutas operaron:</h6>
                        <ul>
                            <li>Marca solo las que se realizaron</li>
                            <li>Ejemplo: hubo un problema con el vehículo de la Ruta Norte, solo se realizó Ruta Sur</li>
                            <li>Activas Ruta Sur, dejas Ruta Norte desactivada</li>
                            <li>Solo se cobrará Ruta Sur ese día</li>
                        </ul>

                        <h6 class="subsection-title">No hay rutas activas:</h6>
                        <ul>
                            <li>Si no has creado rutas aún, aparece un mensaje: "No hay rutas activas. Configure rutas primero."</li>
                            <li>Debes ir a la sección de Rutas y crear al menos una</li>
                        </ul>

                        <h5 class="mt-4 mb-3">Flujo diario recomendado:</h5>
                        <ol>
                            <li><strong>Al final del día escolar:</strong> Abre el módulo de Transporte de Personal</li>
                            <li>Verifica que la fecha seleccionada sea el día actual</li>
                            <li>Marca rápidamente las rutas (toma menos de 1 minuto)</li>
                            <li>Guarda</li>
                            <li>Listo para ese día</li>
                        </ol>

                        <div class="tip-box">
                            <i class="bi bi-lightbulb text-success me-2"></i>
                            <strong>Mejor práctica:</strong> Crea un hábito diario de registrar al final de la jornada. 
                            Si esperas varios días, puedes olvidar qué rutas se realizaron o no. Un registro diario 
                            preciso garantiza liquidaciones correctas.
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 6: Resumen Mensual -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-bar-chart me-2"></i>
                        Resumen Mensual y Liquidación
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3">¿Qué es el resumen mensual?</h5>
                        <p>
                            Es un reporte automático que calcula, para un mes específico, cuántos recorridos se 
                            realizaron por cada ruta y el total a pagar al proveedor de transporte.
                        </p>

                        <h5 class="mt-4 mb-3">Generar el resumen mensual:</h5>
                        <ol>
                            <li>En la sección "Resumen Mensual", selecciona:
                                <ul>
                                    <li><strong>Mes:</strong> El mes que quieres revisar (ejemplo: Febrero)</li>
                                    <li><strong>Año:</strong> El año correspondiente (ejemplo: 2026)</li>
                                </ul>
                            </li>
                            <li>El sistema automáticamente:
                                <ul>
                                    <li>Busca todos los registros diarios de ese mes</li>
                                    <li>Cuenta cuántos días cada ruta estuvo marcada como "Realizado"</li>
                                    <li>Multiplica recorridos × valor por viaje</li>
                                    <li>Suma el total del mes</li>
                                </ul>
                            </li>
                            <li>Aparece una tabla con:
                                <ul>
                                    <li><strong>Ruta:</strong> Nombre de cada ruta</li>
                                    <li><strong>Recorridos realizados:</strong> Cuántos días se realizó esa ruta</li>
                                    <li><strong>Valor por viaje:</strong> La tarifa de esa ruta</li>
                                    <li><strong>Subtotal:</strong> Recorridos × Valor (por ruta)</li>
                                    <li><strong>Total del mes:</strong> Suma de todos los subtotales (en verde, destacado)</li>
                                </ul>
                            </li>
                        </ol>

                        <h5 class="mt-4 mb-3">Interpretando el resumen:</h5>

                        <div class="info-box mb-3">
                            <strong>Ejemplo de resumen mensual:</strong>
                            <table class="table table-sm mb-0 mt-2">
                                <thead class="table-light">
                                    <tr>
                                        <th>Ruta</th>
                                        <th>Recorridos realizados</th>
                                        <th>Valor por viaje</th>
                                        <th>Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Ruta Norte</td>
                                        <td>18</td>
                                        <td>$50,000</td>
                                        <td>$900,000</td>
                                    </tr>
                                    <tr>
                                        <td>Ruta Sur</td>
                                        <td>20</td>
                                        <td>$45,000</td>
                                        <td>$900,000</td>
                                    </tr>
                                    <tr>
                                        <td>Ruta Cajicá</td>
                                        <td>15</td>
                                        <td>$60,000</td>
                                        <td>$900,000</td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr class="table-light">
                                        <td colspan="3" class="text-end"><strong>Total del mes:</strong></td>
                                        <td><strong>$2,700,000</strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>

                        <p><strong>Interpretación:</strong></p>
                        <ul>
                            <li>Febrero tuvo aproximadamente 20 días hábiles</li>
                            <li>Ruta Norte: se realizó 18 de 20 días posibles (faltó 2 días, quizás festivos)</li>
                            <li>Ruta Sur: se realizó todos los 20 días</li>
                            <li>Ruta Cajicá: se realizó solo 15 días (quizás algunos viernes no operó)</li>
                            <li><strong>Total a pagar al proveedor: $2,700,000</strong></li>
                        </ul>

                        <h5 class="mt-4 mb-3">Usar el resumen para liquidación:</h5>
                        <ol>
                            <li>Al finalizar el mes, genera el resumen mensual</li>
                            <li>Revisa que los números tengan sentido:
                                <ul>
                                    <li>¿Los días hábiles del mes coinciden con los recorridos?</li>
                                    <li>¿Hubo festivos? ¿Se registraron correctamente?</li>
                                </ul>
                            </li>
                            <li>Toma captura de pantalla o exporta (si la funcionalidad existe)</li>
                            <li>Usa este resumen como soporte oficial para:
                                <ul>
                                    <li>Solicitar el pago al área financiera</li>
                                    <li>Validar la factura del proveedor (debe coincidir)</li>
                                    <li>Archivar como respaldo contable</li>
                                </ul>
                            </li>
                            <li>Procesa el pago al proveedor</li>
                        </ol>

                        <h5 class="mt-4 mb-3">Validación con la factura del proveedor:</h5>
                        <p>
                            El proveedor de transporte debe enviar una factura mensual. El resumen generado por 
                            SchoolNet debe coincidir con esa factura:
                        </p>
                        <ul>
                            <li><strong>Si coinciden:</strong> Perfecto, procede con el pago</li>
                            <li><strong>Si NO coinciden:</strong>
                                <ul>
                                    <li>Revisa los registros diarios uno por uno</li>
                                    <li>Verifica si hubo días sin registrar</li>
                                    <li>Compara con el proveedor cuáles días efectivamente operaron</li>
                                    <li>Corrige los registros necesarios</li>
                                    <li>Regenera el resumen mensual</li>
                                </ul>
                            </li>
                        </ul>

                        <div class="warning-box">
                            <i class="bi bi-exclamation-triangle text-warning me-2"></i>
                            <strong>Importante:</strong> Puedes regenerar el resumen mensual múltiples veces. 
                            Si corriges un registro diario de hace 2 semanas, al volver a generar el resumen mensual, 
                            el cambio se reflejará automáticamente. Por eso es crítico asegurarse de que todos los 
                            días estén bien registrados ANTES de cerrar el mes.
                        </div>

                        <h5 class="mt-4 mb-3">Revisión histórica:</h5>
                        <p>
                            Puedes consultar el resumen de cualquier mes pasado:
                        </p>
                        <ul>
                            <li>Selecciona el mes y año deseado</li>
                            <li>El sistema muestra el resumen de ese período</li>
                            <li>Útil para auditorías, comparaciones año a año, presupuestos</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 7: Solución de problemas -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-question-circle me-2"></i>
                        Solución de problemas comunes
                    </h2>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-exclamation-circle me-2"></i>
                            Al seleccionar una fecha, no aparecen rutas, solo un mensaje: "No hay rutas activas"
                        </div>
                        <p><strong>Causa:</strong></p>
                        <p>No hay rutas creadas o todas las rutas están inactivas.</p>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>Ve a la sección "Rutas de Transporte"</li>
                            <li>Crea al menos una ruta</li>
                            <li>Asegúrate de que el switch "Activa" esté marcado</li>
                            <li>Regresa al Registro Diario y recarga la fecha</li>
                        </ul>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-exclamation-circle me-2"></i>
                            El resumen mensual muestra $0 o no aparecen datos
                        </div>
                        <p><strong>Causas posibles:</strong></p>
                        <ul>
                            <li>No se han hecho registros diarios en ese mes</li>
                            <li>Todos los registros del mes marcaron las rutas como "No realizado"</li>
                            <li>No hay rutas configuradas</li>
                        </ul>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>Verifica que existan rutas creadas</li>
                            <li>Ve al Registro Diario y selecciona fechas de ese mes para verificar si hay registros</li>
                            <li>Si no hay registros, realiza los registros diarios de los días que faltan</li>
                            <li>Regenera el resumen mensual</li>
                        </ul>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-exclamation-circle me-2"></i>
                            El total del resumen mensual no coincide con la factura del proveedor
                        </div>
                        <p><strong>Causa más común:</strong></p>
                        <p>Hay días sin registrar o registros incorrectos.</p>
                        <p><strong>Solución paso a paso:</strong></p>
                        <ol>
                            <li>Identifica el mes en cuestión</li>
                            <li>Haz una lista de todos los días hábiles de ese mes (ejemplo: 1, 2, 3... 20)</li>
                            <li>Ve al Registro Diario y selecciona cada fecha:
                                <ul>
                                    <li>Si hay registro guardado, verifica que esté correcto</li>
                                    <li>Si NO hay registro, créalo con los datos correctos</li>
                                </ul>
                            </li>
                            <li>Después de revisar todos los días, regenera el resumen mensual</li>
                            <li>Compara nuevamente con la factura</li>
                        </ol>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-exclamation-circle me-2"></i>
                            Cambié el valor de una ruta y los registros pasados cambiaron de total
                        </div>
                        <p><strong>Causa:</strong></p>
                        <p>Esto NO debería pasar. Los registros congelan el valor al momento de guardarse.</p>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>Verifica que realmente cambió (regenera el resumen mensual del mes afectado)</li>
                            <li>Si efectivamente cambió, es un bug del sistema</li>
                            <li>Reporta el problema al administrador inmediatamente</li>
                            <li>Como medida temporal, no cambies valores de rutas hasta que se solucione</li>
                        </ul>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-exclamation-circle me-2"></i>
                            Necesito eliminar una ruta pero el sistema no me deja
                        </div>
                        <p><strong>Causa:</strong></p>
                        <p>La ruta tiene registros históricos y no se puede eliminar (política de trazabilidad).</p>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>En lugar de eliminarla, desactívala</li>
                            <li>Edita la ruta y desmarca el switch "Activa"</li>
                            <li>La ruta ya no aparecerá en registros diarios futuros</li>
                            <li>Los registros históricos se mantienen intactos</li>
                        </ul>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-exclamation-circle me-2"></i>
                            Olvidé registrar varios días del mes pasado, ¿puedo hacerlo ahora?
                        </div>
                        <p><strong>Respuesta:</strong></p>
                        <p>Sí, puedes registrar días pasados en cualquier momento.</p>
                        <p><strong>Cómo hacerlo:</strong></p>
                        <ul>
                            <li>Ve al Registro Diario</li>
                            <li>Selecciona cada fecha que olvidaste</li>
                            <li>Marca las rutas según lo que ocurrió ese día (consulta con el proveedor si no recuerdas)</li>
                            <li>Guarda cada día</li>
                            <li>Al finalizar, genera el resumen del mes para ver el total actualizado</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 8: Buenas prácticas -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-award me-2"></i>
                        Buenas prácticas
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3">Recomendaciones para gestionar el transporte de personal eficientemente:</h5>

                        <div class="tip-box mb-3">
                            <strong>1. Registra diariamente, no semanalmente</strong>
                            <p class="mb-0">
                                Es tentador esperar al viernes para registrar toda la semana de una vez, pero:
                            </p>
                            <ul class="mt-2 mb-0">
                                <li>Puedes olvidar qué días hubo problemas con rutas específicas</li>
                                <li>El registro diario (1 minuto) es más preciso que el semanal (propenso a errores)</li>
                                <li>Si hay discrepancias con el proveedor, tienes respaldo día a día</li>
                            </ul>
                        </div>

                        <div class="tip-box mb-3">
                            <strong>2. Documenta incidencias en otro sistema</strong>
                            <p class="mb-0">
                                Este módulo solo marca "realizado" o "no realizado", no documenta POR QUÉ. Si hubo un 
                                problema (vehículo averiado, paro, conductor no llegó):
                            </p>
                            <ul class="mt-2 mb-0">
                                <li>Registra el motivo en un archivo externo (email, documento compartido, sistema de tickets)</li>
                                <li>Esto es útil si el proveedor disputa la factura</li>
                            </ul>
                        </div>

                        <div class="tip-box mb-3">
                            <strong>3. Compara el resumen mensual con el mes anterior</strong>
                            <p class="mb-0">
                                Al generar el resumen de un mes:
                            </p>
                            <ul class="mt-2 mb-0">
                                <li>Genera también el resumen del mes anterior</li>
                                <li>Compara los totales</li>
                                <li>Si hay una diferencia muy grande (>20%), investiga por qué</li>
                                <li>Puede ser legítimo (más festivos) o puede indicar registros incorrectos</li>
                            </ul>
                        </div>

                        <div class="tip-box mb-3">
                            <strong>4. Actualiza "Vigente desde" al cambiar tarifas</strong>
                            <p class="mb-0">
                                Si el proveedor sube (o baja) tarifas:
                            </p>
                            <ul class="mt-2 mb-0">
                                <li>Edita la ruta</li>
                                <li>Cambia el "Valor por viaje"</li>
                                <li>Actualiza "Vigente desde" con la fecha exacta del cambio</li>
                                <li>Esto es crítico para auditorías y contratos</li>
                            </ul>
                        </div>

                        <div class="tip-box mb-3">
                            <strong>5. Cierra el mes a tiempo</strong>
                            <p class="mb-0">
                                Al terminar cada mes:
                            </p>
                            <ul class="mt-2 mb-0">
                                <li>Verifica que TODOS los días hábiles del mes estén registrados</li>
                                <li>Genera el resumen mensual</li>
                                <li>Compara con la factura del proveedor</li>
                                <li>Resuelve discrepancias ANTES de cerrar contablemente el mes</li>
                            </ul>
                        </div>

                        <div class="tip-box mb-3">
                            <strong>6. Comunica cambios al equipo</strong>
                            <p class="mb-0">
                                Si cambias algo en las rutas (nueva ruta, ruta desactivada, cambio de tarifa):
                            </p>
                            <ul class="mt-2 mb-0">
                                <li>Comunícalo al equipo que hace el registro diario</li>
                                <li>Evita sorpresas a fin de mes</li>
                            </ul>
                        </div>

                        <div class="tip-box mb-3">
                            <strong>7. No desactives rutas a mitad de mes</strong>
                            <p class="mb-0">
                                Si una ruta va a dejar de operar:
                            </p>
                            <ul class="mt-2 mb-0">
                                <li>Espera a que termine el mes en curso</li>
                                <li>Al inicio del siguiente mes, desactívala</li>
                                <li>Esto evita confusión en el resumen mensual</li>
                            </ul>
                        </div>

                        <div class="tip-box mb-0">
                            <strong>8. Guarda capturas de pantalla de los resúmenes</strong>
                            <p class="mb-0">
                                Cada mes, después de validar el resumen:
                            </p>
                            <ul class="mt-2 mb-0">
                                <li>Toma captura de pantalla de la tabla completa</li>
                                <li>Guárdala en una carpeta por año fiscal</li>
                                <li>Esto sirve como respaldo si hay problemas con el sistema</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 9: Preguntas frecuentes -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-chat-dots me-2"></i>
                        Preguntas frecuentes
                    </h2>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿Qué pasa si hay dos rutas con el mismo nombre?
                        </div>
                        <p>
                            El sistema lo permite, pero NO es recomendable porque genera confusión. Usa nombres únicos 
                            para cada ruta (ejemplo: Ruta Norte 1, Ruta Norte 2, si realmente hay dos rutas diferentes 
                            hacia el norte).
                        </p>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿Puedo tener rutas con diferentes valores dependiendo del día de la semana?
                        </div>
                        <p>
                            El sistema actual NO soporta tarifas diferenciadas por día. Si tu contrato tiene tarifas 
                            variables (ejemplo: lunes-jueves $50,000, viernes $45,000), tendrías que crear dos rutas 
                            separadas: "Ruta Norte L-J" y "Ruta Norte Viernes", y marcar la correspondiente cada día.
                        </p>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿El sistema descuenta automáticamente los festivos?
                        </div>
                        <p>
                            No. El sistema NO sabe cuáles días son festivos. Tú debes registrar esos días manualmente 
                            marcando todas las rutas como "No realizado". O simplemente NO registres ese día (por defecto 
                            un día sin registro cuenta como no realizado).
                        </p>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿Qué pasa si olvido registrar un día y ya cerré el mes?
                        </div>
                        <p>
                            Puedes corregirlo en cualquier momento:
                        </p>
                        <ul>
                            <li>Ve al Registro Diario</li>
                            <li>Selecciona la fecha olvidada</li>
                            <li>Regístrala correctamente</li>
                            <li>Regenera el resumen mensual de ese mes</li>
                            <li>El total se actualizará</li>
                        </ul>
                        <p>
                            Sin embargo, si ya PAGASTE la factura, tendrías que gestionar un ajuste contable para el 
                            siguiente mes.
                        </p>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿Puedo exportar el resumen mensual a Excel?
                        </div>
                        <p>
                            En la versión actual, no hay botón de exportación directo. Puedes:
                        </p>
                        <ul>
                            <li>Tomar captura de pantalla</li>
                            <li>Copiar manualmente los datos a Excel</li>
                            <li>Solicitar al administrador que agregue funcionalidad de exportación</li>
                        </ul>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿Por qué algunos meses tienen más recorridos que otros?
                        </div>
                        <p>
                            Depende de los días hábiles del mes:
                        </p>
                        <ul>
                            <li>Febrero: ~18-19 días hábiles (es más corto)</li>
                            <li>Marzo/Mayo: ~22-23 días hábiles</li>
                            <li>Meses con festivos: menos días efectivos</li>
                            <li>Meses con recesos escolares: pueden tener menos recorridos si el transporte no opera</li>
                        </ul>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿El valor "congelado" significa que nunca puedo cambiar la tarifa?
                        </div>
                        <p>
                            No. Significa que los registros YA guardados mantienen el valor que tenían al momento de 
                            registrarse. Puedes cambiar la tarifa de una ruta en cualquier momento:
                        </p>
                        <ul>
                            <li>Registros pasados: mantienen el valor antiguo (congelado)</li>
                            <li>Registros futuros: usarán el valor nuevo</li>
                        </ul>
                        <p>
                            Esto es correcto porque si el proveedor sube tarifas a mitad de mes, los días anteriores 
                            deben cobrarse al precio antiguo.
                        </p>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿Puedo ver quién hizo cada registro diario?
                        </div>
                        <p>
                            El sistema guarda quién registró cada día (campo "recorded_by"), pero esta información NO 
                            está visible en la interfaz actual. Si necesitas auditar quién registró qué, contacta al 
                            administrador para que consulte la base de datos directamente.
                        </p>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿Qué diferencia hay entre el "Valor por viaje" de la ruta y el "frozen_trip_value" del registro?
                        </div>
                        <p>
                            <strong>Valor por viaje (ruta):</strong> Es la tarifa ACTUAL de la ruta. Puede cambiar en 
                            cualquier momento.<br>
                            <strong>frozen_trip_value (registro):</strong> Es el valor que tenía la ruta el día que se 
                            hizo el registro. Este valor NUNCA cambia, incluso si después editas la ruta.<br><br>
                            Por eso el resumen mensual usa el frozen_trip_value de cada registro, no el valor actual de la ruta.
                        </p>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            ¿Puedo usar este módulo para transportes de estudiantes?
                        </div>
                        <p>
                            No. Este módulo es exclusivamente para transporte de <strong>personal (trabajadores)</strong>. 
                            Los transportes de estudiantes se gestionan en otros módulos:
                        </p>
                        <ul>
                            <li>Transporte Extracurricular: para clases extras</li>
                            <li>Salidas Pedagógicas: para salidas por grado</li>
                            <li>Salidas Deportivas: para equipos deportivos</li>
                        </ul>
                    </div>
                </section>

                <!-- TARJETA PARA REPORTAR BUGS -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../report-bug.html" class="btn btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Servicios',
            modulePath: 'services',
            pageTitle: 'Transporte de Personal',
            pagePath: 'staff-transport.html',
            moduleDescription: 'Rutas de transporte, registro diario y resumen mensual para liquidación'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            // Actualizar title
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
