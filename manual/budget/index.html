<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="25.12.12.10.30">
    
    <title>Manual - Presupuesto - Índice del Módulo - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Tarjeta para reportar bugs */
        .bug-report-card {
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        /* Botón flotante para reportar bugs */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #dc3545) !important;
            border-color: var(--system-primary-color, #dc3545) !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Cajas de información */
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #0d6efd;
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .success-box {
            background: #d1e7dd;
            border-left: 4px solid #198754;
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .danger-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        /* Secciones */
        .manual-section {
            margin-bottom: 2.5rem;
        }

        .manual-section h2 {
            color: var(--system-primary-color, #1B365D);
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 0.5rem;
            margin-bottom: 1.25rem;
        }

        .manual-section h5 {
            color: #495057;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }

        /* FAQ - Acordeón */
        .faq-section .accordion-button:not(.collapsed) {
            background-color: #e7f3ff;
            color: var(--system-primary-color, #1B365D);
        }

        .faq-section .accordion-button:focus {
            box-shadow: none;
            border-color: rgba(0,0,0,.125);
        }

        /* Tarjetas de funciones */
        .function-list-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
        }

        .function-list-card:hover {
            border-color: #0d6efd;
            background-color: #f8f9fa;
        }

        .function-list-card a {
            text-decoration: none;
            color: inherit;
        }

        .function-list-card .function-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .function-list-card .function-desc {
            font-size: 0.875rem;
            color: #6c757d;
            margin-bottom: 0;
        }

        .function-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background-color: #cfe2ff;
            color: #0d6efd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        /* Grupo de funciones */
        .function-group {
            margin-bottom: 2rem;
        }

        .function-group-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #dee2e6;
        }

        /* Métricas explicadas */
        .metric-explanation {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .metric-explanation .metric-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background-color: #cfe2ff;
            color: #0d6efd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .metric-explanation .metric-info h6 {
            margin-bottom: 0.25rem;
            color: #2c3e50;
        }

        .metric-explanation .metric-info p {
            margin-bottom: 0;
            font-size: 0.9rem;
            color: #6c757d;
        }

        /* Tabla de permisos */
        .permissions-table {
            font-size: 0.9rem;
        }

        .permissions-table th {
            background-color: #f8f9fa;
        }

        /* Flujo visual */
        .workflow-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 1.5rem 0;
        }

        .workflow-step {
            background: white;
            border: 2px solid #0d6efd;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            text-align: center;
            min-width: 120px;
        }

        .workflow-step .step-number {
            font-size: 0.75rem;
            color: #6c757d;
            display: block;
        }

        .workflow-step .step-name {
            font-weight: 600;
            color: #0d6efd;
        }

        .workflow-arrow {
            color: #0d6efd;
            font-size: 1.5rem;
        }

        @media (max-width: 768px) {
            .workflow-container {
                flex-direction: column;
            }
            .workflow-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Presupuesto
                        </h1>
                        <p class="subtitle mb-0">Índice del Módulo - Gestión presupuestal y financiera</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/budget/index.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-8 mx-auto">

                <!-- ========================================== -->
                <!-- SECCIÓN: ¿QUÉ ES EL MÓDULO? -->
                <!-- ========================================== -->
                <div class="manual-section">
                    <h2><i class="bi bi-calculator me-2"></i>¿Qué es el Módulo de Presupuesto?</h2>
                    
                    <p>
                        El <strong>Módulo de Presupuesto</strong> es el centro de gestión financiera 
                        y presupuestal de la institución. Desde aquí se administra todo el ciclo 
                        presupuestal: desde la configuración inicial de cuentas y rubros, pasando 
                        por la asignación de recursos, hasta la ejecución y seguimiento del gasto.
                    </p>
                    
                    <p>
                        Este módulo está diseñado para que diferentes personas de la institución 
                        participen en el proceso presupuestal según su rol: administradores 
                        financieros configuran la estructura, responsables de área solicitan 
                        recursos, autorizadores aprueban gastos, y todos pueden consultar el 
                        estado de sus asignaciones.
                    </p>

                    <div class="info-box">
                        <strong><i class="bi bi-lightbulb me-2"></i>¿Cómo funciona el presupuesto?</strong><br>
                        El proceso sigue un flujo ordenado: primero se configura la estructura 
                        (cuentas, rubros, sub-ítems), luego se inicializa el año creando las 
                        asignaciones, después cada responsable solicita lo que necesita, se 
                        aprueban los valores, y finalmente se ejecuta el gasto mediante 
                        solicitudes de ejecución.
                    </div>

                    <!-- Flujo visual del presupuesto -->
                    <h5>Ciclo presupuestal simplificado</h5>
                    <div class="workflow-container">
                        <div class="workflow-step">
                            <span class="step-number">Paso 1</span>
                            <span class="step-name">Configurar</span>
                        </div>
                        <i class="bi bi-arrow-right workflow-arrow"></i>
                        <div class="workflow-step">
                            <span class="step-number">Paso 2</span>
                            <span class="step-name">Inicializar</span>
                        </div>
                        <i class="bi bi-arrow-right workflow-arrow"></i>
                        <div class="workflow-step">
                            <span class="step-number">Paso 3</span>
                            <span class="step-name">Solicitar</span>
                        </div>
                        <i class="bi bi-arrow-right workflow-arrow"></i>
                        <div class="workflow-step">
                            <span class="step-number">Paso 4</span>
                            <span class="step-name">Aprobar</span>
                        </div>
                        <i class="bi bi-arrow-right workflow-arrow"></i>
                        <div class="workflow-step">
                            <span class="step-number">Paso 5</span>
                            <span class="step-name">Ejecutar</span>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- SECCIÓN: MÉTRICAS DEL MÓDULO -->
                <!-- ========================================== -->
                <div class="manual-section">
                    <h2><i class="bi bi-graph-up me-2"></i>Métricas del Módulo</h2>
                    
                    <p>
                        Al ingresar al módulo, verás un panel con <strong>cuatro indicadores</strong> 
                        que muestran el estado general del presupuesto. Estas métricas se cargan 
                        al hacer clic en el botón <strong>"Cargar Métricas"</strong>.
                    </p>

                    <div class="warning-box">
                        <strong><i class="bi bi-eye me-2"></i>Visibilidad de métricas:</strong><br>
                        Las métricas solo son visibles para usuarios con roles específicos 
                        (Estrategas, Gestor de Presupuesto, Autorizador de presupuesto). 
                        Si no tienes estos roles, la sección de métricas puede no mostrarse 
                        o aparecer vacía.
                    </div>

                    <div class="metric-explanation">
                        <div class="metric-icon">
                            <i class="bi bi-cash-stack"></i>
                        </div>
                        <div class="metric-info">
                            <h6>Presupuesto Total</h6>
                            <p>
                                Suma de todos los valores aprobados para las asignaciones activas 
                                del año presupuestal vigente. Representa el total de recursos 
                                disponibles para la institución.
                            </p>
                        </div>
                    </div>

                    <div class="metric-explanation">
                        <div class="metric-icon">
                            <i class="bi bi-graph-up-arrow"></i>
                        </div>
                        <div class="metric-info">
                            <h6>Valor Ejecutado</h6>
                            <p>
                                Suma de todos los valores que ya han sido ejecutados (gastados) 
                                de las asignaciones. Indica cuánto del presupuesto ya se ha 
                                utilizado.
                            </p>
                        </div>
                    </div>

                    <div class="metric-explanation">
                        <div class="metric-icon">
                            <i class="bi bi-percent"></i>
                        </div>
                        <div class="metric-info">
                            <h6>% de Ejecución</h6>
                            <p>
                                Porcentaje del presupuesto que ya se ha ejecutado. Se calcula 
                                dividiendo el valor ejecutado entre el presupuesto total. 
                                Permite ver qué tan avanzado está el gasto respecto a lo aprobado.
                            </p>
                        </div>
                    </div>

                    <div class="metric-explanation">
                        <div class="metric-icon">
                            <i class="bi bi-hourglass-split"></i>
                        </div>
                        <div class="metric-info">
                            <h6>Solicitudes Pendientes</h6>
                            <p>
                                Cantidad de solicitudes de ejecución que están esperando 
                                ser revisadas y aprobadas. Un número alto puede indicar 
                                que hay trabajo pendiente de autorización.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- SECCIÓN: FUNCIONES DISPONIBLES -->
                <!-- ========================================== -->
                <div class="manual-section">
                    <h2><i class="bi bi-grid-3x3-gap me-2"></i>Funciones Disponibles</h2>
                    
                    <p>
                        El módulo de Presupuesto contiene <strong>23 funciones</strong> organizadas 
                        en dos grupos: <strong>Administración</strong> (para configuración y gestión) 
                        y <strong>Operación</strong> (para el uso diario del presupuesto).
                    </p>

                    <div class="info-box">
                        <strong><i class="bi bi-shield-lock me-2"></i>Sobre los permisos:</strong><br>
                        Solo verás las funciones para las que tienes permiso. Si una función 
                        no aparece en tu pantalla, es porque tu usuario no tiene el permiso 
                        correspondiente. Contacta al administrador si crees que deberías tener acceso.
                    </div>

                    <!-- GRUPO: ADMINISTRACIÓN -->
                    <div class="function-group">
                        <h5 class="function-group-title">
                            <i class="bi bi-gear me-2"></i>Administración
                        </h5>
                        <p class="text-muted small mb-3">
                            Funciones para configurar y mantener la estructura del presupuesto. 
                            Generalmente usadas por el área financiera y administradores.
                        </p>

                        <!-- Función 1 -->
                        <div class="function-list-card">
                            <a href="chart-of-accounts.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-list-ol"></i>
                                </div>
                                <div>
                                    <div class="function-name">Gestionar PUC</div>
                                    <p class="function-desc">
                                        Administra el Plan Único de Cuentas contable. Permite crear, 
                                        editar y consultar las cuentas que clasifican los movimientos financieros.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 2 -->
                        <div class="function-list-card">
                            <a href="upload-combo.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-upload"></i>
                                </div>
                                <div>
                                    <div class="function-name">Subir el Combo</div>
                                    <p class="function-desc">
                                        Carga masiva de movimientos contables desde archivos externos. 
                                        Permite importar datos del sistema contable.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 3 -->
                        <div class="function-list-card">
                            <a href="tax-types.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-receipt"></i>
                                </div>
                                <div>
                                    <div class="function-name">Gestionar IVA Asociado</div>
                                    <p class="function-desc">
                                        Configura los tipos de impuesto (IVA) que se asocian a las 
                                        transacciones presupuestales.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 4 -->
                        <div class="function-list-card">
                            <a href="budget-categories.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-folder"></i>
                                </div>
                                <div>
                                    <div class="function-name">Gestionar Rubros</div>
                                    <p class="function-desc">
                                        Administra las categorías presupuestales principales (rubros). 
                                        Define si están asociados a matrícula o son autosostenibles.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 5 -->
                        <div class="function-list-card">
                            <a href="budget-items.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-tag"></i>
                                </div>
                                <div>
                                    <div class="function-name">Gestionar Subítems</div>
                                    <p class="function-desc">
                                        Crea y administra las líneas presupuestales detalladas (sub-ítems) 
                                        que se agrupan bajo cada rubro.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 6 -->
                        <div class="function-list-card">
                            <a href="suppliers.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-truck"></i>
                                </div>
                                <div>
                                    <div class="function-name">Gestionar Proveedores</div>
                                    <p class="function-desc">
                                        Mantiene la base de datos de proveedores de la institución. 
                                        Información de contacto, NIT y datos fiscales.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 7 -->
                        <div class="function-list-card">
                            <a href="initialize-budget-year.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-calendar-plus"></i>
                                </div>
                                <div>
                                    <div class="function-name">Inicializar Año Presupuestal</div>
                                    <p class="function-desc">
                                        Crea automáticamente todas las asignaciones presupuestales para 
                                        un nuevo año, combinando sub-ítems con secciones, grados y áreas.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 8 -->
                        <div class="function-list-card">
                            <a href="initialize-budget-general.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-gear"></i>
                                </div>
                                <div>
                                    <div class="function-name">Inicializar Año - Generales</div>
                                    <p class="function-desc">
                                        Configuración general del presupuesto para el año. Complementa 
                                        la inicialización con parámetros adicionales.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 9 -->
                        <div class="function-list-card">
                            <a href="budget-authorization.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-check-circle"></i>
                                </div>
                                <div>
                                    <div class="function-name">Autorización de Presupuesto</div>
                                    <p class="function-desc">
                                        Aprueba los valores presupuestales para cada asignación. 
                                        Convierte las solicitudes en montos aprobados para ejecución.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 10 -->
                        <div class="function-list-card">
                            <a href="associate-invoices.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-file-earmark-text"></i>
                                </div>
                                <div>
                                    <div class="function-name">Asociar Facturas</div>
                                    <p class="function-desc">
                                        Vincula las facturas de proveedores con las solicitudes de 
                                        ejecución correspondientes para control contable.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 11 -->
                        <div class="function-list-card">
                            <a href="report-design.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-file-bar-graph"></i>
                                </div>
                                <div>
                                    <div class="function-name">Diseño de Informes</div>
                                    <p class="function-desc">
                                        Configura la estructura y formato de los reportes presupuestales 
                                        que se generan en el sistema.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 12 -->
                        <div class="function-list-card">
                            <a href="assignments-report.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-clipboard-data"></i>
                                </div>
                                <div>
                                    <div class="function-name">Informe de Asignaciones</div>
                                    <p class="function-desc">
                                        Genera reportes detallados sobre la distribución del presupuesto 
                                        entre las diferentes asignaciones.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 13 -->
                        <div class="function-list-card">
                            <a href="accounting-crosscheck.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-arrow-left-right"></i>
                                </div>
                                <div>
                                    <div class="function-name">Cruce Contable</div>
                                    <p class="function-desc">
                                        Verifica y concilia la información presupuestal con los 
                                        registros contables del sistema financiero.
                                    </p>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- GRUPO: OPERACIÓN -->
                    <div class="function-group">
                        <h5 class="function-group-title">
                            <i class="bi bi-play-circle me-2"></i>Operación
                        </h5>
                        <p class="text-muted small mb-3">
                            Funciones para el uso diario del presupuesto. Solicitar recursos, 
                            ejecutar gastos, aprobar solicitudes y consultar información.
                        </p>

                        <!-- Función 14 -->
                        <div class="function-list-card">
                            <a href="budget-request.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-file-earmark-plus"></i>
                                </div>
                                <div>
                                    <div class="function-name">Petición de Presupuesto</div>
                                    <p class="function-desc">
                                        Permite a cada responsable indicar cuánto dinero necesita 
                                        para sus asignaciones. Primer paso del ciclo presupuestal.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 15 -->
                        <div class="function-list-card">
                            <a href="assign-requesters.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-person-add"></i>
                                </div>
                                <div>
                                    <div class="function-name">Designar Solicitantes</div>
                                    <p class="function-desc">
                                        Autoriza a usuarios específicos para que puedan crear 
                                        solicitudes de ejecución en determinadas asignaciones.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 16 -->
                        <div class="function-list-card">
                            <a href="execution-request.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-play-circle"></i>
                                </div>
                                <div>
                                    <div class="function-name">Solicitud de Ejecución</div>
                                    <p class="function-desc">
                                        Crea solicitudes para gastar el presupuesto aprobado. 
                                        Incluye detalle del gasto, proveedor y monto requerido.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 17 -->
                        <div class="function-list-card">
                            <a href="request-resolution.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-check2-square"></i>
                                </div>
                                <div>
                                    <div class="function-name">Resolución de Solicitudes</div>
                                    <p class="function-desc">
                                        Permite a los autorizadores aprobar o rechazar las 
                                        solicitudes de ejecución pendientes.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 18 -->
                        <div class="function-list-card">
                            <a href="close-overruns.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-exclamation-triangle"></i>
                                </div>
                                <div>
                                    <div class="function-name">Cerrar Sobreejecuciones</div>
                                    <p class="function-desc">
                                        Gestiona los casos donde el gasto excedió el presupuesto 
                                        aprobado. Permite autorizar y cerrar estos requerimientos.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 19 -->
                        <div class="function-list-card">
                            <a href="budget-transfer.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-arrow-repeat"></i>
                                </div>
                                <div>
                                    <div class="function-name">Iniciar Traslado</div>
                                    <p class="function-desc">
                                        Solicita mover dinero de una asignación a otra cuando 
                                        hay recursos disponibles que se necesitan en otro concepto.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 20 -->
                        <div class="function-list-card">
                            <a href="close-transfer.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-arrow-right-square"></i>
                                </div>
                                <div>
                                    <div class="function-name">Cerrar Traslado</div>
                                    <p class="function-desc">
                                        Finaliza los traslados presupuestales pendientes. 
                                        Aprueba o rechaza las solicitudes de traslado.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 21 -->
                        <div class="function-list-card">
                            <a href="category-detail.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-zoom-in"></i>
                                </div>
                                <div>
                                    <div class="function-name">Vista Detallada por Rubro</div>
                                    <p class="function-desc">
                                        Muestra el análisis detallado del presupuesto organizado 
                                        por categoría presupuestal (rubro).
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 22 -->
                        <div class="function-list-card">
                            <a href="budget-overview.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-eye"></i>
                                </div>
                                <div>
                                    <div class="function-name">Vista Particular</div>
                                    <p class="function-desc">
                                        Muestra una vista personalizada del presupuesto según 
                                        las asignaciones del usuario actual.
                                    </p>
                                </div>
                            </a>
                        </div>

                        <!-- Función 23 -->
                        <div class="function-list-card">
                            <a href="budget-queries.html" class="d-flex align-items-center gap-3">
                                <div class="function-icon">
                                    <i class="bi bi-search"></i>
                                </div>
                                <div>
                                    <div class="function-name">Consultas de Presupuesto</div>
                                    <p class="function-desc">
                                        Búsquedas y reportes generales sobre el estado del 
                                        presupuesto, ejecución y asignaciones.
                                    </p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- SECCIÓN: NAVEGACIÓN -->
                <!-- ========================================== -->
                <div class="manual-section">
                    <h2><i class="bi bi-signpost-2 me-2"></i>Navegación en el Módulo</h2>
                    
                    <p>
                        El módulo de Presupuesto está organizado para facilitar tu trabajo:
                    </p>

                    <h5>Elementos de la página principal</h5>
                    <ul>
                        <li>
                            <strong>Breadcrumbs (migas de pan):</strong> En la parte superior 
                            encuentras la ruta de navegación. Puedes hacer clic en "Dashboard" 
                            para volver al inicio del sistema.
                        </li>
                        <li>
                            <strong>Badge del año presupuestal:</strong> Muestra el año 
                            presupuestal vigente configurado en el sistema.
                        </li>
                        <li>
                            <strong>Botón "Cargar Métricas":</strong> Las métricas no se cargan 
                            automáticamente para optimizar el rendimiento. Haz clic en este 
                            botón para ver los indicadores.
                        </li>
                        <li>
                            <strong>Tarjetas de funciones:</strong> Cada función se presenta 
                            en una tarjeta con icono, nombre y descripción breve. Haz clic 
                            en la tarjeta para acceder a la función.
                        </li>
                    </ul>

                    <h5>Cómo acceder a cada función</h5>
                    <p>
                        Simplemente haz clic en la tarjeta de la función que necesitas. 
                        Si la tarjeta no aparece, significa que no tienes el permiso 
                        correspondiente.
                    </p>

                    <div class="success-box">
                        <strong><i class="bi bi-book me-2"></i>Manuales específicos:</strong><br>
                        Cada función tiene su propio manual con instrucciones detalladas. 
                        Dentro de cada función encontrarás un botón de ayuda o podrás 
                        acceder al manual correspondiente desde la sección "Funciones 
                        Disponibles" de esta página.
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- SECCIÓN: PERMISOS Y ACCESO -->
                <!-- ========================================== -->
                <div class="manual-section">
                    <h2><i class="bi bi-shield-lock me-2"></i>Permisos y Acceso</h2>
                    
                    <p>
                        El acceso a las funciones del módulo está controlado por permisos. 
                        Cada función requiere un permiso específico que debe estar asignado 
                        a tu usuario o a uno de tus roles.
                    </p>

                    <h5>Roles típicos del módulo de Presupuesto</h5>
                    
                    <table class="table table-bordered permissions-table">
                        <thead>
                            <tr>
                                <th>Rol</th>
                                <th>Funciones típicas</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Gestor de Presupuesto</strong></td>
                                <td>
                                    Acceso completo a configuración: PUC, rubros, sub-ítems, 
                                    proveedores, inicialización, autorización, informes.
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Autorizador de Presupuesto</strong></td>
                                <td>
                                    Autorización de presupuesto, resolución de solicitudes, 
                                    cerrar traslados y sobreejecuciones, vistas y consultas.
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Solicitante</strong></td>
                                <td>
                                    Petición de presupuesto, solicitud de ejecución, 
                                    iniciar traslados, vista particular.
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Estrategas</strong></td>
                                <td>
                                    Vistas y consultas, métricas del módulo, informes 
                                    de asignaciones.
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="warning-box">
                        <strong><i class="bi bi-person-gear me-2"></i>¿Necesitas más permisos?</strong><br>
                        Si crees que deberías tener acceso a alguna función que no ves, 
                        contacta al administrador del sistema. Los permisos se asignan 
                        desde el módulo de Seguridad.
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- SECCIÓN: PREGUNTAS FRECUENTES -->
                <!-- ========================================== -->
                <div class="manual-section faq-section">
                    <h2><i class="bi bi-question-circle me-2"></i>Preguntas Frecuentes</h2>

                    <div class="accordion" id="faqAccordion">
                        
                        <!-- FAQ 1 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq1">
                                    ¿Por qué no veo ninguna función en el módulo?
                                </button>
                            </h2>
                            <div id="faq1" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Si no ves funciones, es porque tu usuario no tiene permisos 
                                    asignados para este módulo. Contacta al administrador del 
                                    sistema para que te asigne los permisos correspondientes 
                                    según tu rol en la institución.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 2 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq2">
                                    ¿Qué debo hacer primero si soy nuevo en el módulo?
                                </button>
                            </h2>
                            <div id="faq2" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Depende de tu rol. Si eres <strong>responsable de área</strong>, 
                                    comienza por "Petición de Presupuesto" para indicar cuánto 
                                    necesitas. Si eres <strong>administrador financiero</strong>, 
                                    verifica que la estructura esté configurada (rubros, sub-ítems) 
                                    y que el año esté inicializado.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 3 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq3">
                                    ¿Las métricas se actualizan automáticamente?
                                </button>
                            </h2>
                            <div id="faq3" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    No. Para optimizar el rendimiento, las métricas se cargan 
                                    solo cuando haces clic en el botón "Cargar Métricas". 
                                    Si quieres ver los datos actualizados después de hacer 
                                    cambios, haz clic en "Actualizar Métricas".
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 4 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq4">
                                    ¿Cuál es la diferencia entre "Petición" y "Solicitud de Ejecución"?
                                </button>
                            </h2>
                            <div id="faq4" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <strong>Petición de Presupuesto:</strong> Es cuando indicas 
                                    cuánto dinero necesitas para el año. Es la planificación inicial.<br><br>
                                    <strong>Solicitud de Ejecución:</strong> Es cuando ya tienes 
                                    presupuesto aprobado y necesitas usarlo para un gasto específico. 
                                    Es el momento de ejecutar.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 5 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq5">
                                    ¿Puedo ver el presupuesto de otras áreas?
                                </button>
                            </h2>
                            <div id="faq5" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Depende de tus permisos. Los usuarios con roles de 
                                    <strong>Estrategas</strong> o <strong>Gestor de Presupuesto</strong> 
                                    pueden ver información general. Los usuarios con rol de 
                                    <strong>Autorizador</strong> ven solo sus asignaciones. 
                                    En "Vista Particular" cada quien ve únicamente su propio presupuesto.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 6 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq6">
                                    ¿Qué significa el badge "Año Presupuestal" en la parte superior?
                                </button>
                            </h2>
                            <div id="faq6" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Indica cuál es el año presupuestal vigente configurado 
                                    en el sistema. La mayoría de las funciones trabajan 
                                    automáticamente con este año. Si necesitas trabajar 
                                    con otro año, algunas funciones permiten cambiarlo 
                                    mediante un selector.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 7 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq7">
                                    ¿Qué hago si una solicitud de ejecución es rechazada?
                                </button>
                            </h2>
                            <div id="faq7" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Revisa los motivos del rechazo que el autorizador indicó. 
                                    Puedes crear una nueva solicitud con las correcciones 
                                    necesarias. Si tienes dudas sobre por qué fue rechazada, 
                                    comunícate directamente con el autorizador de tu asignación.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 8 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq8">
                                    ¿Puedo modificar una solicitud después de enviarla?
                                </button>
                            </h2>
                            <div id="faq8" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Sí, mientras la solicitud esté en estado "Pendiente". 
                                    Una vez que el autorizador la procese (apruebe o rechace), 
                                    ya no podrás modificarla. Si necesitas cambiar algo en 
                                    una solicitud ya procesada, deberás crear una nueva.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 9 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq9">
                                    ¿Dónde puedo ver el historial de mis solicitudes?
                                </button>
                            </h2>
                            <div id="faq9" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    En la función "Solicitud de Ejecución" encontrarás un botón 
                                    "Ver mis solicitudes" que muestra todas las solicitudes 
                                    que has creado con su estado actual. También puedes usar 
                                    "Consultas de Presupuesto" para búsquedas más avanzadas.
                                </div>
                            </div>
                        </div>

                        <!-- FAQ 10 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#faq10">
                                    ¿Qué es un traslado presupuestal y cuándo usarlo?
                                </button>
                            </h2>
                            <div id="faq10" class="accordion-collapse collapse" 
                                 data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Un traslado permite mover dinero de una asignación a otra. 
                                    Úsalo cuando tienes recursos que no vas a gastar en un 
                                    concepto y los necesitas en otro. Por ejemplo, si te sobra 
                                    presupuesto de "Materiales" y necesitas más en "Equipos", 
                                    puedes solicitar un traslado.
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- ========================================== -->
                <!-- TARJETA PARA REPORTAR BUGS -->
                <!-- ========================================== -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../report-bug.html" class="btn btn-danger btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Presupuesto',
            modulePath: 'budget',
            pageTitle: 'Índice del Módulo',
            pagePath: 'index.html',
            moduleDescription: 'Gestión presupuestal y financiera del colegio'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            // Actualizar title
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
