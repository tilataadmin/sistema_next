<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="26.02.06.10.06">
    
    <title>Manual - Registro de Asistencia - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Tarjeta para reportar bugs - USANDO COLOR PRIMARIO */
        .bug-report-card {
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5,
        .bug-report-card h4 {
            color: white;
        }

        /* Botón flotante para reportar bugs - USANDO COLOR PRIMARIO */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #1B365D) !important;
            border-color: var(--system-primary-color, #1B365D) !important;
            color: white !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
            color: white !important;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Estilos para secciones del manual */
        .section-title {
            color: var(--system-primary-color, #1B365D);
            font-size: 1.35rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        .step-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 50%;
            font-weight: 600;
            font-size: 0.9rem;
            margin-right: 0.75rem;
        }

        .tip-box {
            background: #e7f3ff;
            border-left: 4px solid #0d6efd;
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin: 1rem 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin: 1rem 0;
        }

        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin: 1rem 0;
        }

        .danger-box {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 1rem;
            border-radius: 0 8px 8px 0;
            margin: 1rem 0;
        }

        .feature-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .feature-icon {
            color: var(--system-primary-color, #1B365D);
            margin-right: 0.75rem;
            font-size: 1.1rem;
        }

        .mode-card {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .mode-card:hover {
            border-color: var(--system-primary-color, #1B365D);
        }

        .mode-card-title {
            font-weight: 600;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .mode-card-title i {
            margin-right: 0.5rem;
            font-size: 1.2rem;
        }

        .faq-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .faq-question {
            font-weight: 600;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.5rem;
        }

        .table-of-contents {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .table-of-contents h5 {
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 1rem;
        }

        .table-of-contents ul {
            list-style: none;
            padding-left: 0;
            margin-bottom: 0;
        }

        .table-of-contents li {
            padding: 0.35rem 0;
        }

        .table-of-contents a {
            color: #495057;
            text-decoration: none;
        }

        .table-of-contents a:hover {
            color: var(--system-primary-color, #1B365D);
            text-decoration: underline;
        }

        .stat-example {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .stat-example-item {
            text-align: center;
            padding: 0.5rem;
        }

        .stat-example-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .stat-example-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Registro de Asistencia
                        </h1>
                        <p class="subtitle mb-0">Registro mediante carnets, reconocimiento facial o búsqueda manual</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/general-tools/attendance.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-8 mx-auto">

                <!-- INFORMACIÓN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong id="display-module">Herramientas Generales</strong></h5>
                            <p class="text-muted mb-0 small" id="display-page">Registro de Asistencia</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras algún problema,<br>
                                puedes reportarlo usando el botón de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- TABLA DE CONTENIDOS -->
                <div class="table-of-contents">
                    <h5><i class="bi bi-list-ul me-2"></i>Contenido del Manual</h5>
                    <ul>
                        <li><a href="#que-es"><i class="bi bi-chevron-right me-1"></i>¿Qué es el Registro de Asistencia?</a></li>
                        <li><a href="#caracteristicas"><i class="bi bi-chevron-right me-1"></i>Características principales</a></li>
                        <li><a href="#antes-comenzar"><i class="bi bi-chevron-right me-1"></i>Antes de comenzar</a></li>
                        <li><a href="#pestanas"><i class="bi bi-chevron-right me-1"></i>Las dos pestañas</a></li>
                        <li><a href="#estadisticas"><i class="bi bi-chevron-right me-1"></i>Estadísticas del día</a></li>
                        <li><a href="#modo-camara"><i class="bi bi-chevron-right me-1"></i>Modo Cámara (código de barras)</a></li>
                        <li><a href="#modo-rfid"><i class="bi bi-chevron-right me-1"></i>Modo RFID</a></li>
                        <li><a href="#modo-facial"><i class="bi bi-chevron-right me-1"></i>Modo Reconocimiento Facial</a></li>
                        <li><a href="#registro-manual"><i class="bi bi-chevron-right me-1"></i>Registro Manual</a></li>
                        <li><a href="#visitantes"><i class="bi bi-chevron-right me-1"></i>Registro de Visitantes</a></li>
                        <li><a href="#ultimos-registros"><i class="bi bi-chevron-right me-1"></i>Últimos registros</a></li>
                        <li><a href="#buenas-practicas"><i class="bi bi-chevron-right me-1"></i>Buenas prácticas</a></li>
                        <li><a href="#sincronizacion-phidias"><i class="bi bi-chevron-right me-1"></i>Sincronización con Phidias</a></li>
                        <li><a href="#faq"><i class="bi bi-chevron-right me-1"></i>Preguntas frecuentes</a></li>
                    </ul>
                </div>

                <!-- ========================================== -->
                <!-- SECCIÓN: ¿QUÉ ES? -->
                <!-- ========================================== -->
                <section id="que-es">
                    <h2 class="section-title">
                        <i class="bi bi-info-circle me-2"></i>
                        ¿Qué es el Registro de Asistencia?
                    </h2>
                    
                    <div class="step-card">
                        <p class="lead">
                            El <strong>Registro de Asistencia</strong> es el sistema que permite controlar 
                            las entradas y salidas de todas las personas en la institución.
                        </p>
                        <p>
                            Esta herramienta registra automáticamente:
                        </p>
                        <ul>
                            <li><strong>Estudiantes:</strong> Control de asistencia diaria</li>
                            <li><strong>Trabajadores:</strong> Personal docente y administrativo</li>
                            <li><strong>Visitantes:</strong> Personas externas que ingresan a la institución</li>
                        </ul>
                        <p class="mb-0">
                            El sistema detecta automáticamente si es una <strong>entrada</strong> o una <strong>salida</strong> 
                            según el historial del día.
                        </p>
                    </div>

                    <div class="info-box">
                        <strong><i class="bi bi-clock me-1"></i> Detección automática:</strong> 
                        El primer registro del día es siempre una <strong>entrada</strong>. 
                        El segundo es una <strong>salida</strong>, el tercero una entrada, y así sucesivamente.
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: CARACTERÍSTICAS -->
                <!-- ========================================== -->
                <section id="caracteristicas">
                    <h2 class="section-title">
                        <i class="bi bi-star me-2"></i>
                        Características principales
                    </h2>

                    <div class="feature-item">
                        <i class="bi bi-camera feature-icon"></i>
                        <div>
                            <strong>Múltiples métodos de registro</strong><br>
                            <span class="text-muted">Cámara, RFID, reconocimiento facial o manual</span>
                        </div>
                    </div>

                    <div class="feature-item">
                        <i class="bi bi-lightning feature-icon"></i>
                        <div>
                            <strong>Registro instantáneo</strong><br>
                            <span class="text-muted">Confirmación visual y sonora inmediata</span>
                        </div>
                    </div>

                    <div class="feature-item">
                        <i class="bi bi-graph-up feature-icon"></i>
                        <div>
                            <strong>Estadísticas en tiempo real</strong><br>
                            <span class="text-muted">Contadores actualizados automáticamente</span>
                        </div>
                    </div>

                    <div class="feature-item">
                        <i class="bi bi-person-badge feature-icon"></i>
                        <div>
                            <strong>Control de visitantes</strong><br>
                            <span class="text-muted">Registro separado para personas externas</span>
                        </div>
                    </div>

                    <div class="feature-item">
                        <i class="bi bi-clock-history feature-icon"></i>
                        <div>
                            <strong>Historial visible</strong><br>
                            <span class="text-muted">Últimos 10 registros siempre visibles</span>
                        </div>
                    </div>

                    <div class="feature-item">
                        <i class="bi bi-volume-up feature-icon"></i>
                        <div>
                            <strong>Retroalimentación audiovisual</strong><br>
                            <span class="text-muted">Sonidos y colores indican éxito o error</span>
                        </div>
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: ANTES DE COMENZAR -->
                <!-- ========================================== -->
                <section id="antes-comenzar">
                    <h2 class="section-title">
                        <i class="bi bi-clipboard-check me-2"></i>
                        Antes de comenzar
                    </h2>

                    <div class="step-card">
                        <h6><strong>Requisitos previos:</strong></h6>
                        <ul class="mb-0">
                            <li>Tener una cuenta activa en SchoolNet</li>
                            <li>Contar con el permiso <strong>"Registrar asistencia"</strong></li>
                            <li>Haber iniciado sesión en el sistema</li>
                            <li>Según el modo: cámara web, lector RFID o cámara para reconocimiento facial</li>
                        </ul>
                    </div>

                    <div class="warning-box">
                        <strong><i class="bi bi-exclamation-triangle me-1"></i> Permisos del navegador:</strong> 
                        La primera vez que uses la cámara, el navegador te pedirá permiso. 
                        Debes hacer clic en <strong>"Permitir"</strong> para que funcione.
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: LAS DOS PESTAÑAS -->
                <!-- ========================================== -->
                <section id="pestanas">
                    <h2 class="section-title">
                        <i class="bi bi-layout-text-sidebar me-2"></i>
                        Las dos pestañas
                    </h2>

                    <p>La página está organizada en <strong>2 pestañas</strong> principales:</p>

                    <div class="mode-card">
                        <div class="mode-card-title">
                            <i class="bi bi-people text-primary"></i>
                            Personal y Estudiantes
                        </div>
                        <p class="mb-0 small">
                            Para registrar asistencia de <strong>estudiantes y trabajadores</strong> de la institución. 
                            Ofrece tres modos: Cámara, RFID y Reconocimiento Facial.
                        </p>
                    </div>

                    <div class="mode-card">
                        <div class="mode-card-title">
                            <i class="bi bi-person-badge text-success"></i>
                            Visitantes
                        </div>
                        <p class="mb-0 small">
                            Para registrar el ingreso y salida de <strong>personas externas</strong>. 
                            Permite escanear cédulas o registrar manualmente.
                        </p>
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: ESTADÍSTICAS -->
                <!-- ========================================== -->
                <section id="estadisticas">
                    <h2 class="section-title">
                        <i class="bi bi-graph-up-arrow me-2"></i>
                        Estadísticas del día
                    </h2>

                    <p>En la parte superior verás una barra con <strong>4 indicadores</strong> del día actual:</p>

                    <div class="stat-example">
                        <div class="row">
                            <div class="col-3 stat-example-item">
                                <div class="stat-example-value">45</div>
                                <div class="stat-example-label">Total Registros</div>
                            </div>
                            <div class="col-3 stat-example-item">
                                <div class="stat-example-value">28</div>
                                <div class="stat-example-label">Entradas</div>
                            </div>
                            <div class="col-3 stat-example-item">
                                <div class="stat-example-value">17</div>
                                <div class="stat-example-label">Salidas</div>
                            </div>
                            <div class="col-3 stat-example-item">
                                <div class="stat-example-value">8</div>
                                <div class="stat-example-label">Última Hora</div>
                            </div>
                        </div>
                    </div>

                    <ul>
                        <li><strong>Total Registros:</strong> Cantidad total de marcaciones del día</li>
                        <li><strong>Entradas:</strong> Personas que han ingresado</li>
                        <li><strong>Salidas:</strong> Personas que han salido</li>
                        <li><strong>Última Hora:</strong> Registros en los últimos 60 minutos</li>
                    </ul>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: MODO CÁMARA -->
                <!-- ========================================== -->
                <section id="modo-camara">
                    <h2 class="section-title">
                        <i class="bi bi-camera me-2"></i>
                        Modo Cámara (código de barras)
                    </h2>

                    <div class="step-card">
                        <p>Este modo usa la <strong>cámara del dispositivo</strong> para leer el código de barras del carnet.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">1</span><strong>Selecciona el modo Cámara</strong></p>
                        <p class="mb-0 ms-4">Haz clic en el botón "Cámara" en el selector de modo (está seleccionado por defecto).</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">2</span><strong>Activa la cámara</strong></p>
                        <p class="mb-0 ms-4">Haz clic en el botón azul "Activar Cámara". Si es la primera vez, acepta el permiso del navegador.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">3</span><strong>Escanea el carnet</strong></p>
                        <p class="mb-0 ms-4">Acerca el código de barras del carnet a la cámara. Mantén el código centrado y bien iluminado.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">4</span><strong>Confirma el registro</strong></p>
                        <p class="mb-0 ms-4">Verás una pantalla verde con el nombre de la persona y si fue entrada o salida. 
                        Se escuchará un sonido de confirmación.</p>
                    </div>

                    <div class="tip-box">
                        <strong><i class="bi bi-lightbulb me-1"></i> Tips para mejor lectura:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Asegúrate de tener buena iluminación</li>
                            <li>Mantén el carnet estable, sin moverlo</li>
                            <li>El código de barras debe estar completamente visible</li>
                            <li>Si no lee, aleja o acerca un poco el carnet</li>
                        </ul>
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: MODO RFID -->
                <!-- ========================================== -->
                <section id="modo-rfid">
                    <h2 class="section-title">
                        <i class="bi bi-credit-card me-2"></i>
                        Modo RFID
                    </h2>

                    <div class="step-card">
                        <p>Este modo usa un <strong>lector de tarjetas RFID</strong> conectado al computador.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">1</span><strong>Selecciona el modo RFID</strong></p>
                        <p class="mb-0 ms-4">Haz clic en el botón "RFID" en el selector de modo.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">2</span><strong>El lector está listo</strong></p>
                        <p class="mb-0 ms-4">Verás un mensaje indicando que el lector está activo y esperando.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">3</span><strong>Acerca el carnet al lector</strong></p>
                        <p class="mb-0 ms-4">Simplemente acerca la tarjeta RFID al lector. El registro es automático e instantáneo.</p>
                    </div>

                    <div class="info-box">
                        <strong><i class="bi bi-info-circle me-1"></i> Importante:</strong> 
                        No es necesario presionar ningún botón. El sistema detecta automáticamente 
                        cuando se acerca una tarjeta y registra la asistencia.
                    </div>

                    <div class="warning-box">
                        <strong><i class="bi bi-exclamation-triangle me-1"></i> Requisito:</strong> 
                        El carnet debe tener un <strong>código RFID asignado</strong> en el sistema. 
                        Si aparece "Carnet no registrado", contacta al administrador.
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: MODO FACIAL -->
                <!-- ========================================== -->
                <section id="modo-facial">
                    <h2 class="section-title">
                        <i class="bi bi-person-bounding-box me-2"></i>
                        Modo Reconocimiento Facial
                    </h2>

                    <div class="step-card">
                        <p>Este modo usa <strong>inteligencia artificial</strong> para identificar personas por su rostro.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">1</span><strong>Selecciona el modo Facial</strong></p>
                        <p class="mb-0 ms-4">Haz clic en el botón "Facial" en el selector de modo.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">2</span><strong>Espera la carga de modelos</strong></p>
                        <p class="mb-0 ms-4">La primera vez, el sistema descarga los modelos de IA. Esto toma unos segundos. 
                        Verás el estado "Modelos ML: Cargando..." que cambiará a "Listos".</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">3</span><strong>Activa el reconocimiento</strong></p>
                        <p class="mb-0 ms-4">Haz clic en "Activar Reconocimiento". La cámara se encenderá.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">4</span><strong>Mira a la cámara</strong></p>
                        <p class="mb-0 ms-4">Posiciona tu rostro frente a la cámara. El sistema te identificará automáticamente en 1-2 segundos.</p>
                    </div>

                    <div class="tip-box">
                        <strong><i class="bi bi-lightbulb me-1"></i> Tips para mejor reconocimiento:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Asegúrate de tener buena iluminación frontal</li>
                            <li>Mira directamente a la cámara</li>
                            <li>Evita usar gafas de sol o accesorios que cubran tu rostro</li>
                            <li>Si usas lentes, úsalos igual que cuando registraste tu rostro</li>
                        </ul>
                    </div>

                    <div class="danger-box">
                        <strong><i class="bi bi-exclamation-octagon me-1"></i> Requisito previo:</strong> 
                        Para usar este modo, tu rostro debe estar <strong>previamente registrado</strong> 
                        en el sistema con estado "activo". Si no te reconoce, contacta al administrador 
                        para registrar tu rostro.
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: REGISTRO MANUAL -->
                <!-- ========================================== -->
                <section id="registro-manual">
                    <h2 class="section-title">
                        <i class="bi bi-pencil me-2"></i>
                        Registro Manual
                    </h2>

                    <div class="step-card">
                        <p>
                            Si el carnet no funciona o la persona no tiene carnet, puedes usar el 
                            <strong>registro manual</strong>. Haz clic en el botón discreto "Registro Manual" 
                            debajo del área de escaneo.
                        </p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">1</span><strong>Abre el registro manual</strong></p>
                        <p class="mb-0 ms-4">Haz clic en "Registro Manual". Se abrirá una ventana emergente.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">2</span><strong>Elige cómo buscar</strong></p>
                        <p class="mb-0 ms-4">Puedes buscar por <strong>Documento</strong> (número de cédula) o por <strong>Nombre</strong>.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">3</span><strong>Busca a la persona</strong></p>
                        <p class="mb-0 ms-4">Escribe el documento o nombre y haz clic en "Buscar". 
                        Se mostrarán los resultados encontrados.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">4</span><strong>Selecciona a la persona</strong></p>
                        <p class="mb-0 ms-4">Haz clic sobre la persona correcta en la lista de resultados.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">5</span><strong>Agrega observaciones (opcional)</strong></p>
                        <p class="mb-0 ms-4">Puedes escribir una nota explicando por qué fue registro manual 
                        (ej: "Olvidó el carnet").</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">6</span><strong>Confirma el registro</strong></p>
                        <p class="mb-0 ms-4">Haz clic en "Registrar Asistencia" para completar el proceso.</p>
                    </div>

                    <div class="info-box">
                        <strong><i class="bi bi-info-circle me-1"></i> Nota:</strong> 
                        Los registros manuales quedan marcados como tales en el sistema, 
                        incluyendo quién realizó el registro.
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: VISITANTES -->
                <!-- ========================================== -->
                <section id="visitantes">
                    <h2 class="section-title">
                        <i class="bi bi-person-badge me-2"></i>
                        Registro de Visitantes
                    </h2>

                    <div class="step-card">
                        <p>
                            La pestaña <strong>"Visitantes"</strong> permite registrar el ingreso y salida 
                            de personas externas a la institución.
                        </p>
                    </div>

                    <h6 class="mt-4"><strong>Modo 1: Escanear Cédula</strong></h6>

                    <div class="step-card">
                        <p><span class="step-number">1</span><strong>Activa la cámara</strong></p>
                        <p class="mb-0 ms-4">Haz clic en "Activar Cámara" para escanear el código QR o código de barras de la cédula.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">2</span><strong>Escanea la cédula</strong></p>
                        <p class="mb-0 ms-4">Acerca la cédula a la cámara. Funciona con cédula digital (QR) o cédula amarilla (código de barras).</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">3</span><strong>Completa los datos</strong></p>
                        <p class="mb-0 ms-4">Si es un visitante nuevo, completa sus datos. Si ya existe, solo selecciona a quién visita.</p>
                    </div>

                    <h6 class="mt-4"><strong>Modo 2: Registro Manual</strong></h6>

                    <div class="step-card">
                        <p>
                            Para extranjeros o cuando el escaneo no funciona, usa el <strong>Registro Manual</strong>:
                        </p>
                        <ul class="mb-0">
                            <li>Ingresa el número de documento</li>
                            <li>Selecciona el tipo de documento (CC, CE, Pasaporte, Otro)</li>
                            <li>Escribe nombres y apellidos</li>
                            <li>Opcionalmente, la empresa u organización</li>
                            <li><strong>Obligatorio:</strong> Selecciona a quién visita</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <strong><i class="bi bi-lightbulb me-1"></i> Visitantes recurrentes:</strong> 
                        Si un visitante ya estuvo antes, el sistema lo reconocerá automáticamente 
                        y solo te pedirá seleccionar a quién visita esta vez.
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: ÚLTIMOS REGISTROS -->
                <!-- ========================================== -->
                <section id="ultimos-registros">
                    <h2 class="section-title">
                        <i class="bi bi-clock-history me-2"></i>
                        Últimos registros
                    </h2>

                    <div class="step-card">
                        <p>
                            En la parte inferior de cada pestaña verás los <strong>últimos 10 registros</strong> del día, 
                            ordenados del más reciente al más antiguo.
                        </p>
                        <p>Cada registro muestra:</p>
                        <ul class="mb-0">
                            <li><strong>Nombre:</strong> De la persona registrada</li>
                            <li><strong>Hora:</strong> Momento exacto del registro</li>
                            <li><strong>Método:</strong> Ícono indicando si fue manual, facial, RFID, etc.</li>
                            <li><strong>Tipo:</strong> Badge verde "Entrada" o amarillo "Salida"</li>
                        </ul>
                    </div>

                    <div class="tip-box">
                        <strong><i class="bi bi-arrow-clockwise me-1"></i> Actualizar:</strong> 
                        Haz clic en el botón de actualizar (ícono de flecha circular) 
                        para recargar la lista de registros recientes.
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: BUENAS PRÁCTICAS -->
                <!-- ========================================== -->
                <section id="buenas-practicas">
                    <h2 class="section-title">
                        <i class="bi bi-award me-2"></i>
                        Buenas prácticas
                    </h2>

                    <div class="step-card">
                        <p><span class="step-number">1</span><strong>Verifica el registro visualmente</strong></p>
                        <p class="mb-0 ms-4">Siempre confirma que aparezca la pantalla verde con el nombre correcto.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">2</span><strong>No registres a la misma persona dos veces seguidas</strong></p>
                        <p class="mb-0 ms-4">Si ya apareció la confirmación, no es necesario escanear de nuevo.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">3</span><strong>Usa registro manual solo cuando sea necesario</strong></p>
                        <p class="mb-0 ms-4">Los métodos automáticos (cámara, RFID, facial) son más rápidos y confiables.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">4</span><strong>Mantén buena iluminación</strong></p>
                        <p class="mb-0 ms-4">Tanto para códigos de barras como para reconocimiento facial.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">5</span><strong>Reporta carnets dañados</strong></p>
                        <p class="mb-0 ms-4">Si un carnet no escanea repetidamente, puede estar dañado y necesitar reemplazo.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">6</span><strong>Siempre registra a los visitantes</strong></p>
                        <p class="mb-0 ms-4">Es importante para la seguridad saber quién está en las instalaciones.</p>
                    </div>
               </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: SINCRONIZACIÓN PHIDIAS -->
                <!-- ========================================== -->
                <section id="sincronizacion-phidias">
                    <h2 class="section-title">
                        <i class="bi bi-cloud-arrow-up me-2"></i>
                        Sincronización con Phidias
                    </h2>

                    <div class="step-card">
                        <p>
                            Si la institución tiene configurada la integración con <strong>Phidias</strong>, 
                            aparecerá un panel en la columna derecha de la página que permite enviar 
                            los registros de asistencia a la plataforma académica.
                        </p>
                    </div>

                    <h6 class="mt-4"><strong>¿Cómo funciona?</strong></h6>

                    <div class="step-card">
                        <p>Phidias marca a todos los estudiantes como <strong>Ausente</strong> cada día por defecto. 
                        SchoolNet envía los registros de entrada para cambiar ese estado:</p>
                        <ul class="mb-0">
                            <li><strong>Antes de la hora de corte (8:20 AM):</strong> El estudiante queda como <strong>Presente</strong></li>
                            <li><strong>Después de la hora de corte:</strong> El estudiante queda como <strong>Tarde</strong></li>
                            <li><strong>Sin enviar:</strong> Permanece como <strong>Ausente</strong></li>
                        </ul>
                    </div>

                    <h6 class="mt-4"><strong>Envío automático</strong></h6>

                    <div class="step-card">
                        <p>Si está habilitado en Configuración General, el sistema envía automáticamente 
                        los registros a la hora configurada (por defecto 8:20 AM). Para que funcione, 
                        esta página debe estar <strong>abierta en un navegador</strong> a esa hora.</p>
                    </div>

                    <h6 class="mt-4"><strong>Envío manual</strong></h6>

                    <div class="step-card">
                        <p><span class="step-number">1</span><strong>Ubica el panel de Phidias</strong></p>
                        <p class="mb-0 ms-4">En la columna derecha verás el card "Sincronización Phidias" con un badge mostrando registros pendientes.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">2</span><strong>Haz clic en "Sincronizar ahora"</strong></p>
                        <p class="mb-0 ms-4">El botón enviará todos los registros de entrada pendientes del día a Phidias.</p>
                    </div>

                    <div class="step-card">
                        <p><span class="step-number">3</span><strong>Revisa el resultado</strong></p>
                        <p class="mb-0 ms-4">El panel mostrará cuántos registros se enviaron exitosamente y si hubo errores.</p>
                    </div>

                    <div class="warning-box">
                        <strong><i class="bi bi-exclamation-triangle me-1"></i> Importante:</strong> 
                        Solo se envían registros de <strong>entrada de estudiantes</strong>. Las salidas 
                        y los registros de trabajadores no se envían a Phidias.
                    </div>

                    <div class="tip-box">
                        <strong><i class="bi bi-lightbulb me-1"></i> Recomendación:</strong> 
                        Si el envío automático no se ejecutó (nadie tenía la página abierta), 
                        use el botón manual como respaldo. Tenga en cuenta que enviar después 
                        de la hora de corte marcará a los estudiantes como "Tarde" en Phidias.
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- SECCIÓN: FAQ -->
                <!-- ========================================== -->
                <section id="faq">
                    <h2 class="section-title">
                        <i class="bi bi-chat-dots me-2"></i>
                        Preguntas frecuentes
                    </h2>

                    <div class="faq-item">
                        <p class="faq-question">¿Qué hago si aparece "Persona no encontrada"?</p>
                        <p class="mb-0">
                            Esto significa que el documento escaneado no está registrado en el sistema. 
                            Verifica que el carnet corresponda a la persona correcta. Si es un estudiante 
                            o trabajador nuevo, debe ser registrado primero en el sistema.
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿Por qué el reconocimiento facial no me identifica?</p>
                        <p class="mb-0">
                            Tu rostro debe estar previamente registrado en el sistema con estado "activo". 
                            Además, verifica que tengas buena iluminación y mires directamente a la cámara. 
                            Si usaste lentes durante el registro, úsalos también ahora.
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿Puedo corregir un registro erróneo?</p>
                        <p class="mb-0">
                            Los registros no se pueden editar desde esta pantalla por seguridad. 
                            Contacta al administrador del sistema si necesitas hacer una corrección.
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿Por qué aparece "Carnet no registrado" en modo RFID?</p>
                        <p class="mb-0">
                            El carnet debe tener un código RFID asignado en su perfil. 
                            Contacta al administrador para que asocie el código RFID al carnet.
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿Qué significan los sonidos?</p>
                        <p class="mb-0">
                            Un sonido <strong>agudo corto</strong> indica registro exitoso. 
                            Un sonido <strong>grave largo</strong> indica error. 
                            Siempre verifica visualmente el mensaje en pantalla.
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿Por qué la cámara no enciende?</p>
                        <p class="mb-0">
                            Verifica que hayas dado permiso al navegador para usar la cámara. 
                            Si bloqueaste el permiso, ve a la configuración del navegador y permítelo. 
                            También asegúrate de que ninguna otra aplicación esté usando la cámara.
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿Puedo usar esto desde mi celular?</p>
                        <p class="mb-0">
                            Sí, la página es responsive y funciona en dispositivos móviles. 
                            El modo cámara usará la cámara trasera por defecto para mejor lectura 
                            de códigos de barras.
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿Cómo sé si es entrada o salida?</p>
                        <p class="mb-0">
                            El sistema lo detecta automáticamente. El primer registro del día es entrada, 
                            el segundo es salida, y así sucesivamente. La confirmación siempre indica 
                            claramente si fue "Entrada registrada" o "Salida registrada".
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿Por qué no veo el panel de Phidias?</p>
                        <p class="mb-0">
                            El panel solo aparece si la integración con Phidias está configurada 
                            correctamente en Configuración General, incluyendo un token vigente. 
                            Si no lo ves, contacta al administrador.
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿Qué pasa si sincronizo con Phidias después de las 8:20 AM?</p>
                        <p class="mb-0">
                            Los estudiantes enviados después de la hora de corte quedarán marcados 
                            como "Tarde" en Phidias, aunque en SchoolNet su entrada esté registrada 
                            normalmente. Para que queden como "Presente", la sincronización debe 
                            ejecutarse antes de las 8:20 AM.
                        </p>
                    </div>

                    <div class="faq-item">
                        <p class="faq-question">¿La sincronización con Phidias es obligatoria?</p>
                        <p class="mb-0">
                            No. SchoolNet registra la asistencia de forma independiente. 
                            La sincronización con Phidias es opcional y solo es necesaria si 
                            la institución usa Phidias para el control académico de asistencia.
                        </p>
                    </div>
                </section>

                <!-- ========================================== -->
                <!-- TARJETA PARA REPORTAR BUGS -->
                <!-- ========================================== -->
                <div class="bug-report-card mt-5">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS - COLOR PRIMARIO -->
    <a href="../report-bug.html" class="btn btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Herramientas Generales',
            modulePath: 'general-tools',
            pageTitle: 'Registro de Asistencia',
            pagePath: 'attendance.html',
            moduleDescription: 'Registro mediante carnets, reconocimiento facial o búsqueda manual'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            // Actualizar title
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
