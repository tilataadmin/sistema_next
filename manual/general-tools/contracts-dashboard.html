<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="26.01.26.15.30">
    
    <title>Manual - Herramientas Generales - Dashboard de Contratos - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Tarjeta para reportar bugs - CON COLOR PRIMARIO */
        .bug-report-card {
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        .bug-report-card .btn-light {
            background: white;
            color: var(--system-primary-color, #1B365D);
            border: none;
            font-weight: 600;
        }

        .bug-report-card .btn-light:hover {
            background: #f8f9fa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Botón flotante para reportar bugs */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #dc3545) !important;
            border-color: var(--system-primary-color, #dc3545) !important;
            color: white !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Estilos para el contenido del manual */
        .manual-section {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .manual-section h3 {
            color: var(--system-primary-color, #1B365D);
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
        }

        .manual-section h4 {
            color: var(--system-primary-color, #1B365D);
            font-size: 1.25rem;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid var(--system-secondary-color, #667eea);
            padding: 1rem 1.25rem;
            margin: 1.5rem 0;
            border-radius: 4px;
        }

        .info-box.warning {
            background: #fff3cd;
            border-left-color: var(--system-tertiary-color, #ffc107);
        }

        .info-box.success {
            background: #d1e7dd;
            border-left-color: #28a745;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 0.75rem;
        }

        .feature-list {
            list-style: none;
            padding-left: 0;
        }

        .feature-list li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .feature-list li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--system-primary-color, #1B365D);
            font-weight: bold;
            font-size: 1.2rem;
        }

        .use-case {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .use-case strong {
            color: var(--system-primary-color, #1B365D);
        }

        .faq-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .faq-question {
            color: var(--system-primary-color, #1B365D);
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
        }

        .faq-answer {
            color: #495057;
            line-height: 1.6;
        }

        .metric-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            margin: 0.5rem 0;
        }

        .filter-example {
            background: #f8f9fa;
            border: 1px dashed #dee2e6;
            border-radius: 6px;
            padding: 1rem;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Dashboard de Contratos
                        </h1>
                        <p class="subtitle mb-0">Herramientas Generales - Vista gerencial completa de contratos generados</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/general-tools/contracts-dashboard.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-10 mx-auto">

                <!-- INFORMACIÓN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong id="display-module">Herramientas Generales</strong></h5>
                            <p class="text-muted mb-0 small" id="display-page">Dashboard de Contratos</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras algún problema,<br>
                                puedes reportarlo usando el botón de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCIÓN 1: ¿QUÉ ES? -->
                <!-- ============================================ -->
                <div class="manual-section">
                    <h3><i class="bi bi-info-circle me-2"></i>¿Qué es el Dashboard de Contratos?</h3>
                    
                    <p>
                        El <strong>Dashboard de Contratos</strong> es el centro de control gerencial para visualizar, analizar 
                        y gestionar todos los contratos generados en el sistema SchoolNet. Proporciona una vista consolidada 
                        con métricas, filtros avanzados, gráficos estadísticos y acceso directo a los documentos.
                    </p>

                    <div class="info-box">
                        <strong><i class="bi bi-lightbulb me-2"></i>Para Directivos:</strong>
                        Esta herramienta es tu tablero de mando para supervisar la actividad contractual de la institución. 
                        Te permite responder preguntas como: ¿Cuántos contratos tenemos activos? ¿Quién genera más contratos? 
                        ¿Cuántos contratos vencen pronto? ¿Qué categorías son más comunes?
                    </div>

                    <h4>Características principales:</h4>
                    <ul class="feature-list">
                        <li><strong>Métricas en tiempo real:</strong> Indicadores clave de la actividad contractual</li>
                        <li><strong>Filtros avanzados:</strong> 7 criterios de búsqueda combinables</li>
                        <li><strong>Vista de tabla:</strong> Lista completa con paginación (50 contratos por página)</li>
                        <li><strong>Gráficos estadísticos:</strong> Visualizaciones de contratos por categoría y mes</li>
                        <li><strong>Gestión de PDFs:</strong> Ver, descargar, subir versiones firmadas</li>
                        <li><strong>Alertas de vencimiento:</strong> Identificar contratos próximos a vencer</li>
                    </ul>

                    <div class="info-box success">
                        <strong><i class="bi bi-shield-check me-2"></i>Control total:</strong>
                        Este dashboard centraliza toda la información contractual, eliminando la necesidad de revisar 
                        archivos dispersos o carpetas individuales. Todo está en un solo lugar, actualizado en tiempo real.
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCIÓN 2: MÉTRICAS GENERALES -->
                <!-- ============================================ -->
                <div class="manual-section">
                    <h3><i class="bi bi-speedometer2 me-2"></i>Métricas Generales</h3>
                    
                    <p>En la parte superior del dashboard encontrarás 4 tarjetas con indicadores clave:</p>

                    <div class="metric-card">
                        <h5><i class="bi bi-file-text text-primary me-2"></i>Total Contratos</h5>
                        <p class="mb-0">
                            <strong>Qué muestra:</strong> Número total de contratos generados (considerando filtros activos)<br>
                            <strong>Para qué sirve:</strong> Vista general del volumen contractual<br>
                            <strong>Ejemplo:</strong> "152" significa que hay 152 contratos en el sistema
                        </p>
                    </div>

                    <div class="metric-card">
                        <h5><i class="bi bi-calendar-check text-success me-2"></i>Este Mes</h5>
                        <p class="mb-0">
                            <strong>Qué muestra:</strong> Contratos generados en el mes calendario actual<br>
                            <strong>Para qué sirve:</strong> Medir actividad contractual reciente<br>
                            <strong>Ejemplo:</strong> "23" significa 23 contratos generados en enero (si estamos en enero)
                        </p>
                    </div>

                    <div class="metric-card">
                        <h5><i class="bi bi-folder-check text-info me-2"></i>Por Categoría</h5>
                        <p class="mb-0">
                            <strong>Qué muestra:</strong> Top 3 categorías con más contratos (formato abreviado)<br>
                            <strong>Para qué sirve:</strong> Identificar rápidamente las categorías más usadas<br>
                            <strong>Ejemplo:</strong> "Ped:45 Adm:32 Ser:18" = Pedagógicos: 45, Administrativos: 32, Servicios: 18
                        </p>
                    </div>

                    <div class="metric-card">
                        <h5><i class="bi bi-person-badge text-warning me-2"></i>Top Generador</h5>
                        <p class="mb-0">
                            <strong>Qué muestra:</strong> Usuario que ha generado más contratos y su cantidad<br>
                            <strong>Para qué sirve:</strong> Identificar el personal más activo en generación de contratos<br>
                            <strong>Ejemplo:</strong> "María López: 28" = María López ha generado 28 contratos
                        </p>
                    </div>

                    <div class="info-box">
                        <strong><i class="bi bi-arrow-repeat me-2"></i>Actualización dinámica:</strong>
                        Las métricas se recalculan automáticamente cada vez que aplicas filtros. Esto permite analizar 
                        subconjuntos específicos (ej: "Contratos pedagógicos de noviembre generados por Juan Pérez").
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCIÓN 3: FILTROS AVANZADOS -->
                <!-- ============================================ -->
                <div class="manual-section">
                    <h3><i class="bi bi-funnel me-2"></i>Filtros Avanzados</h3>
                    
                    <p>
                        El sistema ofrece 7 criterios de filtrado que puedes combinar para búsquedas precisas. 
                        Todos los filtros son opcionales y acumulativos.
                    </p>

                    <h4>Los 7 Filtros Disponibles:</h4>

                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="h6 mt-3">1. Categoría</h5>
                            <p class="small mb-0">
                                <strong>Qué filtra:</strong> Contratos de una categoría específica<br>
                                <strong>Ejemplo:</strong> Seleccionar "Pedagógicos" muestra solo contratos de esa categoría
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6 mt-3">2. Plantilla</h5>
                            <p class="small mb-0">
                                <strong>Qué filtra:</strong> Contratos generados con una plantilla específica<br>
                                <strong>Ejemplo:</strong> "Contrato Docente Tiempo Completo" muestra solo contratos de esa plantilla
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6 mt-3">3. Generado por</h5>
                            <p class="small mb-0">
                                <strong>Qué filtra:</strong> Contratos creados por un usuario específico<br>
                                <strong>Ejemplo:</strong> Seleccionar "María López" muestra solo sus contratos
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6 mt-3">4. Buscar (texto libre)</h5>
                            <p class="small mb-0">
                                <strong>Qué filtra:</strong> Contratos que contengan el texto en nombre o notas<br>
                                <strong>Ejemplo:</strong> Escribir "matemáticas" encuentra todos los contratos relacionados
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6 mt-3">5. Desde (fecha)</h5>
                            <p class="small mb-0">
                                <strong>Qué filtra:</strong> Contratos generados a partir de una fecha<br>
                                <strong>Ejemplo:</strong> "2025-01-01" muestra contratos desde enero 2025 en adelante
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6 mt-3">6. Hasta (fecha)</h5>
                            <p class="small mb-0">
                                <strong>Qué filtra:</strong> Contratos generados hasta una fecha<br>
                                <strong>Ejemplo:</strong> "2025-12-31" muestra contratos hasta fin de 2025
                            </p>
                        </div>
                        <div class="col-md-12">
                            <h5 class="h6 mt-3">7. Estado</h5>
                            <p class="small mb-0">
                                <strong>Opciones:</strong>
                                <ul class="mt-2">
                                    <li><strong>Vigentes:</strong> Contratos cuya fecha de fin no ha pasado</li>
                                    <li><strong>Vencidos:</strong> Contratos cuya fecha de fin ya pasó</li>
                                    <li><strong>Por vencer (30 días):</strong> Contratos que vencen en los próximos 30 días</li>
                                </ul>
                            </p>
                        </div>
                    </div>

                    <h4>Cómo Usar los Filtros:</h4>
                    <ol>
                        <li><span class="step-number">1</span>Selecciona los criterios que necesites en los desplegables y campos</li>
                        <li><span class="step-number">2</span>Haz clic en el botón <strong>"Buscar"</strong></li>
                        <li><span class="step-number">3</span>El sistema aplicará todos los filtros simultáneamente</li>
                        <li><span class="step-number">4</span>Las métricas y gráficos se actualizarán automáticamente</li>
                    </ol>

                    <div class="filter-example">
                        <strong>Ejemplo práctico:</strong><br>
                        Categoría: "Pedagógicos"<br>
                        Generado por: "María López"<br>
                        Estado: "Vigentes"<br>
                        Desde: "2025-01-01"<br>
                        <br>
                        <strong>Resultado:</strong> Contratos pedagógicos vigentes generados por María López desde enero 2025
                    </div>

                    <h4>Botones de Acción:</h4>
                    <ul>
                        <li><strong>Buscar:</strong> Aplica los filtros configurados</li>
                        <li><strong>Limpiar:</strong> Borra todos los filtros y muestra todos los contratos</li>
                        <li><strong>Actualizar:</strong> Recarga los datos desde la base de datos (útil si otros usuarios generaron contratos)</li>
                    </ul>

                    <div class="info-box success">
                        <strong><i class="bi bi-magic me-2"></i>Tip de productividad:</strong>
                        Los filtros son acumulativos. Puedes combinar los 7 simultáneamente para búsquedas muy específicas. 
                        Por ejemplo: contratos pedagógicos de tiempo completo, generados por Juan en noviembre, que vencen 
                        en los próximos 30 días.
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCIÓN 4: TABLA DE CONTRATOS -->
                <!-- ============================================ -->
                <div class="manual-section">
                    <h3><i class="bi bi-table me-2"></i>Tabla de Contratos</h3>
                    
                    <p>
                        La tabla muestra todos los contratos que cumplen con los filtros aplicados. 
                        Cada fila representa un contrato individual con su información clave.
                    </p>

                    <h4>Columnas de la Tabla:</h4>

                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="h6">Categoría</h5>
                            <p class="small">Badge con el nombre de la categoría asignada</p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6">Plantilla</h5>
                            <p class="small">Nombre de la plantilla usada para generar el contrato</p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6">Nombre del Contrato</h5>
                            <p class="small">
                                Nombre asignado al contrato al generarlo. Puede incluir notas adicionales debajo. 
                                Si tiene versión firmada, muestra badge "Versión Firmada" con ícono.
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6">Generado por</h5>
                            <p class="small">Usuario que generó el contrato</p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6">Fecha Fin</h5>
                            <p class="small">
                                Fecha de finalización del contrato. Si ya venció, muestra badge rojo "Vencido"
                            </p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="h6">Generado</h5>
                            <p class="small">Fecha y hora en que se generó el contrato</p>
                        </div>
                    </div>

                    <h4>Columna de Acciones (Botones):</h4>
                    
                    <div class="info-box">
                        <strong>Todos los contratos tienen:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>Ver Original:</strong> Abre el PDF original generado por el sistema</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <strong>Si el contrato tiene versión firmada:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>Ver Firmado:</strong> Abre el PDF con las firmas (versión legal final)</li>
                        </ul>
                    </div>

                    <div class="info-box warning">
                        <strong>Solo para el creador del contrato o Super Admin:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>Subir Firmado:</strong> Permite subir la versión firmada (si no existe aún)</li>
                            <li><strong>Reemplazar:</strong> Permite reemplazar la versión firmada existente</li>
                        </ul>
                        Si no tienes estos permisos, no verás estos botones en contratos de otros usuarios.
                    </div>

                    <h4>Paginación:</h4>
                    <p>
                        El sistema muestra 50 contratos por página. Si hay más resultados, aparecerá la barra de 
                        paginación en la parte inferior de la tabla:
                    </p>
                    <ul>
                        <li>Flechas laterales para página anterior/siguiente</li>
                        <li>Números de página (máximo 5 visibles a la vez)</li>
                        <li>Puntos suspensivos "..." cuando hay muchas páginas</li>
                    </ul>

                    <div class="info-box">
                        <strong><i class="bi bi-info-circle me-2"></i>Contador de resultados:</strong>
                        En la esquina superior derecha de la tabla verás algo como "87 resultados", indicando cuántos 
                        contratos cumplen con los filtros aplicados.
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCIÓN 5: GRÁFICOS ESTADÍSTICOS -->
                <!-- ============================================ -->
                <div class="manual-section">
                    <h3><i class="bi bi-graph-up me-2"></i>Gráficos Estadísticos</h3>
                    
                    <p>
                        Debajo de la tabla encontrarás dos gráficos interactivos que visualizan tendencias y distribuciones:
                    </p>

                    <h4>1. Contratos por Categoría (Gráfico Circular)</h4>
                    <p>
                        <strong>Qué muestra:</strong> Distribución porcentual de contratos entre las diferentes categorías
                    </p>
                    <ul>
                        <li>Cada categoría tiene un color diferente</li>
                        <li>Al pasar el mouse sobre una sección, muestra: Nombre, cantidad y porcentaje</li>
                        <li>La leyenda en la parte inferior identifica cada color</li>
                    </ul>
                    <p>
                        <strong>Para qué sirve:</strong> Entender la composición del personal. Por ejemplo, si el 60% son 
                        contratos pedagógicos, indica que la mayoría del personal son docentes.
                    </p>

                    <h4>2. Contratos por Mes (Gráfico de Barras)</h4>
                    <p>
                        <strong>Qué muestra:</strong> Número de contratos generados en cada uno de los últimos 6 meses
                    </p>
                    <ul>
                        <li>El eje horizontal muestra los meses (Ej: "Ago 2024", "Sep 2024"...)</li>
                        <li>El eje vertical muestra la cantidad de contratos</li>
                        <li>Al pasar el mouse sobre una barra, muestra la cantidad exacta</li>
                    </ul>
                    <p>
                        <strong>Para qué sirve:</strong> Identificar patrones temporales. Por ejemplo, si hay picos en 
                        enero y julio, puede indicar contrataciones al inicio de cada semestre.
                    </p>

                    <div class="info-box success">
                        <strong><i class="bi bi-eye me-2"></i>Visualización dinámica:</strong>
                        Los gráficos se actualizan automáticamente cuando aplicas filtros. Esto permite analizar 
                        subconjuntos específicos (ej: "¿Cómo han evolucionado los contratos pedagógicos en los últimos meses?")
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCIÓN 6: GESTIÓN DE PDFs -->
                <!-- ============================================ -->
                <div class="manual-section">
                    <h3><i class="bi bi-file-pdf me-2"></i>Gestión de PDFs</h3>
                    
                    <h4>A. Ver PDF en el Sistema</h4>
                    <ol>
                        <li><span class="step-number">1</span>Localiza el contrato en la tabla</li>
                        <li><span class="step-number">2</span>Haz clic en "Ver Original" o "Ver Firmado" (si existe)</li>
                        <li><span class="step-number">3</span>Se abrirá un modal con el visor de PDF integrado</li>
                        <li><span class="step-number">4</span>Puedes:
                            <ul>
                                <li>Ver el documento completo en el navegador</li>
                                <li>Hacer zoom usando los controles del navegador</li>
                                <li>Descargar el PDF usando el botón "Descargar PDF"</li>
                            </ul>
                        </li>
                        <li><span class="step-number">5</span>Cierra el modal con el botón "Cerrar" o la X superior</li>
                    </ol>

                    <div class="info-box">
                        <strong><i class="bi bi-arrows-angle-expand me-2"></i>PDF Original vs Firmado:</strong>
                        <ul class="mb-0 mt-2">
                            <li><strong>PDF Original:</strong> Documento tal como fue generado por el sistema</li>
                            <li><strong>PDF Firmado:</strong> Documento con firmas físicas o digitales (versión legal)</li>
                        </ul>
                    </div>

                    <h4>B. Subir Versión Firmada</h4>
                    <p>
                        Una vez firmado físicamente o digitalmente un contrato, puedes subir esa versión al sistema:
                    </p>

                    <ol>
                        <li><span class="step-number">1</span>Verifica que tienes permisos (creador o Super Admin)</li>
                        <li><span class="step-number">2</span>Haz clic en "Subir Firmado" o "Reemplazar" en la columna Acciones</li>
                        <li><span class="step-number">3</span>Se abrirá el modal "Subir Versión Firmada del Contrato"</li>
                        <li><span class="step-number">4</span>Sube el archivo de una de dos formas:
                            <ul>
                                <li><strong>Opción A:</strong> Arrastra el archivo PDF a la zona gris</li>
                                <li><strong>Opción B:</strong> Haz clic en la zona gris y selecciona el archivo</li>
                            </ul>
                        </li>
                        <li><span class="step-number">5</span>El sistema validará:
                            <ul>
                                <li>Que sea un archivo PDF</li>
                                <li>Que no supere 20 MB de tamaño</li>
                            </ul>
                        </li>
                        <li><span class="step-number">6</span>Verás un preview con el nombre y tamaño del archivo</li>
                        <li><span class="step-number">7</span>Haz clic en "Subir PDF Firmado"</li>
                        <li><span class="step-number">8</span>El sistema mostrará una barra de progreso</li>
                        <li><span class="step-number">9</span>Una vez completo, el modal se cerrará automáticamente</li>
                        <li><span class="step-number">10</span>El contrato ahora mostrará el badge "Versión Firmada"</li>
                    </ol>

                    <div class="info-box warning">
                        <strong><i class="bi bi-exclamation-triangle me-2"></i>Importante al subir:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Solo se aceptan archivos PDF (no Word, imágenes, etc.)</li>
                            <li>El tamaño máximo es 20 MB por archivo</li>
                            <li>Si reemplazas una versión firmada existente, la anterior se sobrescribe</li>
                            <li>No hay límite de reemplazos, pero cada reemplazo es permanente</li>
                        </ul>
                    </div>

                    <h4>C. Descargar PDFs</h4>
                    <p>Hay dos formas de descargar un PDF:</p>
                    <ul>
                        <li><strong>Desde el visor:</strong> Abrir el PDF y usar el botón "Descargar PDF" del modal</li>
                        <li><strong>Directo:</strong> Click derecho en "Ver Original" o "Ver Firmado" → "Guardar enlace como"</li>
                    </ul>

                    <div class="info-box success">
                        <strong><i class="bi bi-shield-check me-2"></i>Trazabilidad:</strong>
                        El sistema registra quién subió la versión firmada y cuándo. Esta información se guarda en la 
                        base de datos para auditorías futuras.
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCIÓN 7: CASOS DE USO -->
                <!-- ============================================ -->
                <div class="manual-section">
                    <h3><i class="bi bi-journal-check me-2"></i>Casos de Uso Comunes</h3>

                    <div class="use-case">
                        <strong>Caso 1: "Necesito ver todos los contratos que vencen en los próximos 30 días"</strong>
                        <p class="mb-1 mt-2">Solución:</p>
                        <ol class="mb-0">
                            <li>En los filtros, selecciona Estado: "Por vencer (30 días)"</li>
                            <li>Haz clic en "Buscar"</li>
                            <li>La tabla mostrará solo contratos que vencen pronto</li>
                            <li>Usa esta lista para planificar renovaciones</li>
                        </ol>
                    </div>

                    <div class="use-case">
                        <strong>Caso 2: "¿Cuántos contratos pedagógicos generó María López en 2024?"</strong>
                        <p class="mb-1 mt-2">Solución:</p>
                        <ol class="mb-0">
                            <li>Categoría: "Pedagógicos"</li>
                            <li>Generado por: "María López"</li>
                            <li>Desde: "2024-01-01"</li>
                            <li>Hasta: "2024-12-31"</li>
                            <li>Haz clic en "Buscar"</li>
                            <li>La métrica "Total Contratos" te dará el número exacto</li>
                        </ol>
                    </div>

                    <div class="use-case">
                        <strong>Caso 3: "Quiero descargar todos los contratos de un mes específico"</strong>
                        <p class="mb-1 mt-2">Solución:</p>
                        <ol class="mb-0">
                            <li>Desde: "2024-11-01"</li>
                            <li>Hasta: "2024-11-30"</li>
                            <li>Haz clic en "Buscar"</li>
                            <li>Ahora descarga uno por uno usando "Ver Original" → "Descargar PDF"</li>
                            <li>(Actualmente no hay descarga masiva, debe ser manual)</li>
                        </ol>
                    </div>

                    <div class="use-case">
                        <strong>Caso 4: "Necesito subir la versión firmada de un contrato"</strong>
                        <p class="mb-1 mt-2">Solución:</p>
                        <ol class="mb-0">
                            <li>Busca el contrato usando el campo "Buscar" o filtros</li>
                            <li>Verifica que eres el creador o Super Admin</li>
                            <li>Haz clic en "Subir Firmado"</li>
                            <li>Arrastra o selecciona el PDF firmado</li>
                            <li>Confirma la subida</li>
                        </ol>
                    </div>

                    <div class="use-case">
                        <strong>Caso 5: "Quiero ver el gráfico de solo contratos administrativos"</strong>
                        <p class="mb-1 mt-2">Solución:</p>
                        <ol class="mb-0">
                            <li>Categoría: "Administrativos"</li>
                            <li>Haz clic en "Buscar"</li>
                            <li>Los gráficos ahora mostrarán solo datos de esa categoría</li>
                            <li>El gráfico circular mostrará subcategorías (si existen)</li>
                            <li>El gráfico de barras mostrará tendencia mensual de solo esa categoría</li>
                        </ol>
                    </div>

                    <div class="use-case">
                        <strong>Caso 6: "No encuentro un contrato específico"</strong>
                        <p class="mb-1 mt-2">Solución:</p>
                        <ol class="mb-0">
                            <li>Primero haz clic en "Limpiar" para quitar todos los filtros</li>
                            <li>En el campo "Buscar", escribe parte del nombre del contrato</li>
                            <li>Haz clic en "Buscar"</li>
                            <li>Si aún no aparece, verifica:
                                <ul>
                                    <li>La ortografía del término de búsqueda</li>
                                    <li>Que el contrato realmente exista en el sistema</li>
                                    <li>Que tengas permisos para verlo</li>
                                </ul>
                            </li>
                        </ol>
                    </div>

                    <div class="use-case">
                        <strong>Caso 7: "¿Qué categoría tiene más contratos este año?"</strong>
                        <p class="mb-1 mt-2">Solución:</p>
                        <ol class="mb-0">
                            <li>Desde: "2025-01-01"</li>
                            <li>Hasta: "2025-12-31" (o fecha actual)</li>
                            <li>Haz clic en "Buscar"</li>
                            <li>Observa el gráfico circular "Contratos por Categoría"</li>
                            <li>La sección más grande es la categoría dominante</li>
                        </ol>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCIÓN 8: PREGUNTAS FRECUENTES -->
                <!-- ============================================ -->
                <div class="manual-section">
                    <h3><i class="bi bi-question-circle me-2"></i>Preguntas Frecuentes</h3>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-question-circle-fill me-2"></i>
                            ¿Puedo ver contratos generados por otros usuarios?
                        </div>
                        <div class="faq-answer">
                            Sí. El Dashboard muestra todos los contratos del sistema, sin importar quién los generó. 
                            Sin embargo, solo puedes subir o reemplazar versiones firmadas de contratos que tú generaste 
                            (a menos que seas Super Admin).
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-question-circle-fill me-2"></i>
                            ¿Por qué no veo el botón "Subir Firmado" en algunos contratos?
                        </div>
                        <div class="faq-answer">
                            Este botón solo aparece si:
                            <ul>
                                <li>Tú generaste ese contrato, O</li>
                                <li>Eres Super Admin</li>
                            </ul>
                            Es una medida de seguridad para evitar que usuarios modifiquen contratos de otros sin autorización.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-question-circle-fill me-2"></i>
                            Si subo una versión firmada, ¿se elimina el PDF original?
                        </div>
                        <div class="faq-answer">
                            No. Ambas versiones se conservan:
                            <ul>
                                <li><strong>PDF Original:</strong> Siempre disponible en "Ver Original"</li>
                                <li><strong>PDF Firmado:</strong> Disponible en "Ver Firmado" una vez subido</li>
                            </ul>
                            El sistema mantiene ambos archivos para trazabilidad y respaldo.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-question-circle-fill me-2"></i>
                            ¿Cuál es la diferencia entre "Buscar" y "Actualizar"?
                        </div>
                        <div class="faq-answer">
                            <ul>
                                <li><strong>Buscar:</strong> Aplica los filtros que configuraste. No recarga datos de la BD</li>
                                <li><strong>Actualizar:</strong> Vuelve a cargar todos los datos desde la base de datos. Útil si 
                                otros usuarios generaron contratos mientras tú estabas en la página</li>
                            </ul>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-question-circle-fill me-2"></i>
                            ¿Puedo descargar múltiples contratos a la vez?
                        </div>
                        <div class="faq-answer">
                            Actualmente no. Debes descargar los contratos uno por uno. Para descargar varios:
                            <ol>
                                <li>Aplica filtros para reducir la lista</li>
                                <li>Abre cada contrato y descárgalo</li>
                                <li>Repite el proceso</li>
                            </ol>
                            Considera solicitar esta funcionalidad como mejora futura.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-question-circle-fill me-2"></i>
                            ¿Los filtros afectan los gráficos?
                        </div>
                        <div class="faq-answer">
                            Sí, absolutamente. Los gráficos siempre muestran datos de los contratos filtrados. 
                            Esto permite analizar subconjuntos específicos visualmente. Por ejemplo, si filtras por 
                            "Pedagógicos", el gráfico de meses mostrará solo la tendencia de contratos pedagógicos.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-question-circle-fill me-2"></i>
                            ¿Qué significa "Por vencer (30 días)"?
                        </div>
                        <div class="faq-answer">
                            Son contratos cuya fecha de finalización está entre hoy y 30 días en el futuro. 
                            <br><br>
                            <strong>Ejemplo:</strong> Si hoy es 15 de enero, mostrará contratos que vencen entre el 
                            15 de enero y el 14 de febrero.
                            <br><br>
                            Este filtro es útil para planificar renovaciones con anticipación.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-question-circle-fill me-2"></i>
                            ¿Puedo editar el contenido de un contrato una vez generado?
                        </div>
                        <div class="faq-answer">
                            No desde este dashboard. Una vez generado, el PDF es inmutable. Si necesitas cambiar contenido:
                            <ol>
                                <li>Debes generar un nuevo contrato con los datos correctos</li>
                                <li>El contrato anterior quedará como registro histórico</li>
                            </ol>
                            Solo puedes agregar la versión firmada, no modificar el contenido del PDF.
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question">
                            <i class="bi bi-question-circle-fill me-2"></i>
                            ¿Cómo identifico rápidamente contratos con versión firmada?
                        </div>
                        <div class="faq-answer">
                            Los contratos con versión firmada muestran un badge morado con ícono de verificación que dice 
                            "Versión Firmada" directamente en la columna "Nombre del Contrato". Además, tienen el botón 
                            "Ver Firmado" en la columna de acciones.
                        </div>
                    </div>
                </div>

                <!-- ============================================ -->
                <!-- SECCIÓN 9: CONSEJOS PARA DIRECTIVOS -->
                <!-- ============================================ -->
                <div class="manual-section">
                    <h3><i class="bi bi-lightbulb me-2"></i>Consejos Estratégicos para Directivos</h3>

                    <div class="info-box success">
                        <strong><i class="bi bi-calendar-check me-2"></i>Revisión periódica:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Revisa semanalmente los contratos "Por vencer (30 días)"</li>
                            <li>Esto te da tiempo suficiente para procesar renovaciones</li>
                            <li>Evita vencimientos inesperados que puedan afectar operaciones</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <strong><i class="bi bi-graph-up me-2"></i>Análisis de tendencias:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Usa el gráfico de meses para identificar patrones de contratación</li>
                            <li>Si hay picos recurrentes, planifica recursos para esos meses</li>
                            <li>Si hay caídas inesperadas, investiga las causas</li>
                        </ul>
                    </div>

                    <div class="info-box warning">
                        <strong><i class="bi bi-shield-check me-2"></i>Control de versiones firmadas:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Establece un proceso para subir versiones firmadas rápidamente</li>
                            <li>Define quién es responsable de esta tarea</li>
                            <li>Contratos sin versión firmada carecen de validez legal completa</li>
                        </ul>
                    </div>

                    <div class="info-box success">
                        <strong><i class="bi bi-people me-2"></i>Distribución de trabajo:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Usa la métrica "Top Generador" para identificar carga de trabajo</li>
                            <li>Si un usuario genera muchos más contratos que otros, considera redistribuir</li>
                            <li>Balancea la carga para evitar cuellos de botella</li>
                        </ul>
                    </div>

                    <div class="info-box">
                        <strong><i class="bi bi-folder-check me-2"></i>Auditoría por categoría:</strong>
                        <ul class="mb-0 mt-2">
                            <li>El gráfico circular te muestra la composición del personal</li>
                            <li>Compara con el organigrama ideal de la institución</li>
                            <li>Identifica desbalances (ej: pocos contratos de servicios generales)</li>
                        </ul>
                    </div>

                    <div class="info-box warning">
                        <strong><i class="bi bi-clock-history me-2"></i>Gestión proactiva:</strong>
                        <ul class="mb-0 mt-2">
                            <li>No esperes a que los contratos venzan para actuar</li>
                            <li>Crea recordatorios mensuales para revisar vencimientos</li>
                            <li>Mantén comunicación anticipada con el personal próximo a renovar</li>
                        </ul>
                    </div>
                </div>

                <!-- TARJETA PARA REPORTAR BUGS -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../report-bug.html" class="btn btn-danger btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Herramientas Generales',
            modulePath: 'general-tools',
            pageTitle: 'Dashboard de Contratos',
            pagePath: 'contracts-dashboard.html',
            moduleDescription: 'Vista gerencial completa de contratos generados'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            // Actualizar title
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
