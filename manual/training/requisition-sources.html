<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="26.01.26.09.08">
    
    <title>Manual - Fuentes de Requisición - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Secciones del manual */
        .section-title {
            color: var(--system-primary-color, #1B365D);
            font-size: 1.5rem;
            margin-top: 2.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        /* Tarjetas de pasos */
        .step-card {
            background: #f8f9fa;
            border-left: 4px solid var(--system-primary-color, #1B365D);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 1rem;
        }

        /* Cajas de información */
        .info-box {
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
        }

        .info-box.warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .info-box.tip {
            background: #d1ecf1;
            border-left: 4px solid #0dcaf0;
        }

        .info-box.important {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .info-box.success {
            background: #d1e7dd;
            border-left: 4px solid #198754;
        }

        /* Listas personalizadas */
        .custom-list {
            list-style: none;
            padding-left: 0;
        }

        .custom-list li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .custom-list li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--system-primary-color, #1B365D);
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Tarjeta para reportar bugs - USANDO COLOR PRIMARIO PARA MEJOR CONTRASTE */
        .bug-report-card {
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-top: 3rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        /* Botón flotante para reportar bugs */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #1B365D) !important;
            border-color: var(--system-primary-color, #1B365D) !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Tabla de ejemplo */
        .example-table {
            font-size: 0.9rem;
        }

        .example-table th {
            background: #f8f9fa;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Fuentes de Requisición
                        </h1>
                        <p class="subtitle mb-0">Formación - Gestionar Fuentes de Requisición</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/training/requisition-sources.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-9 mx-auto">

                <!-- INFORMACIÓN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong id="display-module">Formación</strong></h5>
                            <p class="text-muted mb-0 small" id="display-page">Gestionar Fuentes de Requisición</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras algún problema,<br>
                                puedes reportarlo usando el botón de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- SECCIÓN 1: ¿QUÉ ES? -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-info-circle me-2"></i>
                        ¿Qué son las Fuentes de Requisición?
                    </h2>
                    
                    <div class="step-card">
                        <p class="lead mb-3">
                            Las <strong>Fuentes de Requisición</strong> son los orígenes o entidades que establecen requerimientos de formación para el personal de la institución. Identifican <strong>quién</strong> o <strong>qué organismo</strong> solicita o exige que se realice una capacitación específica.
                        </p>
                        
                        <p>
                            Estas fuentes pueden ser internas (originadas en la institución misma) o externas (provenientes de organismos reguladores, certificaciones internacionales, normativas legales, etc.).
                        </p>

                        <div class="info-box tip mt-3">
                            <strong><i class="bi bi-lightbulb me-2"></i>¿Para qué sirven?</strong>
                            <p class="mb-0 mt-2">
                                Permiten rastrear el origen de cada requisito formativo, facilitan el cumplimiento de obligaciones legales y normativas, ayudan a priorizar capacitaciones según su procedencia y permiten generar reportes de cumplimiento por fuente.
                            </p>
                        </div>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3">Ejemplos de Fuentes de Requisición</h5>
                        <table class="table table-sm example-table">
                            <thead>
                                <tr>
                                    <th style="width: 15%;">Tipo</th>
                                    <th style="width: 25%;">Fuente</th>
                                    <th>Descripción</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="badge bg-info">Externa</span></td>
                                    <td><strong>IB (Bachillerato Internacional)</strong></td>
                                    <td>Formación requerida para implementación de programas IB</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-info">Externa</span></td>
                                    <td><strong>SGSST (Sistema de Gestión SST)</strong></td>
                                    <td>Capacitaciones obligatorias en seguridad y salud en el trabajo</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-info">Externa</span></td>
                                    <td><strong>Ley de Habeas Data</strong></td>
                                    <td>Formación en protección de datos personales</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-info">Externa</span></td>
                                    <td><strong>Ministerio de Educación</strong></td>
                                    <td>Requisitos de formación docente establecidos por el MEN</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-info">Externa</span></td>
                                    <td><strong>Resolución 2646</strong></td>
                                    <td>Formación en factores de riesgo psicosocial</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-primary">Interna</span></td>
                                    <td><strong>PEI (Proyecto Educativo Institucional)</strong></td>
                                    <td>Formación alineada con el proyecto educativo del colegio</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-primary">Interna</span></td>
                                    <td><strong>Plan de Mejoramiento</strong></td>
                                    <td>Capacitaciones derivadas de procesos de mejora institucional</td>
                                </tr>
                                <tr>
                                    <td><span class="badge bg-primary">Interna</span></td>
                                    <td><strong>Coordinación Académica</strong></td>
                                    <td>Necesidades de formación identificadas por coordinadores</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- SECCIÓN 2: CARACTERÍSTICAS PRINCIPALES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-star me-2"></i>
                        Características principales
                    </h2>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="step-card">
                                <h5><i class="bi bi-list-ul text-primary me-2"></i>Catálogo organizado</h5>
                                <p class="mb-0">Visualiza todas las fuentes clasificadas por tipo (Interna/Externa) con contador de unidades asociadas.</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="step-card">
                                <h5><i class="bi bi-plus-circle text-success me-2"></i>Creación flexible</h5>
                                <p class="mb-0">Agrega fuentes específicas de tu institución con nombre, tipo y descripción personalizada.</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="step-card">
                                <h5><i class="bi bi-diagram-3 text-info me-2"></i>Diferenciación clara</h5>
                                <p class="mb-0">Clasifica fuentes como Internas (del colegio) o Externas (organismos externos) para mejor trazabilidad.</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="step-card">
                                <h5><i class="bi bi-toggle-on text-warning me-2"></i>Control de estado</h5>
                                <p class="mb-0">Activa o desactiva fuentes según necesidad. Las inactivas no están disponibles para nuevas asignaciones.</p>
                            </div>
                        </div>
                    </div>

                    <div class="step-card mt-4">
                        <h5 class="mb-3">Diferencia entre Fuentes Internas y Externas</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary"><i class="bi bi-building me-2"></i>Fuentes Internas</h6>
                                <p class="small mb-2">
                                    Requisiciones que se originan dentro de la institución educativa, basadas en necesidades identificadas internamente o en el proyecto educativo propio.
                                </p>
                                <p class="small mb-1"><strong>Características:</strong></p>
                                <ul class="small">
                                    <li>Originadas en el colegio</li>
                                    <li>Basadas en PEI, planes institucionales</li>
                                    <li>Decisión autónoma de la institución</li>
                                    <li>Mayor flexibilidad en implementación</li>
                                </ul>
                                <p class="small mb-0"><strong>Ejemplos:</strong> PEI, Plan de Mejoramiento, Coordinación Académica, Dirección, Comités Internos</p>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-info"><i class="bi bi-globe me-2"></i>Fuentes Externas</h6>
                                <p class="small mb-2">
                                    Requisiciones que provienen de organismos externos, normativas legales, certificaciones internacionales u otras entidades reguladoras.
                                </p>
                                <p class="small mb-1"><strong>Características:</strong></p>
                                <ul class="small">
                                    <li>Originadas fuera del colegio</li>
                                    <li>Obligatorias o requeridas para certificaciones</li>
                                    <li>Definidas por entidades externas</li>
                                    <li>Menor flexibilidad (cumplimiento obligatorio)</li>
                                </ul>
                                <p class="small mb-0"><strong>Ejemplos:</strong> IB, SGSST, Ministerio de Educación, Normativas legales, Auditorías externas</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 3: ANTES DE COMENZAR -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-clipboard-check me-2"></i>
                        Antes de comenzar
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3">Requisitos previos</h5>
                        
                        <ul class="custom-list">
                            <li><strong>Permiso necesario:</strong> Debes tener el permiso "Gestionar fuentes de requisición" asignado en tu cuenta.</li>
                            <li><strong>Conocimiento institucional:</strong> Identifica qué organismos o entidades establecen requerimientos de formación en tu institución.</li>
                            <li><strong>Revisión normativa:</strong> Ten claro qué obligaciones legales y normativas aplican a tu colegio.</li>
                        </ul>

                        <div class="info-box warning mt-3">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Importante</strong>
                            <p class="mb-0">
                                Registra solo las fuentes que realmente aplican a tu institución. Un catálogo muy amplio con fuentes no utilizadas dificulta la gestión y el reporte de cumplimiento.
                            </p>
                        </div>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3">¿Cómo decidir el tipo de fuente?</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary"><i class="bi bi-check-circle me-2"></i>Marca como INTERNA si:</h6>
                                <ul>
                                    <li>El requisito nace en el colegio</li>
                                    <li>Lo define un área o coordinación interna</li>
                                    <li>Está en el PEI o planes institucionales</li>
                                    <li>Es una iniciativa propia de mejora</li>
                                    <li>No hay obligación externa de cumplirlo</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-info"><i class="bi bi-check-circle me-2"></i>Marca como EXTERNA si:</h6>
                                <ul>
                                    <li>Proviene de una entidad externa</li>
                                    <li>Es una obligación legal o normativa</li>
                                    <li>Se requiere para certificación</li>
                                    <li>Lo establece un organismo regulador</li>
                                    <li>Hay sanciones por incumplimiento</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3">Buenas prácticas de nomenclatura</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-success"><i class="bi bi-check-circle me-2"></i>Recomendado:</h6>
                                <ul>
                                    <li>Usar nombres oficiales completos</li>
                                    <li>Incluir siglas reconocidas (IB, SGSST, MEN)</li>
                                    <li>Ser específico y claro</li>
                                    <li>Mantener consistencia en mayúsculas</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-danger"><i class="bi bi-x-circle me-2"></i>Evitar:</h6>
                                <ul>
                                    <li>Nombres genéricos ("Externo", "Legal")</li>
                                    <li>Siglas sin explicación en descripción</li>
                                    <li>Nombres muy largos o complejos</li>
                                    <li>Fuentes duplicadas con nombres similares</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 4: GUÍA PASO A PASO -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-list-ol me-2"></i>
                        Guía paso a paso
                    </h2>

                    <!-- CREAR NUEVA FUENTE -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">1</span>
                            Crear una nueva fuente de requisición
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Para agregar una nueva fuente al catálogo:</strong></p>
                        <ol>
                            <li class="mb-2">En la página principal, haz clic en el botón azul <strong>"Nueva Fuente"</strong> ubicado en la parte superior derecha</li>
                            <li class="mb-2">Se abrirá un formulario con los siguientes campos:
                                <ul class="mt-2">
                                    <li><strong>Nombre de la Fuente:</strong> Campo obligatorio (ej: "IB", "SGSST", "PEI")</li>
                                    <li><strong>Tipo de Fuente:</strong> Campo obligatorio. Selecciona "Interna" o "Externa"</li>
                                    <li><strong>Descripción:</strong> Campo opcional. Explica qué requisitos establece esta fuente</li>
                                    <li><strong>Estado:</strong> Campo obligatorio. Selecciona "Activo" (por defecto) o "Inactivo"</li>
                                </ul>
                            </li>
                            <li class="mb-2">Completa el nombre de la fuente (campo obligatorio)</li>
                            <li class="mb-2">Selecciona el tipo:
                                <ul class="mt-2">
                                    <li><strong>Interna:</strong> Si es un requisito del colegio (PEI, Plan de Mejora)</li>
                                    <li><strong>Externa:</strong> Si proviene de un organismo externo (IB, MEN, SGSST)</li>
                                </ul>
                            </li>
                            <li class="mb-2">Agrega una descripción explicando qué tipo de formación requiere esta fuente</li>
                            <li class="mb-2">Haz clic en el botón verde <strong>"Guardar"</strong></li>
                            <li>La nueva fuente aparecerá en la tabla principal</li>
                        </ol>

                        <div class="info-box success mt-3">
                            <strong><i class="bi bi-check-circle me-2"></i>Confirmación</strong>
                            <p class="mb-0">
                                Verás un mensaje verde confirmando que la fuente fue creada exitosamente. La nueva fuente aparecerá inmediatamente en la lista ordenada alfabéticamente.
                            </p>
                        </div>
                    </div>

                    <!-- VER LISTADO -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">2</span>
                            Consultar el catálogo de fuentes
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>La tabla muestra la siguiente información:</strong></p>
                        <ul>
                            <li><strong>#:</strong> Número de orden en la lista actual</li>
                            <li><strong>Nombre de la Fuente:</strong> Nombre completo de la fuente de requisición</li>
                            <li><strong>Tipo:</strong> Badge azul "Interna" o badge celeste "Externa"</li>
                            <li><strong>Descripción:</strong> Información adicional sobre la fuente</li>
                            <li><strong>Unidades:</strong> Cantidad de unidades formativas asociadas a esta fuente (badge amarillo con número)</li>
                            <li><strong>Estado:</strong> Badge verde si está activa, gris si está inactiva</li>
                            <li><strong>Acciones:</strong> Botones para editar o cambiar estado</li>
                        </ul>

                        <div class="info-box tip mt-3">
                            <strong><i class="bi bi-lightbulb me-2"></i>Interpretación de badges</strong>
                            <p class="mb-0">
                                El color del badge de "Tipo" te permite identificar rápidamente si una fuente es de origen interno o externo, lo cual es útil para priorizar y reportar cumplimientos.
                            </p>
                        </div>
                    </div>

                    <!-- EDITAR FUENTE -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">3</span>
                            Editar una fuente existente
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Para modificar una fuente de requisición:</strong></p>
                        <ol>
                            <li class="mb-2">Ubica la fuente que deseas editar en la tabla</li>
                            <li class="mb-2">En la columna "Acciones", haz clic en el botón azul con icono de lápiz <i class="bi bi-pencil"></i></li>
                            <li class="mb-2">Se abrirá el formulario con los datos actuales de la fuente prellenados</li>
                            <li class="mb-2">Modifica los campos que necesites cambiar</li>
                            <li class="mb-2">Puedes cambiar el tipo de Interna a Externa o viceversa si fue clasificada incorrectamente</li>
                            <li class="mb-2">Haz clic en <strong>"Guardar"</strong></li>
                            <li>Los cambios se aplicarán inmediatamente</li>
                        </ol>

                        <div class="info-box warning mt-3">
                            <strong><i class="bi bi-info-circle me-2"></i>Fuentes con unidades asociadas</strong>
                            <p class="mb-0 mt-2">
                                Si la fuente está asociada a unidades formativas, verás una alerta informativa mostrando cuántas unidades están vinculadas. Ten cuidado al modificar información fundamental, especialmente para fuentes externas que tienen requisitos específicos.
                            </p>
                        </div>
                    </div>

                    <!-- CAMBIAR ESTADO -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">4</span>
                            Activar o desactivar una fuente
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Para cambiar el estado de una fuente:</strong></p>
                        <ol>
                            <li class="mb-2">Ubica la fuente en la tabla</li>
                            <li class="mb-2">En la columna "Acciones", observa el segundo botón:
                                <ul class="mt-2">
                                    <li>Si está activa: verás un icono amarillo <i class="bi bi-toggle-on"></i> (desactivar)</li>
                                    <li>Si está inactiva: verás un icono verde <i class="bi bi-toggle-off"></i> (activar)</li>
                                </ul>
                            </li>
                            <li class="mb-2">Haz clic en el botón correspondiente</li>
                            <li class="mb-2">Confirma la acción en el mensaje que aparece</li>
                            <li>El estado cambiará inmediatamente</li>
                        </ol>

                        <div class="info-box important mt-3">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Efecto de desactivar una fuente</strong>
                            <p class="mb-2 mt-2">
                                Cuando desactivas una fuente de requisición:
                            </p>
                            <ul class="mb-0">
                                <li>Ya NO estará disponible para asignar a nuevas unidades formativas</li>
                                <li>Las unidades formativas que ya tienen esta fuente asignada NO se ven afectadas</li>
                                <li>La fuente permanece en la base de datos y puede reactivarse</li>
                                <li>Útil cuando una normativa deja de aplicar o una certificación se suspende temporalmente</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 5: SOLUCIÓN DE PROBLEMAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-question-circle me-2"></i>
                        Solución de problemas comunes
                    </h2>

                    <div class="step-card">
                        <h5 class="text-danger mb-3"><i class="bi bi-exclamation-triangle me-2"></i>No puedo crear una fuente con cierto nombre</h5>
                        <p><strong>Causa probable:</strong></p>
                        <p>Ya existe una fuente de requisición con ese nombre exacto en el sistema.</p>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>Verifica si la fuente ya existe en la lista (puede estar inactiva)</li>
                            <li>Si existe pero está inactiva, actívala en lugar de crear una nueva</li>
                            <li>Si necesitas diferenciar, agrega un calificador (ej: "SGSST - 2024" si cambió normativa)</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="text-warning mb-3"><i class="bi bi-exclamation-triangle me-2"></i>No sé si clasificar una fuente como Interna o Externa</h5>
                        <p><strong>Pregunta clave:</strong></p>
                        <p>¿Esta formación es requerida por una entidad u organismo fuera del colegio?</p>
                        <p><strong>Respuestas:</strong></p>
                        <ul>
                            <li><strong>SÍ</strong> (proviene de afuera) → <span class="badge bg-info">Externa</span></li>
                            <li><strong>NO</strong> (nace en el colegio) → <span class="badge bg-primary">Interna</span></li>
                        </ul>
                        <p class="mt-2"><strong>Ejemplos:</strong></p>
                        <ul>
                            <li>¿Es obligatoria por ley? → Externa</li>
                            <li>¿La exige el IB o MEN? → Externa</li>
                            <li>¿Está en nuestro PEI? → Interna</li>
                            <li>¿La definió nuestra coordinación? → Interna</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="text-danger mb-3"><i class="bi bi-exclamation-triangle me-2"></i>El contador de unidades no coincide con lo esperado</h5>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>Haz clic en el botón "Actualizar" en la parte superior de la página</li>
                            <li>El contador refleja unidades formativas activas asociadas a esta fuente</li>
                            <li>Si el problema persiste, recarga la página completa (F5)</li>
                            <li>Verifica que las unidades formativas tengan correctamente asignada la fuente</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="text-warning mb-3"><i class="bi bi-exclamation-triangle me-2"></i>Tengo muchas fuentes externas similares</h5>
                        <p><strong>Recomendación:</strong></p>
                        <p>Si tienes varias resoluciones o normativas del mismo organismo, considera:</p>
                        <ul>
                            <li>Agrupar bajo el nombre del organismo principal (ej: "SGSST" en lugar de cada resolución)</li>
                            <li>Especificar en la descripción las normativas específicas que aplican</li>
                            <li>Mantener fuentes separadas solo si generan reportes de cumplimiento diferentes</li>
                            <li>Un catálogo simple facilita la gestión y los reportes</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 6: BUENAS PRÁCTICAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-award me-2"></i>
                        Buenas prácticas
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-check-circle text-success me-2"></i>Al crear fuentes</h5>
                        
                        <ul class="custom-list">
                            <li>Revisa primero qué fuentes ya existen antes de crear una nueva</li>
                            <li>Usa nombres oficiales completos para fuentes externas</li>
                            <li>Completa siempre la descripción explicando qué tipo de formación requiere</li>
                            <li>Clasifica correctamente como Interna o Externa desde el inicio</li>
                            <li>Mantén un catálogo simple con 10-20 fuentes principales</li>
                            <li>Documenta el origen legal/normativo en la descripción</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-shield-check text-info me-2"></i>Mantenimiento del catálogo</h5>
                        
                        <ul class="custom-list">
                            <li>Revisa anualmente las fuentes externas (las normativas pueden cambiar)</li>
                            <li>Actualiza descripciones cuando cambien requisitos o normativas</li>
                            <li>Desactiva fuentes que ya no aplican (ej: certificaciones vencidas)</li>
                            <li>Consolida fuentes similares para simplificar reportes</li>
                            <li>Mantén comunicación con áreas legales y de cumplimiento</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-people text-warning me-2"></i>Trazabilidad y cumplimiento</h5>
                        
                        <ul class="custom-list">
                            <li>Usa las fuentes para generar reportes de cumplimiento regulatorio</li>
                            <li>Prioriza capacitaciones de fuentes externas (obligatorias legalmente)</li>
                            <li>Documenta bien las fuentes para auditorías y revisiones</li>
                            <li>Relaciona cada unidad formativa con su fuente para trazabilidad completa</li>
                            <li>Revisa periódicamente el cumplimiento por cada fuente externa</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 7: PREGUNTAS FRECUENTES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-chat-dots me-2"></i>
                        Preguntas frecuentes
                    </h2>

                    <div class="accordion" id="faqAccordion">
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                    ¿Cuántas fuentes de requisición debería tener?
                                </button>
                            </h2>
                            <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Se recomienda mantener entre 10 y 20 fuentes principales. La cantidad exacta depende de tu institución: certificaciones que tengas (IB, Cambridge), normativas que apliquen (SGSST, Habeas Data), y áreas internas que generen requisitos (PEI, coordinaciones). Agrupa fuentes similares cuando sea posible para simplificar la gestión.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                    ¿Qué diferencia hay entre Interna y Externa?
                                </button>
                            </h2>
                            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <strong>Externa:</strong> El requisito proviene de fuera del colegio (organismos reguladores, certificaciones, leyes). Son generalmente obligatorias y tienen consecuencias por incumplimiento. <strong>Interna:</strong> El requisito nace dentro del colegio (PEI, planes de mejora, iniciativas institucionales). Son definidas autónomamente por la institución y tienen mayor flexibilidad.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                    ¿Debo crear una fuente para cada normativa o resolución?
                                </button>
                            </h2>
                            <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    No necesariamente. Es mejor agrupar por organismo o tema general. Por ejemplo, en lugar de crear fuentes separadas para cada resolución del SGSST, crea una fuente "SGSST" y en la descripción menciona las resoluciones específicas. Crea fuentes separadas solo si requieres reportes de cumplimiento diferenciados.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                    ¿Puedo cambiar una fuente de Interna a Externa después de crearla?
                                </button>
                            </h2>
                            <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Sí, puedes cambiar el tipo en cualquier momento editando la fuente. Esto puede ser necesario si inicialmente se clasificó incorrectamente o si cambia la naturaleza del requisito (por ejemplo, algo que era interno se convierte en requisito externo por una nueva normativa).
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                                    ¿Qué pasa si desactivo una fuente que tiene unidades asociadas?
                                </button>
                            </h2>
                            <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Las unidades formativas existentes NO se ven afectadas y mantendrán la asociación con esa fuente. Lo único que cambia es que esa fuente ya NO estará disponible para asignar a nuevas unidades. Esto es útil cuando una normativa deja de aplicar o una certificación se suspende, pero quieres mantener el historial.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq6">
                                    ¿Cómo uso las fuentes para reportes de cumplimiento?
                                </button>
                            </h2>
                            <div id="faq6" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Las fuentes de requisición permiten generar reportes mostrando qué capacitaciones se han realizado para cumplir con cada requisito. Esto es especialmente importante para fuentes externas como SGSST o certificaciones, donde debes demostrar cumplimiento en auditorías. El sistema puede filtrar y reportar por fuente específica.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq7">
                                    ¿El PEI es una fuente Interna o Externa?
                                </button>
                            </h2>
                            <div id="faq7" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    El PEI (Proyecto Educativo Institucional) es una fuente <strong>Interna</strong>. Aunque puede estar regulado externamente su existencia, el contenido y los requisitos de formación que se derivan del PEI son definidos por la propia institución. Es un documento interno que guía las decisiones formativas del colegio.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq8">
                                    ¿Puedo tener una capacitación sin fuente de requisición?
                                </button>
                            </h2>
                            <div id="faq8" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Técnicamente sí, el sistema permite unidades formativas sin fuente asignada. Sin embargo, es una buena práctica SIEMPRE asignar una fuente. Si no hay una fuente específica, crea una fuente interna genérica como "Desarrollo Profesional Docente" o "Iniciativa Institucional" para mantener trazabilidad completa.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq9">
                                    ¿Debo crear fuentes para todas las coordinaciones internas?
                                </button>
                            </h2>
                            <div id="faq9" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Depende de tu necesidad de trazabilidad. Si necesitas reportar por área (Coordinación Académica, Coordinación de Convivencia, etc.), crea fuentes separadas. Si solo necesitas saber que es un requisito interno, una fuente genérica "Coordinación Interna" o "Gestión Institucional" puede ser suficiente. Evita crear demasiadas fuentes internas similares.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq10">
                                    ¿Quién puede gestionar las fuentes de requisición?
                                </button>
                            </h2>
                            <div id="faq10" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Solo los usuarios que tengan el permiso "Gestionar fuentes de requisición" pueden acceder a esta página y realizar cambios. Este permiso generalmente se asigna a coordinadores de formación, responsables de cumplimiento normativo, áreas de calidad y administradores del sistema. Si necesitas agregar una fuente nueva, contacta a estas personas.
                                </div>
                            </div>
                        </div>

                    </div>
                </section>

                <!-- ========================================== -->
                <!-- FIN DEL CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- TARJETA PARA REPORTAR BUGS -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../report-bug.html" class="btn btn-danger btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Formación',
            modulePath: 'training',
            pageTitle: 'Gestionar Fuentes de Requisición',
            pagePath: 'requisition-sources.html',
            moduleDescription: 'Orígenes de los requerimientos de formación'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            // Actualizar title
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
