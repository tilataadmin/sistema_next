<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="26.01.26.09.20">
    
    <title>Manual - Unidades Formativas - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Secciones del manual */
        .section-title {
            color: var(--system-primary-color, #1B365D);
            font-size: 1.5rem;
            margin-top: 2.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        /* Tarjetas de pasos */
        .step-card {
            background: #f8f9fa;
            border-left: 4px solid var(--system-primary-color, #1B365D);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 1rem;
        }

        /* Cajas de información */
        .info-box {
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
        }

        .info-box.warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .info-box.tip {
            background: #d1ecf1;
            border-left: 4px solid #0dcaf0;
        }

        .info-box.important {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .info-box.success {
            background: #d1e7dd;
            border-left: 4px solid #198754;
        }

        /* Listas personalizadas */
        .custom-list {
            list-style: none;
            padding-left: 0;
        }

        .custom-list li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .custom-list li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--system-primary-color, #1B365D);
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Tarjeta para reportar bugs - USANDO COLOR PRIMARIO PARA MEJOR CONTRASTE */
        .bug-report-card {
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-top: 3rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        /* Botón flotante para reportar bugs */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #1B365D) !important;
            border-color: var(--system-primary-color, #1B365D) !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Tabla de ejemplo */
        .example-table {
            font-size: 0.9rem;
        }

        .example-table th {
            background: #f8f9fa;
        }

        /* Destacar pestañas */
        .tab-badge {
            display: inline-block;
            background: var(--system-primary-color, #1B365D);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Unidades Formativas
                        </h1>
                        <p class="subtitle mb-0">Formación - Gestionar Unidades Formativas</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/training/modules.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-9 mx-auto">

                <!-- INFORMACIÓN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong id="display-module">Formación</strong></h5>
                            <p class="text-muted mb-0 small" id="display-page">Gestionar Unidades Formativas</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras algún problema,<br>
                                puedes reportarlo usando el botón de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- SECCIÓN 1: ¿QUÉ ES? -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-info-circle me-2"></i>
                        ¿Qué son las Unidades Formativas?
                    </h2>
                    
                    <div class="step-card">
                        <p class="lead mb-3">
                            Las <strong>Unidades Formativas</strong> son las capacitaciones, cursos, talleres o formaciones específicas que ofrece la institución. Representan el elemento central del sistema de formación y contienen toda la información sobre cada actividad formativa.
                        </p>
                        
                        <p>
                            Cada unidad formativa define qué se enseña, cómo se enseña, quién lo facilita, a quiénes está dirigida, qué habilidades desarrolla y cómo se evalúa el cumplimiento.
                        </p>

                        <div class="info-box tip mt-3">
                            <strong><i class="bi bi-lightbulb me-2"></i>¿Para qué sirven?</strong>
                            <p class="mb-0 mt-2">
                                Son la base para asignar capacitaciones a trabajadores, hacer seguimiento del desarrollo profesional, generar rutas de formación personalizadas y reportar cumplimiento de requisitos formativos.
                            </p>
                        </div>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3">Ejemplos de Unidades Formativas</h5>
                        <table class="table table-sm example-table">
                            <thead>
                                <tr>
                                    <th>Título</th>
                                    <th>Eje Formativo</th>
                                    <th>Modalidad</th>
                                    <th>Duración</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Introducción a la Pedagogía IB</strong></td>
                                    <td>IB (Bachillerato Internacional)</td>
                                    <td>Virtual Sincrónica</td>
                                    <td>20 horas</td>
                                </tr>
                                <tr>
                                    <td><strong>Manejo de Extintores</strong></td>
                                    <td>SGSST (Seguridad y Salud)</td>
                                    <td>Presencial</td>
                                    <td>2 horas</td>
                                </tr>
                                <tr>
                                    <td><strong>Protección de Datos Personales</strong></td>
                                    <td>Habeas Data</td>
                                    <td>Virtual Asincrónica</td>
                                    <td>4 horas</td>
                                </tr>
                                <tr>
                                    <td><strong>Evaluación Formativa en el Aula</strong></td>
                                    <td>Pedagogía</td>
                                    <td>Taller Práctico</td>
                                    <td>8 horas</td>
                                </tr>
                                <tr>
                                    <td><strong>Google Workspace para Docentes</strong></td>
                                    <td>Tecnología Educativa</td>
                                    <td>Híbrida</td>
                                    <td>12 horas</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- SECCIÓN 2: CARACTERÍSTICAS PRINCIPALES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-star me-2"></i>
                        Características principales
                    </h2>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="step-card">
                                <h5><i class="bi bi-ui-checks text-primary me-2"></i>Formulario de 3 pestañas</h5>
                                <p class="mb-0">Información organizada en: Básica, Descripción/Metodología, y Certificación/Estado para facilitar el registro.</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="step-card">
                                <h5><i class="bi bi-diagram-3 text-success me-2"></i>Múltiples relaciones</h5>
                                <p class="mb-0">Se vincula con ejes, modalidades, fuentes, facilitadores, habilidades y roles para una gestión integral.</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="step-card">
                                <h5><i class="bi bi-sliders text-info me-2"></i>Configuración flexible</h5>
                                <p class="mb-0">Define prioridad, obligatoriedad, certificación y criterios de cumplimiento según las necesidades.</p>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="step-card">
                                <h5><i class="bi bi-graph-up text-warning me-2"></i>Seguimiento completo</h5>
                                <p class="mb-0">Contadores de habilidades, facilitadores, roles y trabajadores asignados para visibilidad total.</p>
                            </div>
                        </div>
                    </div>

                    <div class="step-card mt-4">
                        <h5 class="mb-3">Estructura del formulario en 3 pestañas</h5>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <h6 class="text-primary"><i class="bi bi-1-circle me-2"></i>Información Básica</h6>
                                <ul class="small">
                                    <li>Título (obligatorio)</li>
                                    <li>Eje Formativo (obligatorio)</li>
                                    <li>Modalidad (obligatorio)</li>
                                    <li>Fuente de Requisición (opcional)</li>
                                    <li>Duración en horas (opcional)</li>
                                    <li>Prioridad (opcional)</li>
                                    <li>¿Obligatoria para todos? (checkbox)</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <h6 class="text-success"><i class="bi bi-2-circle me-2"></i>Descripción y Metodología</h6>
                                <ul class="small">
                                    <li>Propósito (opcional)</li>
                                    <li>Descripción Detallada (opcional)</li>
                                    <li>Método de Evaluación (opcional)</li>
                                    <li>Criterios de Cumplimiento (opcional)</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <h6 class="text-info"><i class="bi bi-3-circle me-2"></i>Certificación y Estado</h6>
                                <ul class="small">
                                    <li>¿Otorga certificación? (checkbox)</li>
                                    <li>Tipo de Certificación (condicional)</li>
                                    <li>Estado Activo/Inactivo (obligatorio)</li>
                                    <li>Contadores de relaciones (solo en edición)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 3: ANTES DE COMENZAR -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-clipboard-check me-2"></i>
                        Antes de comenzar
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3">Requisitos previos</h5>
                        
                        <ul class="custom-list">
                            <li><strong>Permiso necesario:</strong> Debes tener el permiso "Gestionar unidades formativas" asignado.</li>
                            <li><strong>Ejes formativos:</strong> Debe haber al menos un eje formativo activo creado previamente.</li>
                            <li><strong>Modalidades:</strong> Debe haber al menos una modalidad activa creada previamente.</li>
                            <li><strong>Información clara:</strong> Ten definido el título, propósito y metodología de la capacitación.</li>
                        </ul>

                        <div class="info-box warning mt-3">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Importante</strong>
                            <p class="mb-0">
                                Los campos obligatorios son solo tres: Título, Eje Formativo y Modalidad. El resto de campos son opcionales, pero se recomienda completarlos para una gestión más efectiva.
                            </p>
                        </div>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3">Campos obligatorios vs opcionales</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-danger"><i class="bi bi-asterisk me-2"></i>Obligatorios (3 campos):</h6>
                                <ul>
                                    <li><strong>Título:</strong> Nombre de la unidad formativa</li>
                                    <li><strong>Eje Formativo:</strong> Categoría temática</li>
                                    <li><strong>Modalidad:</strong> Formato de entrega</li>
                                </ul>
                                <p class="small text-muted mt-2">Estos tres campos son indispensables para crear una unidad.</p>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-success"><i class="bi bi-check-circle me-2"></i>Recomendados (completa según necesidad):</h6>
                                <ul class="small">
                                    <li>Fuente de Requisición (para trazabilidad)</li>
                                    <li>Duración (para planificación)</li>
                                    <li>Prioridad (para organización)</li>
                                    <li>Propósito y Descripción (para claridad)</li>
                                    <li>Criterios de Cumplimiento (para evaluación)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 4: GUÍA PASO A PASO -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-list-ol me-2"></i>
                        Guía paso a paso
                    </h2>

                    <!-- CREAR UNIDAD FORMATIVA -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">1</span>
                            Crear una nueva unidad formativa
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Para agregar una nueva unidad formativa:</strong></p>
                        <ol>
                            <li class="mb-2">Haz clic en el botón azul <strong>"Nueva Unidad"</strong> en la parte superior derecha</li>
                            <li class="mb-3">Se abrirá un modal con formulario de 3 pestañas. Completa la información:
                                
                                <div class="mt-3 mb-3">
                                    <h6 class="text-primary"><i class="bi bi-1-circle me-2"></i>Pestaña 1: Información Básica</h6>
                                    <ul>
                                        <li><strong>Título:</strong> Escribe el nombre de la capacitación (ej: "Introducción a la Pedagogía IB")</li>
                                        <li><strong>Eje Formativo:</strong> Selecciona la categoría temática del dropdown</li>
                                        <li><strong>Modalidad:</strong> Selecciona el formato (Presencial, Virtual, etc.)</li>
                                        <li><strong>Fuente de Requisición:</strong> Opcional. Selecciona el origen del requisito si aplica</li>
                                        <li><strong>Duración:</strong> Opcional. Ingresa las horas totales (acepta decimales: 1.5, 2.5, etc.)</li>
                                        <li><strong>Prioridad:</strong> Opcional. Selecciona Alta, Media o Baja</li>
                                        <li><strong>¿Es obligatoria para todos?</strong> Marca el checkbox solo si TODOS los trabajadores deben tomarla</li>
                                    </ul>
                                </div>

                                <div class="mt-3 mb-3">
                                    <h6 class="text-success"><i class="bi bi-2-circle me-2"></i>Pestaña 2: Descripción y Metodología</h6>
                                    <p class="small mb-2">Todos estos campos son opcionales, pero recomendados:</p>
                                    <ul>
                                        <li><strong>Propósito:</strong> Describe qué se busca lograr con esta capacitación</li>
                                        <li><strong>Descripción Detallada:</strong> Explica los contenidos, temario, alcance</li>
                                        <li><strong>Método de Evaluación:</strong> Cómo se evaluará (asistencia, examen, trabajo práctico, etc.)</li>
                                        <li><strong>Criterios de Cumplimiento:</strong> Qué debe lograr el trabajador para considerarse cumplida</li>
                                    </ul>
                                </div>

                                <div class="mt-3 mb-3">
                                    <h6 class="text-info"><i class="bi bi-3-circle me-2"></i>Pestaña 3: Certificación y Estado</h6>
                                    <ul>
                                        <li><strong>¿Otorga certificación?</strong> Marca si al completarla se entrega certificado</li>
                                        <li><strong>Tipo de Certificación:</strong> Solo aparece si marcaste el checkbox anterior. Selecciona:
                                            <ul class="mt-1">
                                                <li><em>Interna:</em> Certificado emitido por el colegio</li>
                                                <li><em>Externa:</em> Certificado emitido por entidad externa</li>
                                            </ul>
                                        </li>
                                        <li><strong>Estado:</strong> Déjalo en "Activo" (por defecto)</li>
                                    </ul>
                                </div>

                            </li>
                            <li class="mb-2">Haz clic en <strong>"Guardar"</strong></li>
                            <li>La nueva unidad aparecerá en la tabla principal</li>
                        </ol>

                        <div class="info-box success mt-3">
                            <strong><i class="bi bi-check-circle me-2"></i>Confirmación</strong>
                            <p class="mb-0">
                                Verás un mensaje verde confirmando que la unidad fue creada exitosamente. La nueva unidad aparecerá en la lista ordenada alfabéticamente por título.
                            </p>
                        </div>
                    </div>

                    <!-- VER LISTADO -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">2</span>
                            Consultar el catálogo de unidades formativas
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>La tabla muestra la siguiente información:</strong></p>
                        <ul>
                            <li><strong>#:</strong> Número de orden</li>
                            <li><strong>Título:</strong> Nombre de la unidad formativa</li>
                            <li><strong>Eje:</strong> Categoría temática a la que pertenece</li>
                            <li><strong>Modalidad:</strong> Formato de entrega (Presencial, Virtual, etc.)</li>
                            <li><strong>Duración:</strong> Horas totales (si se especificó)</li>
                            <li><strong>Prioridad:</strong> Badge rojo (Alta), amarillo (Media), azul (Baja)</li>
                            <li><strong>Obligatoria:</strong> Badge rojo "Sí" si es para todos, gris "No" si es selectiva</li>
                            <li><strong><i class="bi bi-stars"></i> (Habilidades):</strong> Cantidad de habilidades que desarrolla</li>
                            <li><strong><i class="bi bi-person-video3"></i> (Facilitadores):</strong> Cantidad de facilitadores asignados</li>
                            <li><strong><i class="bi bi-shield-check"></i> (Roles):</strong> Cantidad de roles que la requieren</li>
                            <li><strong>Estado:</strong> Verde si activa, gris si inactiva</li>
                            <li><strong>Acciones:</strong> Botones para editar o cambiar estado</li>
                        </ul>

                        <div class="info-box tip mt-3">
                            <strong><i class="bi bi-lightbulb me-2"></i>Contadores útiles</strong>
                            <p class="mb-0">
                                Los contadores de habilidades, facilitadores y roles te dan una vista rápida de qué tan configurada está cada unidad. Si ves ceros, significa que aún falta asignar esos elementos.
                            </p>
                        </div>
                    </div>

                    <!-- EDITAR UNIDAD -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">3</span>
                            Editar una unidad formativa existente
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Para modificar una unidad:</strong></p>
                        <ol>
                            <li class="mb-2">Ubica la unidad en la tabla</li>
                            <li class="mb-2">En la columna "Acciones", haz clic en el botón azul con icono de lápiz <i class="bi bi-pencil"></i></li>
                            <li class="mb-2">Se abrirá el formulario con todos los datos actuales prellenados en las 3 pestañas</li>
                            <li class="mb-2">Modifica los campos que necesites cambiar navegando entre las pestañas</li>
                            <li class="mb-2">Si la unidad tiene relaciones (habilidades, facilitadores, roles, trabajadores), verás una alerta informativa en la Pestaña 3 mostrando los contadores</li>
                            <li class="mb-2">Haz clic en <strong>"Guardar"</strong></li>
                            <li>Los cambios se aplicarán inmediatamente</li>
                        </ol>

                        <div class="info-box warning mt-3">
                            <strong><i class="bi bi-info-circle me-2"></i>Unidades con relaciones</strong>
                            <p class="mb-0 mt-2">
                                Si la unidad tiene habilidades, facilitadores, roles o trabajadores asignados, verás una alerta con los contadores. Ten cuidado al modificar información fundamental como el título o los criterios de cumplimiento.
                            </p>
                        </div>
                    </div>

                    <!-- CAMBIAR ESTADO -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">4</span>
                            Activar o desactivar una unidad formativa
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Para cambiar el estado:</strong></p>
                        <ol>
                            <li class="mb-2">Ubica la unidad en la tabla</li>
                            <li class="mb-2">En la columna "Acciones", observa el segundo botón:
                                <ul class="mt-2">
                                    <li>Si está activa: icono amarillo <i class="bi bi-toggle-on"></i> (desactivar)</li>
                                    <li>Si está inactiva: icono verde <i class="bi bi-toggle-off"></i> (activar)</li>
                                </ul>
                            </li>
                            <li class="mb-2">Haz clic en el botón correspondiente</li>
                            <li class="mb-2">Confirma la acción</li>
                            <li>El estado cambiará inmediatamente</li>
                        </ol>

                        <div class="info-box important mt-3">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Efecto de desactivar una unidad</strong>
                            <p class="mb-2 mt-2">
                                Cuando desactivas una unidad formativa:
                            </p>
                            <ul class="mb-0">
                                <li>Ya NO estará disponible para asignar a nuevos trabajadores</li>
                                <li>Los trabajadores que ya la tienen asignada NO se ven afectados</li>
                                <li>Permanece en la base de datos y puede reactivarse</li>
                                <li>Útil para unidades que temporalmente no se ofrecen</li>
                            </ul>
                        </div>
                    </div>

                    <!-- CAMPOS ESPECIALES -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">5</span>
                            Entender campos especiales
                        </h5>
                        
                        <div class="mt-3 mb-3">
                            <h6 class="text-danger"><i class="bi bi-exclamation-circle me-2"></i>¿Es obligatoria para todos?</h6>
                            <p class="mb-2">
                                Este checkbox define si la unidad debe ser asignada automáticamente a TODOS los trabajadores, independientemente de su rol.
                            </p>
                            <p class="mb-1"><strong>Cuándo marcar:</strong></p>
                            <ul>
                                <li>Capacitaciones de seguridad obligatorias para todo el personal</li>
                                <li>Formación en protección de datos (Habeas Data)</li>
                                <li>Inducción institucional</li>
                                <li>Cualquier requisito legal universal</li>
                            </ul>
                            <p class="mb-1 mt-2"><strong>Cuándo NO marcar:</strong></p>
                            <ul>
                                <li>Capacitaciones específicas de un rol (solo docentes, solo administrativos, etc.)</li>
                                <li>Formación especializada (IB solo para docentes IB)</li>
                                <li>Capacitaciones opcionales o electivas</li>
                            </ul>
                        </div>

                        <div class="mt-3 mb-3">
                            <h6 class="text-info"><i class="bi bi-award me-2"></i>¿Otorga certificación?</h6>
                            <p class="mb-2">
                                Marca este checkbox si al completar la unidad se entrega un certificado.
                            </p>
                            <p class="mb-1"><strong>Tipos de certificación:</strong></p>
                            <ul>
                                <li><strong>Interna:</strong> Certificado emitido por el colegio mismo (ej: certificado de asistencia a taller institucional)</li>
                                <li><strong>Externa:</strong> Certificado emitido por entidad externa (ej: certificación IB, certificado de curso externo)</li>
                            </ul>
                        </div>

                        <div class="mt-3">
                            <h6 class="text-warning"><i class="bi bi-flag me-2"></i>Prioridad</h6>
                            <p class="mb-2">
                                Define la urgencia o importancia de la capacitación:
                            </p>
                            <ul>
                                <li><strong>Alta:</strong> Requisito legal, obligatorio inmediato, crucial para operación</li>
                                <li><strong>Media:</strong> Importante pero no urgente, recomendado a corto plazo</li>
                                <li><strong>Baja:</strong> Complementaria, desarrollo opcional, largo plazo</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 5: SOLUCIÓN DE PROBLEMAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-question-circle me-2"></i>
                        Solución de problemas comunes
                    </h2>

                    <div class="step-card">
                        <h5 class="text-danger mb-3"><i class="bi bi-exclamation-triangle me-2"></i>No puedo seleccionar un eje formativo o modalidad</h5>
                        <p><strong>Causa probable:</strong></p>
                        <p>No hay ejes formativos o modalidades activos creados en el sistema.</p>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>Primero debes crear al menos un eje formativo activo</li>
                            <li>Primero debes crear al menos una modalidad activa</li>
                            <li>Solo los ejes y modalidades activos aparecen en los dropdowns</li>
                            <li>Si existen pero no aparecen, verifica que estén en estado "Activo"</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="text-warning mb-3"><i class="bi bi-exclamation-triangle me-2"></i>El campo de tipo de certificación no aparece</h5>
                        <p><strong>Causa:</strong></p>
                        <p>No has marcado el checkbox "¿Esta unidad otorga certificación?"</p>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>Ve a la Pestaña 3: Certificación y Estado</li>
                            <li>Marca el checkbox "¿Esta unidad otorga certificación?"</li>
                            <li>Automáticamente aparecerá el campo "Tipo de Certificación"</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="text-danger mb-3"><i class="bi bi-exclamation-triangle me-2"></i>Los contadores no se actualizan</h5>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>Haz clic en el botón "Actualizar" en la parte superior</li>
                            <li>Los contadores se recalculan cada vez que cargas la página</li>
                            <li>Si acabas de asignar habilidades, facilitadores o roles, actualiza la página</li>
                            <li>Si el problema persiste, recarga completamente (F5)</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="text-warning mb-3"><i class="bi bi-exclamation-triangle me-2"></i>No sé qué poner en "Criterios de Cumplimiento"</h5>
                        <p><strong>Ejemplos según modalidad:</strong></p>
                        <ul>
                            <li><strong>Presencial/Taller:</strong> "Asistencia mínima del 80% y participación activa"</li>
                            <li><strong>Virtual Sincrónica:</strong> "Asistencia a todas las sesiones y entrega de trabajo final"</li>
                            <li><strong>Virtual Asincrónica:</strong> "Completar 100% del curso y aprobar examen final con mínimo 70%"</li>
                            <li><strong>Certificable:</strong> "Aprobar evaluación con mínimo 80% y asistencia completa"</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 6: BUENAS PRÁCTICAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-award me-2"></i>
                        Buenas prácticas
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-check-circle text-success me-2"></i>Al crear unidades formativas</h5>
                        
                        <ul class="custom-list">
                            <li>Usa títulos claros y descriptivos que identifiquen fácilmente la capacitación</li>
                            <li>Completa al menos el Propósito y la Descripción, aunque sean opcionales</li>
                            <li>Define siempre los Criterios de Cumplimiento para evitar ambigüedades</li>
                            <li>Especifica la duración si es conocida (ayuda a la planificación)</li>
                            <li>Asigna la prioridad correcta para organizar el plan formativo</li>
                            <li>Marca "obligatoria para todos" solo cuando realmente aplique a todo el personal</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-diagram-3 text-info me-2"></i>Configuración completa</h5>
                        
                        <p class="mb-2">Una unidad bien configurada debe tener:</p>
                        <ul class="custom-list">
                            <li>Información básica completa (todas las pestañas)</li>
                            <li>Al menos un facilitador asignado (si la modalidad lo requiere)</li>
                            <li>Habilidades asociadas que se desarrollan</li>
                            <li>Roles a los que aplica (si no es obligatoria para todos)</li>
                            <li>Fuente de requisición (para trazabilidad y reportes)</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-shield-check text-warning me-2"></i>Mantenimiento del catálogo</h5>
                        
                        <ul class="custom-list">
                            <li>Revisa periódicamente las unidades activas (¿se siguen ofreciendo?)</li>
                            <li>Desactiva unidades que temporalmente no se ofrecen</li>
                            <li>Actualiza la información si cambian contenidos, facilitadores o metodología</li>
                            <li>No elimines unidades con trabajadores asignados (desactívalas)</li>
                            <li>Verifica que los contadores reflejen la configuración actual</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 7: PREGUNTAS FRECUENTES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-chat-dots me-2"></i>
                        Preguntas frecuentes
                    </h2>

                    <div class="accordion" id="faqAccordion">
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                    ¿Cuáles campos son realmente obligatorios?
                                </button>
                            </h2>
                            <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Solo tres campos son obligatorios: <strong>Título, Eje Formativo y Modalidad</strong>. Todos los demás campos son opcionales, aunque muy recomendados para una gestión efectiva. El sistema te permitirá guardar solo con estos tres campos completos.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                    ¿Para qué sirve el campo Propósito vs Descripción?
                                </button>
                            </h2>
                            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <strong>Propósito:</strong> Es el objetivo o finalidad, el "para qué" (ej: "Desarrollar competencias en evaluación formativa"). <strong>Descripción:</strong> Es el contenido detallado, el "qué se verá" (ej: "Módulo 1: Fundamentos de evaluación formativa. Módulo 2: Técnicas..."). El propósito es más breve y orientado a resultados; la descripción es más extensa y orientada a contenidos.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                    ¿Cuál es la diferencia entre "obligatoria para todos" y asignar a roles?
                                </button>
                            </h2>
                            <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <strong>"Obligatoria para todos":</strong> TODOS los trabajadores de la institución deben tomarla, sin importar su rol (ej: capacitación en protección de datos). <strong>Asignar a roles:</strong> Solo los trabajadores con ciertos roles específicos deben tomarla (ej: formación IB solo para docentes IB). Usa "obligatoria para todos" solo cuando realmente aplique a todo el personal.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                    ¿Puedo crear una unidad sin asignarle facilitadores o habilidades?
                                </button>
                            </h2>
                            <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Sí, puedes crear la unidad con solo la información básica. Los facilitadores y habilidades se asignan después desde sus respectivas páginas de gestión. Es común crear primero la unidad formativa y luego ir agregando facilitadores, habilidades y roles según se vaya configurando.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                                    ¿Qué pasa si cambio el eje o la modalidad de una unidad con trabajadores asignados?
                                </button>
                            </h2>
                            <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    El cambio se aplicará, pero los trabajadores que ya tienen esta unidad asignada NO se verán afectados en su ruta de formación. Las asignaciones existentes se mantienen. El cambio de eje o modalidad solo afectará la clasificación y características de la unidad para futuras asignaciones.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq6">
                                    ¿Puedo cambiar "obligatoria para todos" después de crear la unidad?
                                </button>
                            </h2>
                            <div id="faq6" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Sí, puedes cambiar este campo en cualquier momento editando la unidad. Sin embargo, ten en cuenta que este cambio puede afectar las asignaciones automáticas. Si cambias de "no obligatoria" a "obligatoria para todos", es posible que necesites sincronizar las asignaciones manualmente.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq7">
                                    ¿Qué significa el contador de "trabajadores con esta unidad en su ruta"?
                                </button>
                            </h2>
                            <div id="faq7" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Este contador muestra cuántos trabajadores tienen actualmente esta unidad formativa asignada en su ruta de formación personal. Es importante porque si desactivas o modificas una unidad con muchos trabajadores asignados, debes considerar el impacto en sus rutas de desarrollo.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq8">
                                    ¿Debo llenar "Método de Evaluación" y "Criterios de Cumplimiento"?
                                </button>
                            </h2>
                            <div id="faq8" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Aunque son opcionales, se recomienda fuertemente completarlos. <strong>Método de Evaluación:</strong> Define cómo se evaluará el aprendizaje. <strong>Criterios de Cumplimiento:</strong> Define qué debe lograr el trabajador para dar por cumplida la unidad. Sin estos campos, puede haber confusión sobre cómo y cuándo marcar la unidad como completada.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq9">
                                    ¿Cuándo debo marcar que la unidad es certificable?
                                </button>
                            </h2>
                            <div id="faq9" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Marca "¿Otorga certificación?" cuando al completar la unidad se entregue un certificado físico o digital que acredite la formación. Luego especifica si es certificación Interna (del colegio) o Externa (de entidad externa). Esto es importante para el seguimiento de credenciales del personal.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq10">
                                    ¿Quién puede gestionar unidades formativas?
                                </button>
                            </h2>
                            <div id="faq10" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Solo los usuarios que tengan el permiso "Gestionar unidades formativas" pueden acceder a esta página y realizar cambios. Este permiso generalmente se asigna a coordinadores de formación, responsables de desarrollo profesional y administradores del sistema. Si necesitas crear una unidad, contacta a estas personas.
                                </div>
                            </div>
                        </div>

                    </div>
                </section>

                <!-- ========================================== -->
                <!-- FIN DEL CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- TARJETA PARA REPORTAR BUGS -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../report-bug.html" class="btn btn-danger btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Formación',
            modulePath: 'training',
            pageTitle: 'Gestionar Unidades Formativas',
            pagePath: 'modules.html',
            moduleDescription: 'CRUD de cursos, talleres y capacitaciones'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            // Actualizar title
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
