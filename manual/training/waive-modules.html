<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- VERSIÓN DE LA PÁGINA -->
    <meta name="page-version" content="26.01.26.44">
    
    <title>Manual - Eximir Cumplimiento de Unidades - SchoolNet</title>
    
    <!-- Bootstrap CSS - VERSIÓN FIJA PROBADA -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-overlay.hidden {
            display: none;
        }
        
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Encabezado discreto */
        .manual-header {
            background: #f8f9fa;
            border-bottom: 2px solid var(--system-primary-color, #1B365D);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        .manual-header h1 {
            font-size: 1.75rem;
            color: var(--system-primary-color, #1B365D);
            margin-bottom: 0.25rem;
        }

        .manual-header .subtitle {
            color: #6c757d;
            font-size: 0.95rem;
        }

        /* Info card */
        .info-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Secciones del manual */
        .section-title {
            color: var(--system-primary-color, #1B365D);
            font-size: 1.5rem;
            margin-top: 2.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e9ecef;
        }

        /* Tarjetas de pasos */
        .step-card {
            background: #f8f9fa;
            border-left: 4px solid var(--system-primary-color, #1B365D);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 1rem;
        }

        /* Cajas de información */
        .info-box {
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin-bottom: 1rem;
        }

        .info-box.warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .info-box.tip {
            background: #d1ecf1;
            border-left: 4px solid #0dcaf0;
        }

        .info-box.important {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .info-box.success {
            background: #d1e7dd;
            border-left: 4px solid #198754;
        }

        /* Listas personalizadas */
        .custom-list {
            list-style: none;
            padding-left: 0;
        }

        .custom-list li {
            padding: 0.5rem 0;
            padding-left: 2rem;
            position: relative;
        }

        .custom-list li::before {
            content: "✓";
            position: absolute;
            left: 0;
            color: var(--system-primary-color, #1B365D);
            font-weight: bold;
            font-size: 1.2rem;
        }

        /* Tarjeta para reportar bugs - USANDO COLOR PRIMARIO PARA MEJOR CONTRASTE */
        .bug-report-card {
            background: var(--system-primary-color, #1B365D);
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-top: 3rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .bug-report-card h5 {
            color: white;
        }

        /* Botón flotante para reportar bugs */
        .floating-bug-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            background: var(--system-primary-color, #1B365D) !important;
            border-color: var(--system-primary-color, #1B365D) !important;
        }

        .floating-bug-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
            opacity: 0.9;
        }

        .icon-large {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        /* Tabla de ejemplo */
        .example-table {
            font-size: 0.9rem;
        }

        .example-table th {
            background: #f8f9fa;
        }
    </style>
</head>

<body>
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <!-- CONTENEDOR PRINCIPAL -->
    <div class="container-fluid">

        <!-- ENCABEZADO DISCRETO -->
        <div class="manual-header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1>
                            <i class="bi bi-book me-2"></i>
                            Manual: Eximir Cumplimiento de Unidades
                        </h1>
                        <p class="subtitle mb-0">Formación - Eximir Cumplimiento de Unidades Formativas</p>
                    </div>
                    <div class="col-md-4 text-md-end mt-3 mt-md-0">
                        <a href="../../modules/training/waive-modules.html" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-1"></i>Volver al Módulo
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- CONTENEDOR DE ALERTAS -->
        <div id="alertContainer"></div>

        <div class="row">
            <div class="col-lg-9 mx-auto">

                <!-- INFORMACIÓN CONTEXTUAL -->
                <div class="info-card">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="text-muted mb-2">Manual de:</h6>
                            <h5 class="mb-1"><strong id="display-module">Formación</strong></h5>
                            <p class="text-muted mb-0 small" id="display-page">Eximir Cumplimiento de Unidades</p>
                        </div>
                        <div class="col-md-6 text-md-end mt-3 mt-md-0">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-1"></i>
                                Si tienes dudas o encuentras algún problema,<br>
                                puedes reportarlo usando el botón de abajo.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- ========================================== -->
                <!-- CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- SECCIÓN 1: ¿QUÉ ES EXIMIR? -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-info-circle me-2"></i>
                        ¿Qué significa Eximir Cumplimiento?
                    </h2>
                    
                    <div class="step-card">
                        <p class="lead mb-3">
                            <strong>Eximir una unidad formativa</strong> significa liberar a un trabajador de la obligación de completarla, aunque esté asignada a su ruta de formación. La unidad pasa al estado "Eximido" y se registra el motivo, quién autorizó la exención y cuándo se hizo.
                        </p>
                        
                        <p>
                            Por ejemplo, si un docente tiene asignada la unidad "Introducción a IB" pero ya tiene certificación IB de otra institución, se puede eximir del cumplimiento de esa unidad específica, documentando la razón en el sistema.
                        </p>

                        <div class="info-box important mt-3">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Advertencia Crítica</strong>
                            <p class="mb-0 mt-2">
                                Eximir una unidad es una decisión seria que debe tomarse con criterio. Cada exención queda registrada permanentemente con tu usuario, fecha y motivo. Usa esta función SOLO cuando haya una razón válida y justificada.
                            </p>
                        </div>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3">¿Cuándo es válido eximir a alguien?</h5>
                        
                        <p class="mb-2"><strong>Razones válidas para eximir:</strong></p>
                        <ul>
                            <li><strong>Conocimiento previo certificado:</strong> El trabajador tiene certificación externa equivalente o superior</li>
                            <li><strong>Experiencia demostrable:</strong> Años de experiencia documentada en el tema (ej: 10+ años enseñando IB)</li>
                            <li><strong>Formación previa reciente:</strong> Completó la misma capacitación en otra institución recientemente</li>
                            <li><strong>Rol temporal o de transición:</strong> El trabajador está en un rol transitorio y pronto cambiará</li>
                            <li><strong>Imposibilidad médica documentada:</strong> Condición de salud que impide completar la capacitación</li>
                            <li><strong>Cambio de políticas institucionales:</strong> La institución decidió que ciertos roles ya no requieren esa capacitación</li>
                        </ul>

                        <p class="mt-3 mb-2"><strong>Razones NO válidas (no eximas por estos motivos):</strong></p>
                        <ul>
                            <li>❌ "No tiene tiempo"</li>
                            <li>❌ "No le interesa el tema"</li>
                            <li>❌ "Ya sabe lo suficiente" (sin documentación)</li>
                            <li>❌ "Está muy ocupado"</li>
                            <li>❌ "Se va a ir de la institución" (sin fecha confirmada)</li>
                            <li>❌ Favoritismos o preferencias personales</li>
                        </ul>

                        <div class="info-box warning mt-3">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Responsabilidad</strong>
                            <p class="mb-0">
                                Como responsable de formación, tú eres quien autoriza o deniega exenciones. Asegúrate de tener documentación que respalde cada decisión (certificados, constancias, aprobación de dirección).
                            </p>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 2: QUÉ SE PUEDE EXIMIR -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-funnel me-2"></i>
                        ¿Qué unidades se pueden eximir?
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3">Reglas del sistema</h5>
                        
                        <p class="mb-2"><strong>SÍ se pueden eximir:</strong></p>
                        <ul class="custom-list">
                            <li>Unidades asignadas <strong>"Por rol"</strong> (asignación automática)</li>
                            <li>Unidades en estado <strong>"Pendiente"</strong></li>
                            <li>Unidades en estado <strong>"En progreso"</strong></li>
                            <li>Unidades en estado <strong>"Vencido"</strong></li>
                            <li>Tanto obligatorias como recomendadas</li>
                        </ul>

                        <p class="mt-3 mb-2"><strong>NO se pueden eximir:</strong></p>
                        <ul>
                            <li><strong>❌ Unidades completadas:</strong> Si ya la completó, no tiene sentido eximir</li>
                            <li><strong>❌ Unidades asignadas "Por interés":</strong> Si se agregó manualmente, simplemente elimínala de la ruta</li>
                            <li><strong>❌ Unidades ya eximidas:</strong> No se puede eximir dos veces</li>
                        </ul>

                        <div class="info-box tip mt-3">
                            <strong><i class="bi bi-lightbulb me-2"></i>¿Por qué solo "Por rol"?</strong>
                            <p class="mb-0">
                                Las unidades "Por rol" son requisitos institucionales basados en el cargo. Las "Por interés" son opcionales/voluntarias. Si una unidad "Por interés" no se debe hacer, simplemente quítala de la ruta del trabajador.
                            </p>
                        </div>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3">Tabla de eximibilidad</h5>
                        
                        <table class="table table-sm table-bordered">
                            <thead>
                                <tr>
                                    <th>Tipo de asignación</th>
                                    <th>Estado</th>
                                    <th>¿Se puede eximir?</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-success">
                                    <td>Por rol</td>
                                    <td>Pendiente</td>
                                    <td><strong>✓ SÍ</strong></td>
                                </tr>
                                <tr class="table-success">
                                    <td>Por rol</td>
                                    <td>En progreso</td>
                                    <td><strong>✓ SÍ</strong></td>
                                </tr>
                                <tr class="table-success">
                                    <td>Por rol</td>
                                    <td>Vencido</td>
                                    <td><strong>✓ SÍ</strong></td>
                                </tr>
                                <tr class="table-danger">
                                    <td>Por rol</td>
                                    <td>Completado</td>
                                    <td><strong>✗ NO</strong> (ya completó)</td>
                                </tr>
                                <tr class="table-danger">
                                    <td>Por interés</td>
                                    <td>Cualquiera</td>
                                    <td><strong>✗ NO</strong> (eliminar mejor)</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </section>

                <!-- SECCIÓN 3: ANTES DE EXIMIR -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-clipboard-check me-2"></i>
                        Antes de eximir una unidad
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3">Verificaciones previas</h5>
                        
                        <ul class="custom-list">
                            <li><strong>Permiso necesario:</strong> Debes tener el permiso "Eximir cumplimiento de unidades" asignado.</li>
                            <li><strong>Justificación clara:</strong> Ten clara la razón válida por la cual se exime.</li>
                            <li><strong>Documentación de respaldo:</strong> Recopila certificados, constancias o aprobaciones que justifiquen la exención.</li>
                            <li><strong>Consulta con supervisor:</strong> Si tienes dudas, consulta con tu supervisor o director académico.</li>
                            <li><strong>Alternativas consideradas:</strong> Piensa si hay opciones mejores que eximir (extender plazo, cambiar modalidad, etc.).</li>
                        </ul>

                        <div class="info-box important mt-3">
                            <strong><i class="bi bi-exclamation-circle me-2"></i>Antes de proceder</strong>
                            <p class="mb-2 mt-2"><strong>Pregúntate:</strong></p>
                            <ul class="mb-0">
                                <li>¿Tengo documentación que respalde esta decisión?</li>
                                <li>¿La razón es institucional y no personal?</li>
                                <li>¿Podré justificar esta exención en una auditoría?</li>
                                <li>¿Hay una alternativa mejor que eximir?</li>
                            </ul>
                        </div>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3">Preparando el motivo</h5>
                        
                        <p class="mb-2"><strong>El campo "Motivo" es obligatorio y debe ser:</strong></p>
                        <ul>
                            <li><strong>Específico:</strong> No escribas "ya sabe", escribe "Certificación IB Categoría 3 obtenida en 2023 en Colegio San José (adjunto)"</li>
                            <li><strong>Documentado:</strong> Referencia a documentos, fechas, instituciones</li>
                            <li><strong>Completo:</strong> Explica el contexto completo en pocas líneas</li>
                            <li><strong>Profesional:</strong> Lenguaje formal y objetivo</li>
                        </ul>

                        <p class="mt-3"><strong>Ejemplo de motivo BIEN escrito:</strong></p>
                        <div class="bg-light p-3 rounded">
                            <em>"Trabajador cuenta con Certificación IB Categoría 3 obtenida en junio 2023 en Colegio Internacional San Patricio (Medellín), con vigencia hasta 2028. Certificado verificado y archivado en expediente personal. Aprobación verbal de Directora Académica el 15/01/2026."</em>
                        </div>

                        <p class="mt-3"><strong>Ejemplo de motivo MAL escrito:</strong></p>
                        <div class="bg-light p-3 rounded text-danger">
                            <em>"Ya tiene experiencia"</em> ❌ (Demasiado vago, no justifica nada)
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 4: GUÍA PASO A PASO -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-list-ol me-2"></i>
                        Guía paso a paso
                    </h2>

                    <!-- BUSCAR TRABAJADOR -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">1</span>
                            Buscar al trabajador
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Para comenzar:</strong></p>
                        <ol>
                            <li class="mb-2">En el campo "Nombre del Trabajador", escribe el nombre o apellido</li>
                            <li class="mb-2">Escribe al menos 3 caracteres para que inicie la búsqueda</li>
                            <li class="mb-2">Aparecerán tarjetas con los trabajadores que coincidan</li>
                            <li class="mb-2">Cada tarjeta muestra:
                                <ul class="mt-2">
                                    <li>Nombre completo del trabajador</li>
                                    <li>Roles laborales asignados</li>
                                </ul>
                            </li>
                            <li>Haz clic en la tarjeta del trabajador correcto</li>
                        </ol>

                        <div class="info-box success mt-3">
                            <strong><i class="bi bi-check-circle me-2"></i>Búsqueda flexible</strong>
                            <p class="mb-0">
                                Puedes buscar por nombre o apellido. El sistema buscará en ambos campos. Por ejemplo, "García" o "Juan" funcionan igual.
                            </p>
                        </div>
                    </div>

                    <!-- VER UNIDADES EXIMIBLES -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">2</span>
                            Revisar unidades eximibles
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Después de seleccionar al trabajador:</strong></p>
                        <ol>
                            <li class="mb-2">Aparecerá un banner azul confirmando el trabajador seleccionado</li>
                            <li class="mb-2">Debajo se mostrará la sección "Unidades Formativas en la Ruta"</li>
                            <li class="mb-2">Verás un mensaje de advertencia en amarillo explicando qué se puede eximir</li>
                            <li class="mb-2">Se listarán SOLO las unidades eximibles (Por rol + Pendiente/En progreso/Vencido)</li>
                            <li>Cada tarjeta de unidad muestra:
                                <ul class="mt-2">
                                    <li>Badge OBLIGATORIA u OPCIONAL (rojo/gris)</li>
                                    <li>Badge de estado: Pendiente / En progreso / Vencido (amarillo/azul/rojo)</li>
                                    <li>Código de la unidad</li>
                                    <li>Título de la unidad</li>
                                    <li>Fecha de asignación</li>
                                    <li>Fecha meta de completitud (si existe)</li>
                                    <li>Botón amarillo "Eximir"</li>
                                </ul>
                            </li>
                        </ol>

                        <div class="info-box tip mt-3">
                            <strong><i class="bi bi-lightbulb me-2"></i>Si no aparecen unidades</strong>
                            <p class="mb-0">
                                Si ves el mensaje "No hay unidades eximibles en la ruta", significa que todas las unidades de este trabajador están completadas o son "Por interés", o no tiene unidades asignadas.
                            </p>
                        </div>
                    </div>

                    <!-- EXIMIR UNIDAD -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">3</span>
                            Eximir una unidad
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Para eximir una unidad específica:</strong></p>
                        <ol>
                            <li class="mb-2">Identifica la unidad que deseas eximir</li>
                            <li class="mb-2">Haz clic en el botón amarillo <strong>"Eximir"</strong> de esa unidad</li>
                            <li class="mb-2">Se abrirá un modal (ventana emergente) de confirmación con:
                                <ul class="mt-2">
                                    <li>Advertencia en amarillo sobre la acción</li>
                                    <li>Código y título de la unidad</li>
                                    <li>Nombre del trabajador</li>
                                    <li>Campo obligatorio "Motivo de la Exención" (textarea grande)</li>
                                    <li>Nota informativa sobre el registro</li>
                                </ul>
                            </li>
                            <li class="mb-2">Escribe el motivo detallado de la exención (obligatorio)</li>
                            <li class="mb-2">Revisa que el motivo sea completo y profesional</li>
                            <li class="mb-2">Haz clic en el botón amarillo <strong>"Confirmar Exención"</strong></li>
                            <li class="mb-2">Aparecerá una confirmación adicional del navegador: "¿Estás seguro de eximir...?"</li>
                            <li class="mb-2">Confirma nuevamente</li>
                            <li>Verás el mensaje: "Unidad eximida exitosamente"</li>
                        </ol>

                        <div class="info-box important mt-3">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Doble confirmación</strong>
                            <p class="mb-0">
                                El sistema pide confirmación DOS veces (modal + navegador) para evitar exenciones accidentales. Lee bien antes de confirmar cada paso.
                            </p>
                        </div>
                    </div>

                    <!-- DESPUÉS DE EXIMIR -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">4</span>
                            Después de eximir
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Qué pasa inmediatamente después:</strong></p>
                        <ul>
                            <li>La unidad desaparece de la lista de eximibles</li>
                            <li>Se actualiza el contador de unidades</li>
                            <li>En la base de datos, la unidad queda con:
                                <ul class="mt-2">
                                    <li><strong>Estado:</strong> "Eximido"</li>
                                    <li><strong>Motivo:</strong> El texto que escribiste</li>
                                    <li><strong>Eximido por:</strong> Tu usuario</li>
                                    <li><strong>Fecha de exención:</strong> Fecha actual</li>
                                </ul>
                            </li>
                            <li>El trabajador ya NO tiene que completar esa unidad</li>
                            <li>La unidad aparecerá en reportes de formación como "Eximida"</li>
                        </ul>

                        <div class="info-box success mt-3">
                            <strong><i class="bi bi-check-circle me-2"></i>Registro permanente</strong>
                            <p class="mb-0">
                                La exención queda registrada permanentemente. No se puede "deseximir" fácilmente. Si fue un error, contacta al administrador del sistema.
                            </p>
                        </div>
                    </div>

                    <!-- CAMBIAR DE TRABAJADOR -->
                    <div class="step-card">
                        <h5>
                            <span class="step-number">5</span>
                            Eximir unidades a otro trabajador
                        </h5>
                        
                        <p class="mt-3 mb-2"><strong>Para cambiar de trabajador:</strong></p>
                        <ol>
                            <li class="mb-2">En el banner azul del trabajador seleccionado, haz clic en el botón <strong>"Cambiar"</strong></li>
                            <li class="mb-2">La selección se limpiará</li>
                            <li class="mb-2">El campo de búsqueda quedará activo nuevamente</li>
                            <li>Busca y selecciona otro trabajador para continuar</li>
                        </ol>
                    </div>
                </section>

                <!-- SECCIÓN 5: RESPONSABILIDADES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-shield-check me-2"></i>
                        Responsabilidades y registro
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-file-text text-primary me-2"></i>Qué se registra en cada exención</h5>
                        
                        <p class="mb-2"><strong>Cada vez que eximes una unidad, el sistema registra:</strong></p>
                        <table class="table table-sm table-bordered mt-3">
                            <thead>
                                <tr>
                                    <th>Campo</th>
                                    <th>Qué se guarda</th>
                                    <th>Para qué sirve</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Motivo</strong></td>
                                    <td>El texto que escribiste</td>
                                    <td>Justificar la decisión en auditorías</td>
                                </tr>
                                <tr>
                                    <td><strong>Eximido por</strong></td>
                                    <td>Tu ID de usuario</td>
                                    <td>Saber quién autorizó la exención</td>
                                </tr>
                                <tr>
                                    <td><strong>Fecha exención</strong></td>
                                    <td>Fecha actual del sistema</td>
                                    <td>Histórico temporal de la decisión</td>
                                </tr>
                                <tr>
                                    <td><strong>Estado</strong></td>
                                    <td>Cambia a "Eximido"</td>
                                    <td>Excluir de reportes de cumplimiento</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="info-box important mt-3">
                            <strong><i class="bi bi-exclamation-circle me-2"></i>Trazabilidad completa</strong>
                            <p class="mb-0">
                                Todo queda registrado para auditorías internas/externas. Si un auditor pregunta "¿Por qué este trabajador no hizo esta capacitación obligatoria?", el sistema tiene la respuesta con tu nombre y motivo.
                            </p>
                        </div>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-person-check text-success me-2"></i>Tus responsabilidades como autorizador</h5>
                        
                        <ul class="custom-list">
                            <li>Verificar que el motivo sea válido y esté documentado</li>
                            <li>Guardar copia de certificados o documentación de respaldo</li>
                            <li>Informar al trabajador de la exención (no lo hace automáticamente el sistema)</li>
                            <li>Actualizar el expediente del trabajador si es necesario</li>
                            <li>Estar preparado para justificar la decisión ante superiores o auditores</li>
                            <li>No eximir por favoritismos, presiones o razones no válidas</li>
                        </ul>

                        <div class="info-box warning mt-3">
                            <strong><i class="bi bi-exclamation-triangle me-2"></i>Consecuencias de mal uso</strong>
                            <p class="mb-0">
                                Eximir indiscriminadamente o sin justificación puede comprometer la calidad formativa de la institución y tu credibilidad profesional. Usa este poder con criterio.
                            </p>
                        </div>
                    </div>
                </section>

                <!-- SECCIÓN 6: BUENAS PRÁCTICAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-award me-2"></i>
                        Buenas prácticas
                    </h2>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-check-circle text-success me-2"></i>Antes de eximir</h5>
                        
                        <ul class="custom-list">
                            <li>Solicita y verifica documentación (certificados, constancias, títulos)</li>
                            <li>Consulta con tu supervisor si tienes dudas sobre la validez del motivo</li>
                            <li>Considera alternativas: ¿puedes extender el plazo en lugar de eximir?</li>
                            <li>Verifica que el trabajador efectivamente tenga el conocimiento/experiencia alegada</li>
                            <li>Archiva copia física o digital de la documentación de respaldo</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-pencil text-primary me-2"></i>Al escribir el motivo</h5>
                        
                        <ul class="custom-list">
                            <li>Sé específico: nombres de instituciones, fechas exactas, números de certificados</li>
                            <li>Usa lenguaje profesional y objetivo</li>
                            <li>Incluye quién aprobó la exención si aplica (ej: "Aprobado por Director Académico")</li>
                            <li>Menciona dónde está archivada la documentación de respaldo</li>
                            <li>Evita abreviaturas confusas o lenguaje informal</li>
                            <li>Escribe pensando que un auditor lo va a leer</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="mb-3"><i class="bi bi-clipboard-data text-info me-2"></i>Después de eximir</h5>
                        
                        <ul class="custom-list">
                            <li>Notifica al trabajador que fue eximido (el sistema no lo hace automáticamente)</li>
                            <li>Actualiza su expediente personal con la documentación</li>
                            <li>Lleva un registro propio (Excel, carpeta) de todas las exenciones que autorizas</li>
                            <li>Revisa periódicamente si las exenciones siguen siendo válidas (ej: certificaciones vencidas)</li>
                            <li>Informa a tu supervisor sobre exenciones de unidades críticas</li>
                        </ul>
                    </div>
                </section>

                <!-- SECCIÓN 7: SOLUCIÓN DE PROBLEMAS -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-question-circle me-2"></i>
                        Solución de problemas comunes
                    </h2>

                    <div class="step-card">
                        <h5 class="text-danger mb-3"><i class="bi bi-exclamation-triangle me-2"></i>No aparecen unidades para eximir</h5>
                        <p><strong>Posibles causas:</strong></p>
                        <ul>
                            <li><strong>Todas están completadas:</strong> Solo se pueden eximir unidades pendientes/en progreso/vencidas</li>
                            <li><strong>Solo tiene unidades "Por interés":</strong> Las unidades asignadas manualmente no se eximen (se eliminan)</li>
                            <li><strong>No tiene unidades asignadas:</strong> El trabajador no tiene ruta de formación</li>
                        </ul>
                        <p><strong>Solución:</strong></p>
                        <p>Verifica la ruta completa del trabajador en otro módulo para confirmar qué unidades tiene y en qué estados.</p>
                    </div>

                    <div class="step-card">
                        <h5 class="text-warning mb-3"><i class="bi bi-exclamation-triangle me-2"></i>Eximí por error una unidad</h5>
                        <p><strong>Problema:</strong></p>
                        <p>Confirmaste la exención pero fue un error. Ahora la unidad está marcada como "Eximida".</p>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>NO puedes "deseximir" desde esta página</li>
                            <li>Contacta al administrador del sistema inmediatamente</li>
                            <li>Explica el error y proporciona el nombre del trabajador y la unidad</li>
                            <li>El administrador puede cambiar manualmente el estado en la base de datos</li>
                            <li>Como alternativa, puedes volver a asignar manualmente la unidad "Por interés"</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="text-danger mb-3"><i class="bi bi-exclamation-triangle me-2"></i>Necesito eximir una unidad completada</h5>
                        <p><strong>Escenario:</strong></p>
                        <p>El trabajador completó la unidad pero luego descubriste que tenía certificación previa.</p>
                        <p><strong>Solución:</strong></p>
                        <ul>
                            <li>El sistema NO permite eximir unidades completadas</li>
                            <li>Esto es correcto: si ya la completó, no hay nada que eximir</li>
                            <li>La unidad completada no perjudica al trabajador, solo sumó formación</li>
                            <li>Si es crítico documentar la duplicidad, agrega una nota en el expediente del trabajador</li>
                        </ul>
                    </div>

                    <div class="step-card">
                        <h5 class="text-warning mb-3"><i class="bi bi-exclamation-triangle me-2"></i>Necesito eximir una unidad "Por interés"</h5>
                        <p><strong>Solución:</strong></p>
                        <p>NO uses este módulo. Las unidades "Por interés" se asignaron manualmente y se deben eliminar manualmente:</p>
                        <ol>
                            <li>Ve a la ruta individual del trabajador</li>
                            <li>Busca la unidad asignada "Por interés"</li>
                            <li>Elimínala directamente</li>
                        </ol>
                        <p>No necesitas "eximir" porque no era un requisito del rol.</p>
                    </div>
                </section>

                <!-- SECCIÓN 8: PREGUNTAS FRECUENTES -->
                <section>
                    <h2 class="section-title">
                        <i class="bi bi-chat-dots me-2"></i>
                        Preguntas frecuentes
                    </h2>

                    <div class="accordion" id="faqAccordion">
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                    ¿Se puede "deseximir" una unidad después?
                                </button>
                            </h2>
                            <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    No desde esta página. La exención queda registrada permanentemente. Si necesitas revertir una exención, contacta al administrador del sistema. Él puede cambiar manualmente el estado en la base de datos y agregar una nota explicando la reversión. Por eso es crítico confirmar bien antes de eximir.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                    ¿El trabajador recibe una notificación cuando lo eximo?
                                </button>
                            </h2>
                            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    No automáticamente. El sistema solo actualiza el registro. Es TU responsabilidad informar al trabajador que fue eximido de la unidad. Puedes hacerlo por email, reunión o el medio que uses habitualmente. Explícale por qué fue eximido y qué documentación respaldó la decisión.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                    ¿Las unidades eximidas cuentan como "completadas" en reportes?
                                </button>
                            </h2>
                            <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Depende del reporte. Generalmente, las unidades eximidas se cuentan como "no pendientes" (es decir, el trabajador cumplió con su obligación, aunque de forma diferente). En reportes de cumplimiento, suelen aparecer separadas con estado "Eximido" para distinguirlas de las completadas normalmente. Consulta la documentación de cada reporte específico.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                                    ¿Puedo eximir múltiples unidades a la vez?
                                </button>
                            </h2>
                            <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    No. El sistema requiere que eximas una por una, cada una con su propio motivo específico. Esto es intencional: cada exención debe justificarse individualmente. Si tienes que eximir 5 unidades al mismo trabajador, haz clic en "Eximir" 5 veces, escribiendo el motivo apropiado para cada una.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                                    ¿Qué pasa si el trabajador cambia de rol después de eximirlo?
                                </button>
                            </h2>
                            <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    La exención permanece. Si el trabajador cambia a un nuevo rol que también requiere esa misma unidad, la unidad ya está eximida y NO se volverá a asignar automáticamente. Si en el nuevo rol SÍ debe hacerla (porque la razón original ya no aplica), tendrás que asignársela manualmente como "Por interés" o contactar al administrador para revertir la exención.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq6">
                                    ¿Puedo ver el historial de unidades que he eximido?
                                </button>
                            </h2>
                            <div id="faq6" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Esta página no tiene un reporte de historial. Sin embargo, cada exención queda registrada con tu usuario en la base de datos. El administrador del sistema o el módulo de reportes puede generar un listado de todas las exenciones que autorizaste, filtradas por tu usuario. Consulta con el administrador si necesitas este reporte.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq7">
                                    ¿Hay un límite de cuántas unidades puedo eximir?
                                </button>
                            </h2>
                            <div id="faq7" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    No hay límite técnico. Sin embargo, eximir más del 30-40% de las unidades de un trabajador debería levantar una bandera roja. Si estás eximiendo muchas unidades, pregúntate: ¿este trabajador está en el rol correcto? ¿Los requisitos del rol están bien definidos? Consulta con tu supervisor sobre casos donde necesitas eximir muchas unidades.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq8">
                                    ¿Qué diferencia hay entre "Eximir" y "Eliminar" una unidad de la ruta?
                                </button>
                            </h2>
                            <div id="faq8" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    <strong>Eximir:</strong> Es decir "esta unidad SÍ corresponde al rol, pero este trabajador específico no la hará por razón X". La unidad queda en la ruta con estado "Eximido" para trazabilidad. <strong>Eliminar:</strong> Es quitar completamente la unidad de la ruta (solo aplica para "Por interés"). Usa "Eximir" para requisitos del rol con excepciones justificadas. Usa "Eliminar" para unidades voluntarias que ya no corresponden.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq9">
                                    ¿Necesito guardar evidencia física de la exención?
                                </button>
                            </h2>
                            <div id="faq9" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Sí, altamente recomendado. Guarda copia de los certificados, constancias o aprobaciones que justifican cada exención. Puedes archivarlos físicamente en el expediente del trabajador o digitalmente en una carpeta compartida. En auditorías, te pueden pedir mostrar la documentación que respaldó tus decisiones de exención.
                                </div>
                            </div>
                        </div>

                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq10">
                                    ¿Quién puede eximir unidades formativas?
                                </button>
                            </h2>
                            <div id="faq10" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                <div class="accordion-body">
                                    Solo los usuarios que tengan el permiso "Eximir cumplimiento de unidades" pueden acceder a esta página. Este es un permiso sensible que se asigna típicamente a coordinadores de formación, directores académicos y administradores del sistema. Si necesitas eximir una unidad y no tienes acceso, contacta a estas personas para que lo hagan o te asignen el permiso.
                                </div>
                            </div>
                        </div>

                    </div>
                </section>

                <!-- ========================================== -->
                <!-- FIN DEL CONTENIDO DEL MANUAL -->
                <!-- ========================================== -->

                <!-- TARJETA PARA REPORTAR BUGS -->
                <div class="bug-report-card">
                    <i class="bi bi-bug-fill icon-large"></i>
                    <h4 class="mb-3">¿Encontraste un problema o tienes una sugerencia?</h4>
                    <p class="mb-4">
                        Si experimentaste un error, algo no funciona como esperas, o tienes 
                        una sugerencia para mejorar el sistema, repórtalo aquí.
                    </p>
                    <a href="../report-bug.html" class="btn btn-light btn-lg">
                        <i class="bi bi-exclamation-triangle me-2"></i>Reportar Bug o Problema
                    </a>
                </div>

            </div>
        </div>

    </div>

    <!-- BOTÓN FLOTANTE PARA REPORTAR BUGS -->
    <a href="../report-bug.html" class="btn btn-danger btn-lg floating-bug-button" title="Reportar Bug">
        <i class="bi bi-bug-fill me-2"></i>Reportar Bug
    </a>

    <!-- SCRIPTS - ORDEN CRÍTICO -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>
    
    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;

        // ==========================================
        // CONFIGURACIÓN DE LA PÁGINA
        // ==========================================
        const PAGE_CONFIG = {
            moduleName: 'Formación',
            modulePath: 'training',
            pageTitle: 'Eximir Cumplimiento de Unidades',
            pagePath: 'waive-modules.html',
            moduleDescription: 'Exime trabajadores de capacitaciones con justificación'
        };

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('📖 Iniciando página de manual...');
            
            try {
                // Verificar si existe la función de colores corporativos
                if (typeof loadAndApplyBrandColors === 'function') {
                    await loadAndApplyBrandColors();
                }
                
                // Verificar sesión si la función existe
                if (typeof getStoredSession === 'function') {
                    const session = getStoredSession();
                    if (session && session.user) {
                        currentUser = session.user;
                    }
                }
                
                // Actualizar información en la página
                updatePageInfo();
                
                console.log('✅ Página de manual lista');
                
            } catch (error) {
                console.error('❌ Error inicializando página:', error);
                if (typeof showMessage === 'function') {
                    showMessage('Error al cargar la página: ' + error.message, 'danger');
                }
            }
        });

        // ==========================================
        // ACTUALIZAR INFORMACIÓN DE LA PÁGINA
        // ==========================================
        function updatePageInfo() {
            // Actualizar title
            document.title = `Manual - ${PAGE_CONFIG.moduleName} - ${PAGE_CONFIG.pageTitle} - SchoolNet`;
        }

        // ==========================================
        // UTILIDADES DE LOADING
        // ==========================================
        function showLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.remove('hidden');
            }
        }

        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }

        // ==========================================
        // FUNCIÓN DE MENSAJES
        // ==========================================
        function showMessage(message, type) {
            const alertContainer = document.getElementById('alertContainer');
            if (!alertContainer) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alertDiv);
            
            // Auto-remove después de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

    </script>
</body>
</html>
