<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="page-version" content="26.02.28.19.30">
    <title>Mis Resultados - Evaluaci√≥n Docente - SchoolNet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: flex; justify-content: center;
            align-items: center; z-index: 9999;
        }
        .loading-overlay.hidden { display: none; }
        .loading-content {
            background: white; padding: 2rem; border-radius: 8px; text-align: center;
        }
        .spinner {
            border: 3px solid #f3f3f3; border-top: 3px solid #0ea5e9;
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin: 0 auto 1rem;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .results-card {
            border: none; border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        .summary-big {
            font-size: 2.5rem; font-weight: 700; line-height: 1;
        }
        .summary-label {
            font-size: 0.85rem; color: #6c757d;
        }

        .nav-tabs .nav-link {
            font-size: 0.85rem; font-weight: 500; color: #6c757d;
        }
        .nav-tabs .nav-link.active {
            color: #0ea5e9; border-bottom: 2px solid #0ea5e9; font-weight: 600;
        }

        .period-check-container {
            border: 1px solid #dee2e6; border-radius: 8px; padding: 0.75rem;
            max-height: 150px; overflow-y: auto; background: #f8f9fa;
        }

        .table-results th {
            background: #f1f5f9; font-size: 0.8rem;
            text-transform: uppercase; letter-spacing: 0.3px; color: #475569;
        }
        .table-results td {
            font-size: 0.9rem; vertical-align: middle;
        }

        .avg-badge {
            display: inline-block; padding: 0.25rem 0.6rem;
            border-radius: 1rem; font-weight: 600; font-size: 0.85rem;
        }
        .avg-high { background: #d1fae5; color: #065f46; }
        .avg-mid { background: #fef3c7; color: #92400e; }
        .avg-low { background: #fee2e2; color: #991b1b; }

        .comment-card {
            border-left: 3px solid #0ea5e9;
            background: #f8f9fa; border-radius: 0 8px 8px 0;
            padding: 0.75rem 1rem; margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .chart-container {
            position: relative; height: 350px; width: 100%;
        }

        .evolution-table th, .evolution-table td {
            text-align: center; font-size: 0.85rem;
        }

        .empty-tab {
            text-align: center; padding: 2rem; color: #6c757d;
        }
        .empty-tab i {
            font-size: 2.5rem; display: block; margin-bottom: 0.75rem;
        }

        .welcome-banner {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white; border-radius: 12px; padding: 1.5rem;
        }
    </style>
</head>

<body>
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando mis resultados...</p>
        </div>
    </div>

    <div class="container-fluid">
        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="../../dashboard.html"><i class="bi bi-house me-1"></i>Dashboard</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="index.html">Evaluaci√≥n Docente</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Mis Resultados</li>
            </ol>
        </nav>

        <div id="alertContainer"></div>

        <!-- BANNER DE BIENVENIDA -->
        <div class="welcome-banner mb-4">
            <div class="d-flex align-items-center gap-3">
                <i class="bi bi-person-lines-fill" style="font-size: 2.5rem; opacity: 0.8;"></i>
                <div>
                    <h4 class="mb-1" id="welcomeName">Mis Resultados de Evaluaci√≥n</h4>
                    <p class="mb-0 opacity-75">Resultados an√≥nimos de las evaluaciones realizadas por sus estudiantes</p>
                </div>
            </div>
        </div>

        <!-- ALERTA: NO ES PROFESOR -->
        <div id="noWorkerAlert" style="display: none;" class="text-center py-5">
            <i class="bi bi-exclamation-triangle text-warning" style="font-size: 3rem;"></i>
            <h5 class="mt-3">No se encontr√≥ perfil de profesor</h5>
            <p class="text-muted">Su usuario no est√° vinculado a un registro de trabajador. Contacte al administrador.</p>
        </div>

        <!-- CONTENIDO PRINCIPAL -->
        <div id="mainContent" style="display: none;">

            <!-- FILTRO DE PER√çODOS -->
            <div class="card results-card mb-4">
                <div class="card-body">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-8">
                            <label class="form-label fw-bold">Per√≠odos de evaluaci√≥n</label>
                            <div class="period-check-container" id="periodChecks">
                                <small class="text-muted">Cargando per√≠odos...</small>
                            </div>
                            <div class="form-text">Seleccione uno o m√°s para comparar su evoluci√≥n</div>
                        </div>
                        <div class="col-md-4">
                            <button class="btn btn-primary w-100" onclick="consultarMisResultados()" id="btnConsultar">
                                <i class="bi bi-search me-1"></i>Consultar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RESULTADOS -->
            <div id="resultsContent" style="display: none;">

                <!-- TARJETAS DE RESUMEN -->
                <div class="row g-3 mb-4">
                    <div class="col-6 col-lg-3">
                        <div class="card results-card">
                            <div class="card-body text-center">
                                <div class="summary-big text-primary" id="sumAvgGlobal">-</div>
                                <p class="summary-label mb-0">Mi Promedio Global</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-lg-3">
                        <div class="card results-card">
                            <div class="card-body text-center">
                                <div class="summary-big text-success" id="sumTotalEvals">0</div>
                                <p class="summary-label mb-0">Evaluaciones Recibidas</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-lg-3">
                        <div class="card results-card">
                            <div class="card-body text-center">
                                <div class="summary-big text-info" id="sumTotalCourses">0</div>
                                <p class="summary-label mb-0">Cursos que me Evaluaron</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-lg-3">
                        <div class="card results-card">
                            <div class="card-body text-center">
                                <div class="summary-big text-warning" id="sumPeriods">0</div>
                                <p class="summary-label mb-0">Per√≠odos Consultados</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PESTA√ëAS -->
                <div class="card results-card">
                    <div class="card-header bg-white">
                        <ul class="nav nav-tabs card-header-tabs" role="tablist">
                            <li class="nav-item">
                                <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#panel-resumen">
                                    <i class="bi bi-clipboard-data me-1"></i>Resumen
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#panel-secciones">
                                    <i class="bi bi-layout-text-sidebar me-1"></i>Secciones
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#panel-preguntas">
                                    <i class="bi bi-question-circle me-1"></i>Preguntas
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#panel-cursos">
                                    <i class="bi bi-people me-1"></i>Por Curso
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#panel-comentarios">
                                    <i class="bi bi-chat-left-text me-1"></i>Comentarios
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link" data-bs-toggle="tab" data-bs-target="#panel-evolucion">
                                    <i class="bi bi-graph-up me-1"></i>Evoluci√≥n
                                </button>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="panel-resumen" role="tabpanel"></div>
                            <div class="tab-pane fade" id="panel-secciones" role="tabpanel"></div>
                            <div class="tab-pane fade" id="panel-preguntas" role="tabpanel"></div>
                            <div class="tab-pane fade" id="panel-cursos" role="tabpanel"></div>
                            <div class="tab-pane fade" id="panel-comentarios" role="tabpanel"></div>
                            <div class="tab-pane fade" id="panel-evolucion" role="tabpanel"></div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="../../assets/js/config.js"></script>

    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let myWorkerId = null;
        let myWorkerName = '';
        let periodosDisponibles = [];
        let datosResultados = null;
        let chartInstances = {};

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('üîê Validando acceso...');
            try {
                const hasAccess = await validatePageAccess('Mis resultados de evaluaci√≥n');
                if (!hasAccess) return;

                const identified = await identificarProfesor();
                if (!identified) return;

                await cargarPeriodos();

                console.log('‚úÖ P√°gina Mis Resultados inicializada');
            } catch (error) {
                console.error('‚ùå Error inicializando:', error);
                showMessage('Error al cargar la p√°gina: ' + error.message, 'danger');
            }
        });

        // ==========================================
        // IDENTIFICAR PROFESOR (user ‚Üí worker por email)
        // ==========================================
        async function identificarProfesor() {
            try {
                const session = getStoredSession();
                if (!session || !session.user) return false;

                const userMail = session.user.user_mail;

                const workers = await supabaseRequest(
                    `/workers?select=worker_id,worker_first_name,worker_last_name_1,worker_last_name_2&email=eq.${encodeURIComponent(userMail)}&limit=1`
                );

                if (!workers || workers.length === 0) {
                    document.getElementById('noWorkerAlert').style.display = 'block';
                    document.getElementById('mainContent').style.display = 'none';
                    return false;
                }

                const w = workers[0];
                myWorkerId = w.worker_id;
                myWorkerName = `${w.worker_first_name} ${w.worker_last_name_1} ${w.worker_last_name_2 || ''}`.trim();

                document.getElementById('welcomeName').textContent = `Resultados de ${myWorkerName}`;
                document.getElementById('mainContent').style.display = 'block';

                console.log(`‚úÖ Profesor identificado: ${myWorkerName}`);
                return true;

            } catch (error) {
                console.error('‚ùå Error identificando profesor:', error);
                return false;
            }
        }

        // ==========================================
        // CARGAR PER√çODOS DISPONIBLES
        // ==========================================
        async function cargarPeriodos() {
            try {
                periodosDisponibles = await supabaseRequest(
                    '/teval_periods?select=period_id,period_name,period_status,academic_years(year_name)&order=created_at.desc'
                );

                const container = document.getElementById('periodChecks');
                if (periodosDisponibles.length === 0) {
                    container.innerHTML = '<small class="text-muted">No hay per√≠odos disponibles</small>';
                    return;
                }

                let html = '';
                periodosDisponibles.forEach(p => {
                    const yearName = p.academic_years?.year_name || '';
                    const statusIcon = p.period_status === 'open' ? 'üü¢' : '‚ö™';
                    html += `
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="${p.period_id}" id="period-${p.period_id}">
                            <label class="form-check-label" for="period-${p.period_id}">
                                ${statusIcon} ${escapeHtml(p.period_name)} <small class="text-muted">(${yearName})</small>
                            </label>
                        </div>`;
                });
                container.innerHTML = html;

            } catch (error) {
                console.error('‚ùå Error cargando per√≠odos:', error);
            }
        }

        // ==========================================
        // CONSULTAR MIS RESULTADOS
        // ==========================================
        async function consultarMisResultados() {
            const selectedPeriods = Array.from(
                document.querySelectorAll('#periodChecks input[type="checkbox"]:checked')
            ).map(c => c.value);

            if (selectedPeriods.length === 0) {
                showMessage('Seleccione al menos un per√≠odo para consultar', 'warning');
                return;
            }

            const btn = document.getElementById('btnConsultar');
            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Consultando...';

            try {
                document.getElementById('loading-overlay').classList.remove('hidden');

                const periodIds = selectedPeriods.map(id => `"${id}"`).join(',');

                // Sesiones completadas de este profesor
                const sessions = await supabaseRequest(
                    `/teval_sessions?select=session_id,period_id,form_id,student_id,session_status,completed_at,students(course_id,courses(course_name,grade_id,grades(grade_name,section_id,sections(section_name))))&period_id=in.(${periodIds})&worker_id=eq.${myWorkerId}&session_status=eq.completed`
                );

                if (!sessions || sessions.length === 0) {
                    showMessage('No se encontraron evaluaciones completadas en los per√≠odos seleccionados', 'info');
                    document.getElementById('resultsContent').style.display = 'none';
                    return;
                }

                const sessionIds = sessions.map(s => `"${s.session_id}"`).join(',');

                // Respuestas
                const responses = await supabaseRequest(
                    `/teval_responses?select=response_id,session_id,question_id,response_value,response_text,teval_form_questions(question_text,question_type,question_order,form_section_id,teval_form_sections(section_title,section_order,english_only))&session_id=in.(${sessionIds})`
                );

                // Nombres de per√≠odos
                const periodNames = {};
                selectedPeriods.forEach(pid => {
                    const p = periodosDisponibles.find(pp => pp.period_id === pid);
                    if (p) periodNames[pid] = p.period_name;
                });

                // Procesar
                datosResultados = procesarMisDatos(sessions, responses, periodNames, selectedPeriods);

                document.getElementById('resultsContent').style.display = 'block';
                renderizarResumenCards();
                renderizarTabResumen();
                renderizarTabSecciones();
                renderizarTabPreguntas();
                renderizarTabCursos();
                renderizarTabComentarios();
                renderizarTabEvolucion();

                console.log('‚úÖ Mis resultados renderizados');

            } catch (error) {
                console.error('‚ùå Error consultando resultados:', error);
                showMessage('Error al consultar: ' + error.message, 'danger');
            } finally {
                document.getElementById('loading-overlay').classList.add('hidden');
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-search me-1"></i>Consultar';
            }
        }

        // ==========================================
        // PROCESAR MIS DATOS
        // ==========================================
        function procesarMisDatos(sessions, responses, periodNames, periods) {
            const data = {
                periodNames,
                periods,
                sections: {},       // form_section_id -> { title, order, questions }
                byCourse: {},       // course_id -> { name, grade, section, periodData }
                byPeriod: {},       // period_id -> { totalValue, totalCount, sessions }
                comments: [],
                totalSessions: sessions.length
            };

            // Indexar sesiones
            const sessionMap = {};
            sessions.forEach(s => {
                sessionMap[s.session_id] = s;

                // Por per√≠odo
                if (!data.byPeriod[s.period_id]) {
                    data.byPeriod[s.period_id] = { totalValue: 0, totalCount: 0, sessions: 0 };
                }
                data.byPeriod[s.period_id].sessions++;

                // Por curso
                const cid = s.students?.course_id;
                if (cid && !data.byCourse[cid]) {
                    const c = s.students.courses;
                    data.byCourse[cid] = {
                        name: c?.course_name || '-',
                        grade: c?.grades?.grade_name || '-',
                        section: c?.grades?.sections?.section_name || '-',
                        sessions: []
                    };
                }
                if (cid) data.byCourse[cid].sessions.push(s);
            });

            // Procesar respuestas
            responses.forEach(r => {
                const session = sessionMap[r.session_id];
                if (!session) return;

                const q = r.teval_form_questions;
                const sec = q?.teval_form_sections;
                const fsId = q?.form_section_id;

                // Secciones
                if (fsId && !data.sections[fsId]) {
                    data.sections[fsId] = {
                        title: sec?.section_title || '-',
                        order: sec?.section_order || 0,
                        englishOnly: sec?.english_only || false,
                        questions: {}
                    };
                }

                // Preguntas
                if (fsId && q) {
                    if (!data.sections[fsId].questions[r.question_id]) {
                        data.sections[fsId].questions[r.question_id] = {
                            text: q.question_text,
                            type: q.question_type,
                            order: q.question_order,
                            responses: []
                        };
                    }
                    data.sections[fsId].questions[r.question_id].responses.push({
                        value: r.response_value,
                        text: r.response_text,
                        periodId: session.period_id,
                        courseId: session.students?.course_id
                    });
                }

                // Acumular por per√≠odo
                if (r.response_value !== null) {
                    data.byPeriod[session.period_id].totalValue += r.response_value;
                    data.byPeriod[session.period_id].totalCount++;
                }

                // Comentarios
                if (r.response_text && r.response_text.trim()) {
                    data.comments.push({
                        text: r.response_text.trim(),
                        sectionTitle: sec?.section_title || '-',
                        periodId: session.period_id,
                        periodName: periodNames[session.period_id] || '-',
                        courseName: session.students?.courses?.course_name || '-'
                    });
                }
            });

            return data;
        }

        // ==========================================
        // RENDERIZAR TARJETAS DE RESUMEN
        // ==========================================
        function renderizarResumenCards() {
            const d = datosResultados;
            let totalVal = 0, totalCnt = 0;

            Object.values(d.byPeriod).forEach(p => {
                totalVal += p.totalValue;
                totalCnt += p.totalCount;
            });

            const avgGlobal = totalCnt > 0 ? (totalVal / totalCnt).toFixed(2) : '-';
            const totalCourses = Object.keys(d.byCourse).length;

            document.getElementById('sumAvgGlobal').textContent = avgGlobal;
            document.getElementById('sumTotalEvals').textContent = d.totalSessions.toLocaleString('es-CO');
            document.getElementById('sumTotalCourses').textContent = totalCourses;
            document.getElementById('sumPeriods').textContent = d.periods.length;
        }

        // ==========================================
        // PESTA√ëA: RESUMEN (promedio por per√≠odo)
        // ==========================================
        function renderizarTabResumen() {
            const d = datosResultados;
            const panel = document.getElementById('panel-resumen');

            let html = '<h6 class="mb-3"><i class="bi bi-clipboard-data me-1"></i>Mi Promedio por Per√≠odo</h6>';
            html += '<div class="table-responsive"><table class="table table-hover table-results">';
            html += '<thead><tr><th>Per√≠odo</th><th class="text-center">Evaluaciones</th><th class="text-center">Respuestas</th><th class="text-center">Promedio</th></tr></thead><tbody>';

            const periodAvgs = [];

            d.periods.forEach(pid => {
                const p = d.byPeriod[pid];
                const avg = (p && p.totalCount > 0) ? (p.totalValue / p.totalCount).toFixed(2) : null;
                const sessions = p ? p.sessions : 0;
                const count = p ? p.totalCount : 0;
                periodAvgs.push(avg);

                html += `<tr>
                    <td><strong>${escapeHtml(d.periodNames[pid])}</strong></td>
                    <td class="text-center">${sessions}</td>
                    <td class="text-center">${count}</td>
                    <td class="text-center">${avg ? avgBadge(avg) : '-'}</td>
                </tr>`;
            });

            html += '</tbody></table></div>';

            // Variaci√≥n si hay m√°s de un per√≠odo
            if (d.periods.length > 1) {
                const validAvgs = periodAvgs.filter(a => a !== null);
                if (validAvgs.length >= 2) {
                    const first = parseFloat(validAvgs[0]);
                    const last = parseFloat(validAvgs[validAvgs.length - 1]);
                    const diff = (last - first).toFixed(2);
                    const diffNum = parseFloat(diff);
                    const sign = diffNum > 0 ? '+' : '';
                    const colorClass = diffNum > 0 ? 'text-success' : diffNum < 0 ? 'text-danger' : 'text-muted';
                    const icon = diffNum > 0 ? 'bi-arrow-up-circle-fill text-success' : diffNum < 0 ? 'bi-arrow-down-circle-fill text-danger' : 'bi-dash-circle text-muted';

                    html += `
                        <div class="alert alert-light d-flex align-items-center gap-3 mt-3">
                            <i class="bi ${icon} fs-3"></i>
                            <div>
                                <strong class="${colorClass}">Variaci√≥n: ${sign}${diff}</strong>
                                <br><small class="text-muted">Entre ${escapeHtml(d.periodNames[d.periods[0]])} y ${escapeHtml(d.periodNames[d.periods[d.periods.length - 1]])}</small>
                            </div>
                        </div>`;
                }
            }

            // Gr√°fico r√°pido de promedio por per√≠odo
            html += `
                <div class="mt-4">
                    <div class="chart-container" style="height:250px;"><canvas id="chartResumenPeriodos"></canvas></div>
                </div>`;

            panel.innerHTML = html;
            renderizarGraficoResumenPeriodos(periodAvgs);
        }

        function renderizarGraficoResumenPeriodos(periodAvgs) {
            if (chartInstances.resumen) chartInstances.resumen.destroy();

            const ctx = document.getElementById('chartResumenPeriodos');
            if (!ctx) return;

            const d = datosResultados;
            const labels = d.periods.map(pid => d.periodNames[pid]);

            chartInstances.resumen = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Mi Promedio',
                        data: periodAvgs.map(v => v ? parseFloat(v) : null),
                        backgroundColor: periodAvgs.map(v => {
                            if (!v) return '#e5e7eb';
                            const num = parseFloat(v);
                            if (num >= 4) return '#10b981';
                            if (num >= 3) return '#f59e0b';
                            return '#ef4444';
                        }),
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Promedio' } }
                    }
                }
            });
        }

        // ==========================================
        // PESTA√ëA: SECCIONES DEL INSTRUMENTO
        // ==========================================
        function renderizarTabSecciones() {
            const d = datosResultados;
            const panel = document.getElementById('panel-secciones');
            const sectionIds = Object.keys(d.sections);

            if (sectionIds.length === 0) {
                panel.innerHTML = emptyTab('Sin datos de secciones');
                return;
            }

            const sortedSections = sectionIds
                .map(id => ({ id, ...d.sections[id] }))
                .sort((a, b) => a.order - b.order);

            let html = '';

            sortedSections.forEach(sec => {
                const englishBadge = sec.englishOnly
                    ? ' <span class="badge bg-info" style="font-size:0.65rem;"><i class="bi bi-translate me-1"></i>Solo ingl√©s</span>'
                    : '';

                html += `<div class="mb-4 p-3 border rounded">
                    <h6 class="fw-bold">${sec.order}. ${escapeHtml(sec.title)}${englishBadge}</h6>`;

                // Promedio por per√≠odo
                html += '<div class="table-responsive"><table class="table table-sm table-results">';
                html += '<thead><tr><th>Per√≠odo</th><th class="text-center">Respuestas</th><th class="text-center">Promedio</th></tr></thead><tbody>';

                d.periods.forEach(pid => {
                    let totalVal = 0, totalCnt = 0;
                    Object.values(sec.questions).forEach(q => {
                        if (q.type !== 'scale') return;
                        q.responses.forEach(r => {
                            if (r.periodId === pid && r.value !== null) {
                                totalVal += r.value;
                                totalCnt++;
                            }
                        });
                    });
                    const avg = totalCnt > 0 ? (totalVal / totalCnt).toFixed(2) : null;
                    html += `<tr>
                        <td>${escapeHtml(d.periodNames[pid])}</td>
                        <td class="text-center">${totalCnt}</td>
                        <td class="text-center">${avg ? avgBadge(avg) : '-'}</td>
                    </tr>`;
                });

                html += '</tbody></table></div>';

                // Detalle por pregunta
                const sortedQuestions = Object.entries(sec.questions)
                    .map(([qid, q]) => ({ qid, ...q }))
                    .sort((a, b) => a.order - b.order);

                html += '<details class="mt-2"><summary class="text-primary" style="cursor:pointer;font-size:0.85rem;">Ver detalle por pregunta</summary>';
                html += '<div class="table-responsive mt-2"><table class="table table-sm table-results">';
                html += '<thead><tr><th>#</th><th>Pregunta</th><th class="text-center">Tipo</th>';
                d.periods.forEach(pid => {
                    html += `<th class="text-center">${escapeHtml(d.periodNames[pid])}</th>`;
                });
                html += '</tr></thead><tbody>';

                sortedQuestions.forEach(q => {
                    html += `<tr><td>${q.order}</td><td>${escapeHtml(q.text)}</td>`;
                    html += `<td class="text-center"><span class="badge ${q.type === 'scale' ? 'bg-primary' : 'bg-warning text-dark'}">${q.type === 'scale' ? 'Escala' : 'Texto'}</span></td>`;

                    d.periods.forEach(pid => {
                        if (q.type === 'scale') {
                            const vals = q.responses.filter(r => r.periodId === pid && r.value !== null);
                            const avg = vals.length > 0
                                ? (vals.reduce((s, r) => s + r.value, 0) / vals.length).toFixed(2)
                                : null;
                            html += `<td class="text-center">${avg ? avgBadge(avg) : '-'}</td>`;
                        } else {
                            const texts = q.responses.filter(r => r.periodId === pid && r.text);
                            html += `<td class="text-center">${texts.length} comentarios</td>`;
                        }
                    });

                    html += '</tr>';
                });

                html += '</tbody></table></div></details></div>';
            });

            panel.innerHTML = html;
        }

        // ==========================================
        // PESTA√ëA: PREGUNTAS
        // ==========================================
        function renderizarTabPreguntas() {
            const d = datosResultados;
            const panel = document.getElementById('panel-preguntas');

            const allQuestions = [];
            Object.entries(d.sections)
                .sort(([, a], [, b]) => a.order - b.order)
                .forEach(([secId, sec]) => {
                    Object.entries(sec.questions)
                        .map(([qid, q]) => ({ qid, ...q, sectionTitle: sec.title, sectionOrder: sec.order }))
                        .sort((a, b) => a.order - b.order)
                        .forEach(q => allQuestions.push(q));
                });

            const scaleQuestions = allQuestions.filter(q => q.type === 'scale');

            if (scaleQuestions.length === 0) {
                panel.innerHTML = emptyTab('No hay preguntas tipo escala');
                return;
            }

            let html = '<h6 class="mb-3"><i class="bi bi-list-ol me-1"></i>Mis resultados por pregunta</h6>';
            html += '<div class="table-responsive"><table class="table table-hover table-results">';
            html += '<thead><tr><th style="width:5%;">#</th><th style="width:30%;">Pregunta</th><th>Secci√≥n</th>';

            d.periods.forEach(pid => {
                html += `<th class="text-center">${escapeHtml(d.periodNames[pid])}</th>`;
            });

            if (d.periods.length > 1) {
                html += '<th class="text-center">Variaci√≥n</th>';
            }

            html += '</tr></thead><tbody>';

            scaleQuestions.forEach((q, idx) => {
                html += `<tr><td>${idx + 1}</td><td>${escapeHtml(q.text)}</td>`;
                html += `<td><small class="text-muted">${escapeHtml(q.sectionTitle)}</small></td>`;

                const periodAvgs = [];

                d.periods.forEach(pid => {
                    const vals = q.responses.filter(r => r.periodId === pid && r.value !== null);
                    const avg = vals.length > 0
                        ? (vals.reduce((s, r) => s + r.value, 0) / vals.length).toFixed(2)
                        : null;
                    periodAvgs.push(avg);
                    html += `<td class="text-center">${avg ? avgBadge(avg) : '-'}</td>`;
                });

                if (d.periods.length > 1) {
                    const first = periodAvgs.find(v => v !== null);
                    const last = [...periodAvgs].reverse().find(v => v !== null);
                    if (first !== null && last !== null && first !== last) {
                        const diff = (parseFloat(last) - parseFloat(first)).toFixed(2);
                        const diffNum = parseFloat(diff);
                        const icon = diffNum > 0 ? 'bi-arrow-up-circle text-success' : 'bi-arrow-down-circle text-danger';
                        const sign = diffNum > 0 ? '+' : '';
                        html += `<td class="text-center"><i class="bi ${icon} me-1"></i>${sign}${diff}</td>`;
                    } else {
                        html += '<td class="text-center"><span class="text-muted">‚Äî</span></td>';
                    }
                }

                html += '</tr>';
            });

            html += '</tbody></table></div>';
            panel.innerHTML = html;
        }

        // ==========================================
        // PESTA√ëA: POR CURSO
        // ==========================================
        function renderizarTabCursos() {
            const d = datosResultados;
            const panel = document.getElementById('panel-cursos');
            const courseIds = Object.keys(d.byCourse);

            if (courseIds.length === 0) {
                panel.innerHTML = emptyTab('Sin datos de cursos');
                return;
            }

            const courseRows = courseIds.map(cid => {
                const course = d.byCourse[cid];
                const periodData = {};

                d.periods.forEach(pid => {
                    let totalVal = 0, totalCnt = 0, sessionCount = 0;

                    Object.values(d.sections).forEach(sec => {
                        Object.values(sec.questions).forEach(q => {
                            if (q.type !== 'scale') return;
                            q.responses.forEach(r => {
                                if (r.courseId === cid && r.periodId === pid && r.value !== null) {
                                    totalVal += r.value;
                                    totalCnt++;
                                }
                            });
                        });
                    });

                    sessionCount = course.sessions.filter(s => s.period_id === pid).length;
                    periodData[pid] = {
                        avg: totalCnt > 0 ? (totalVal / totalCnt).toFixed(2) : null,
                        sessions: sessionCount
                    };
                });

                let gVal = 0, gCnt = 0;
                Object.values(periodData).forEach(pd => {
                    if (pd.avg !== null) {
                        gVal += parseFloat(pd.avg) * pd.sessions;
                        gCnt += pd.sessions;
                    }
                });

                return {
                    cid, name: course.name, grade: course.grade, section: course.section,
                    periodData,
                    avgGeneral: gCnt > 0 ? (gVal / gCnt).toFixed(2) : null,
                    totalSessions: course.sessions.length
                };
            });

            courseRows.sort((a, b) =>
                a.section.localeCompare(b.section) || a.grade.localeCompare(b.grade) || a.name.localeCompare(b.name)
            );

            let html = '<h6 class="mb-3"><i class="bi bi-people me-1"></i>C√≥mo me eval√∫an por curso</h6>';
            html += '<div class="table-responsive"><table class="table table-hover table-results">';
            html += '<thead><tr><th>Curso</th><th>Grado</th><th>Secci√≥n</th><th class="text-center">Evaluaciones</th>';

            d.periods.forEach(pid => {
                html += `<th class="text-center">${escapeHtml(d.periodNames[pid])}</th>`;
            });

            html += '<th class="text-center">Promedio</th></tr></thead><tbody>';

            courseRows.forEach(row => {
                html += `<tr>
                    <td><strong>${escapeHtml(row.name)}</strong></td>
                    <td>${escapeHtml(row.grade)}</td>
                    <td><small class="text-muted">${escapeHtml(row.section)}</small></td>
                    <td class="text-center">${row.totalSessions}</td>`;

                d.periods.forEach(pid => {
                    const pd = row.periodData[pid];
                    html += `<td class="text-center">${pd && pd.avg ? avgBadge(pd.avg) : '-'}</td>`;
                });

                html += `<td class="text-center">${row.avgGeneral ? avgBadge(row.avgGeneral) : '-'}</td></tr>`;
            });

            html += '</tbody></table></div>';

            // Gr√°fico por curso
            html += `
                <div class="mt-4">
                    <h6 class="mb-3"><i class="bi bi-bar-chart me-1"></i>Comparativo por Curso</h6>
                    <div class="chart-container"><canvas id="chartMisCursos"></canvas></div>
                </div>`;

            panel.innerHTML = html;
            renderizarGraficoMisCursos(courseRows);
        }

        function renderizarGraficoMisCursos(courseRows) {
            if (chartInstances.misCursos) chartInstances.misCursos.destroy();

            const ctx = document.getElementById('chartMisCursos');
            if (!ctx) return;

            const d = datosResultados;
            const labels = courseRows.map(r => r.name);
            const colors = ['#0ea5e9', '#f59e0b', '#10b981', '#ef4444', '#8b5cf6'];

            const datasets = d.periods.map((pid, idx) => ({
                label: d.periodNames[pid],
                data: courseRows.map(r => r.periodData[pid]?.avg ? parseFloat(r.periodData[pid].avg) : null),
                backgroundColor: colors[idx % colors.length],
                borderRadius: 4
            }));

            chartInstances.misCursos = new Chart(ctx, {
                type: 'bar',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Promedio' } }
                    }
                }
            });
        }

        // ==========================================
        // PESTA√ëA: COMENTARIOS
        // ==========================================
        function renderizarTabComentarios() {
            const d = datosResultados;
            const panel = document.getElementById('panel-comentarios');

            if (!d.comments || d.comments.length === 0) {
                panel.innerHTML = emptyTab('No hay comentarios de texto abierto');
                return;
            }

            let html = `
                <div class="row g-3 mb-3">
                    <div class="col-md-4">
                        <select class="form-select form-select-sm" id="filterMyCommentPeriod" onchange="filtrarMisComentarios()">
                            <option value="">Todos los per√≠odos</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select form-select-sm" id="filterMyCommentSection" onchange="filtrarMisComentarios()">
                            <option value="">Todas las secciones</option>
                        </select>
                    </div>
                    <div class="col-md-4 text-end">
                        <small class="text-muted" id="myCommentCount">${d.comments.length} comentarios</small>
                    </div>
                </div>
                <div id="myCommentsContainer"></div>`;

            panel.innerHTML = html;

            // Poblar filtros
            const selectPeriod = document.getElementById('filterMyCommentPeriod');
            d.periods.forEach(pid => {
                selectPeriod.innerHTML += `<option value="${pid}">${escapeHtml(d.periodNames[pid])}</option>`;
            });

            const selectSection = document.getElementById('filterMyCommentSection');
            const sectionTitles = [...new Set(d.comments.map(c => c.sectionTitle))].sort();
            sectionTitles.forEach(title => {
                selectSection.innerHTML += `<option value="${escapeHtml(title)}">${escapeHtml(title)}</option>`;
            });

            filtrarMisComentarios();
        }

        function filtrarMisComentarios() {
            const d = datosResultados;
            const filterPeriod = document.getElementById('filterMyCommentPeriod').value;
            const filterSection = document.getElementById('filterMyCommentSection').value;
            const container = document.getElementById('myCommentsContainer');

            let filtered = d.comments;
            if (filterPeriod) filtered = filtered.filter(c => c.periodId === filterPeriod);
            if (filterSection) filtered = filtered.filter(c => c.sectionTitle === filterSection);

            if (filtered.length === 0) {
                container.innerHTML = '<p class="text-muted text-center py-3">No hay comentarios con los filtros seleccionados</p>';
                document.getElementById('myCommentCount').textContent = '0 comentarios';
                return;
            }

            let html = '';
            filtered.forEach(c => {
                html += `
                    <div class="comment-card">
                        <p class="mb-1">"${escapeHtml(c.text)}"</p>
                        <div class="d-flex gap-3">
                            <small class="text-muted"><i class="bi bi-calendar me-1"></i>${escapeHtml(c.periodName)}</small>
                            <small class="text-muted"><i class="bi bi-layout-text-sidebar me-1"></i>${escapeHtml(c.sectionTitle)}</small>
                            <small class="text-muted"><i class="bi bi-mortarboard me-1"></i>${escapeHtml(c.courseName)}</small>
                        </div>
                    </div>`;
            });

            container.innerHTML = html;
            document.getElementById('myCommentCount').textContent = `${filtered.length} comentarios`;
        }

        // ==========================================
        // PESTA√ëA: EVOLUCI√ìN
        // ==========================================
        function renderizarTabEvolucion() {
            const d = datosResultados;
            const panel = document.getElementById('panel-evolucion');

            if (d.periods.length < 2) {
                panel.innerHTML = emptyTab('Seleccione al menos 2 per√≠odos para ver su evoluci√≥n');
                return;
            }

            let html = '';

            // ---- GR√ÅFICO 1: Evoluci√≥n de mi promedio global ----
            html += `
                <div class="mb-5">
                    <h6 class="mb-3"><i class="bi bi-graph-up me-1"></i>Evoluci√≥n de Mi Promedio Global</h6>
                    <div class="chart-container"><canvas id="chartMiEvolucionGlobal"></canvas></div>
                </div>`;

            // ---- GR√ÅFICO 2: Evoluci√≥n por secci√≥n del instrumento ----
            html += `
                <div class="mb-5">
                    <h6 class="mb-3"><i class="bi bi-graph-up-arrow me-1"></i>Evoluci√≥n por Secci√≥n del Instrumento</h6>
                    <div class="chart-container"><canvas id="chartMiEvolucionSecciones"></canvas></div>
                </div>`;

            // ---- GR√ÅFICO 3: Evoluci√≥n por curso ----
            html += `
                <div class="mb-5">
                    <h6 class="mb-3"><i class="bi bi-people me-1"></i>Evoluci√≥n por Curso</h6>
                    <div class="chart-container"><canvas id="chartMiEvolucionCursos"></canvas></div>
                </div>`;

            // ---- TABLA COMPARATIVA: Secciones del instrumento ----
            html += `
                <div class="mb-4">
                    <h6 class="mb-3"><i class="bi bi-table me-1"></i>Tabla Comparativa por Secci√≥n del Instrumento</h6>
                    <div class="table-responsive"><table class="table table-hover evolution-table">
                    <thead><tr><th class="text-start">Secci√≥n</th>`;

            d.periods.forEach(pid => {
                html += `<th>${escapeHtml(d.periodNames[pid])}</th>`;
            });

            html += '<th>Variaci√≥n</th><th>Tendencia</th></tr></thead><tbody>';

            const sortedSections = Object.entries(d.sections)
                .map(([id, sec]) => ({ id, ...sec }))
                .sort((a, b) => a.order - b.order);

            sortedSections.forEach(sec => {
                html += `<tr><td class="text-start"><strong>${sec.order}. ${escapeHtml(sec.title)}</strong></td>`;

                const avgs = d.periods.map(pid => {
                    let totalVal = 0, totalCnt = 0;
                    Object.values(sec.questions).forEach(q => {
                        if (q.type !== 'scale') return;
                        q.responses.forEach(r => {
                            if (r.periodId === pid && r.value !== null) {
                                totalVal += r.value;
                                totalCnt++;
                            }
                        });
                    });
                    return totalCnt > 0 ? totalVal / totalCnt : null;
                });

                avgs.forEach(avg => {
                    html += `<td>${avg !== null ? avgBadge(avg.toFixed(2)) : '-'}</td>`;
                });

                // Variaci√≥n y tendencia
                const validAvgs = avgs.filter(a => a !== null);
                if (validAvgs.length >= 2) {
                    const first = validAvgs[0];
                    const last = validAvgs[validAvgs.length - 1];
                    const diff = (last - first).toFixed(2);
                    const diffNum = parseFloat(diff);
                    const sign = diffNum > 0 ? '+' : '';
                    const colorClass = diffNum > 0 ? 'text-success' : diffNum < 0 ? 'text-danger' : 'text-muted';

                    html += `<td class="${colorClass} fw-bold">${sign}${diff}</td>`;

                    let trend = '';
                    if (diffNum > 0.3) trend = '<i class="bi bi-arrow-up-circle-fill text-success fs-5"></i>';
                    else if (diffNum > 0) trend = '<i class="bi bi-arrow-up-short text-success fs-5"></i>';
                    else if (diffNum < -0.3) trend = '<i class="bi bi-arrow-down-circle-fill text-danger fs-5"></i>';
                    else if (diffNum < 0) trend = '<i class="bi bi-arrow-down-short text-danger fs-5"></i>';
                    else trend = '<i class="bi bi-dash-circle text-muted fs-5"></i>';

                    html += `<td>${trend}</td>`;
                } else {
                    html += '<td>-</td><td>-</td>';
                }

                html += '</tr>';
            });

            // Fila de promedio global
            html += '<tr class="table-active"><td class="text-start"><strong>Promedio Global</strong></td>';

            const globalAvgs = d.periods.map(pid => {
                const p = d.byPeriod[pid];
                return (p && p.totalCount > 0) ? p.totalValue / p.totalCount : null;
            });

            globalAvgs.forEach(avg => {
                html += `<td><strong>${avg !== null ? avgBadge(avg.toFixed(2)) : '-'}</strong></td>`;
            });

            const validGlobal = globalAvgs.filter(a => a !== null);
            if (validGlobal.length >= 2) {
                const diff = (validGlobal[validGlobal.length - 1] - validGlobal[0]).toFixed(2);
                const diffNum = parseFloat(diff);
                const sign = diffNum > 0 ? '+' : '';
                const colorClass = diffNum > 0 ? 'text-success' : diffNum < 0 ? 'text-danger' : 'text-muted';
                const trend = diffNum > 0 ? '<i class="bi bi-arrow-up-circle-fill text-success fs-5"></i>'
                    : diffNum < 0 ? '<i class="bi bi-arrow-down-circle-fill text-danger fs-5"></i>'
                    : '<i class="bi bi-dash-circle text-muted fs-5"></i>';
                html += `<td class="${colorClass} fw-bold">${sign}${diff}</td><td>${trend}</td>`;
            } else {
                html += '<td>-</td><td>-</td>';
            }

            html += '</tr></tbody></table></div>';

            panel.innerHTML = html;

            // Renderizar gr√°ficos
            renderizarGraficoMiEvolucionGlobal(globalAvgs);
            renderizarGraficoMiEvolucionSecciones(sortedSections);
            renderizarGraficoMiEvolucionCursos();
        }

        // ==========================================
        // GR√ÅFICO: MI EVOLUCI√ìN GLOBAL
        // ==========================================
        function renderizarGraficoMiEvolucionGlobal(globalAvgs) {
            if (chartInstances.miEvolGlobal) chartInstances.miEvolGlobal.destroy();

            const ctx = document.getElementById('chartMiEvolucionGlobal');
            if (!ctx) return;

            const d = datosResultados;
            const labels = d.periods.map(pid => d.periodNames[pid]);

            chartInstances.miEvolGlobal = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        label: 'Mi Promedio Global',
                        data: globalAvgs.map(v => v !== null ? parseFloat(v.toFixed(2)) : null),
                        borderColor: '#0ea5e9',
                        backgroundColor: 'rgba(14, 165, 233, 0.1)',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 6,
                        pointBackgroundColor: '#0ea5e9',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Promedio' } }
                    }
                }
            });
        }

        // ==========================================
        // GR√ÅFICO: MI EVOLUCI√ìN POR SECCI√ìN
        // ==========================================
        function renderizarGraficoMiEvolucionSecciones(sortedSections) {
            if (chartInstances.miEvolSecciones) chartInstances.miEvolSecciones.destroy();

            const ctx = document.getElementById('chartMiEvolucionSecciones');
            if (!ctx) return;

            const d = datosResultados;
            const labels = d.periods.map(pid => d.periodNames[pid]);
            const colors = ['#0ea5e9', '#f59e0b', '#10b981', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];

            const datasets = sortedSections.map((sec, idx) => {
                const data = d.periods.map(pid => {
                    let totalVal = 0, totalCnt = 0;
                    Object.values(sec.questions).forEach(q => {
                        if (q.type !== 'scale') return;
                        q.responses.forEach(r => {
                            if (r.periodId === pid && r.value !== null) {
                                totalVal += r.value;
                                totalCnt++;
                            }
                        });
                    });
                    return totalCnt > 0 ? parseFloat((totalVal / totalCnt).toFixed(2)) : null;
                });

                return {
                    label: sec.title,
                    data,
                    borderColor: colors[idx % colors.length],
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 5,
                    borderWidth: 2
                };
            });

            chartInstances.miEvolSecciones = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Promedio' } }
                    }
                }
            });
        }

        // ==========================================
        // GR√ÅFICO: MI EVOLUCI√ìN POR CURSO
        // ==========================================
        function renderizarGraficoMiEvolucionCursos() {
            if (chartInstances.miEvolCursos) chartInstances.miEvolCursos.destroy();

            const ctx = document.getElementById('chartMiEvolucionCursos');
            if (!ctx) return;

            const d = datosResultados;
            const labels = d.periods.map(pid => d.periodNames[pid]);
            const colors = ['#0ea5e9', '#f59e0b', '#10b981', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];

            const courseIds = Object.keys(d.byCourse);

            const datasets = courseIds.map((cid, idx) => {
                const course = d.byCourse[cid];

                const data = d.periods.map(pid => {
                    let totalVal = 0, totalCnt = 0;
                    Object.values(d.sections).forEach(sec => {
                        Object.values(sec.questions).forEach(q => {
                            if (q.type !== 'scale') return;
                            q.responses.forEach(r => {
                                if (r.courseId === cid && r.periodId === pid && r.value !== null) {
                                    totalVal += r.value;
                                    totalCnt++;
                                }
                            });
                        });
                    });
                    return totalCnt > 0 ? parseFloat((totalVal / totalCnt).toFixed(2)) : null;
                });

                return {
                    label: course.name,
                    data,
                    borderColor: colors[idx % colors.length],
                    backgroundColor: 'transparent',
                    tension: 0.3,
                    pointRadius: 5,
                    borderWidth: 2
                };
            });

            chartInstances.miEvolCursos = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Promedio' } }
                    }
                }
            });
        }

        // ==========================================
        // FUNCIONES UTILITARIAS
        // ==========================================
        function avgBadge(value) {
            const num = parseFloat(value);
            let cls = 'avg-mid';
            if (num >= 4) cls = 'avg-high';
            else if (num < 3) cls = 'avg-low';
            return `<span class="avg-badge ${cls}">${value}</span>`;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function emptyTab(message) {
            return `<div class="empty-tab">
                <i class="bi bi-inbox"></i>
                <p>${message}</p>
            </div>`;
        }

        // ==========================================
        // HACER FUNCIONES DISPONIBLES GLOBALMENTE
        // ==========================================
        window.consultarMisResultados = consultarMisResultados;
        window.filtrarMisComentarios = filtrarMisComentarios;

        console.log('‚úÖ P√°gina Mis Resultados de Evaluaci√≥n Docente cargada');
    </script>
</body>
</html>
