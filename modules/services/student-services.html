<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="page-version" content="26.02.27.12.30">
    <title>Accesos y Servicios Estudiantiles - SchoolNet</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    
    <style>
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .loading-overlay.hidden { display: none; }
        .loading-content { background: white; padding: 2rem; border-radius: 8px; text-align: center; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #0d9488; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .badge-active { background-color: #d1fae5; color: #065f46; }
        .badge-inactive { background-color: #fee2e2; color: #991b1b; }
        .btn-module { background-color: #0d9488; border-color: #0d9488; color: #fff; }
        .btn-module:hover { background-color: #0f766e; border-color: #0f766e; color: #fff; }

        .table th { font-size: 0.85rem; white-space: nowrap; }
        .table td { vertical-align: middle; font-size: 0.9rem; }
        .empty-state { text-align: center; padding: 3rem 1rem; color: #6c757d; }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; display: block; }

        /* Métricas compactas */
        .metric-mini { text-align: center; padding: 0.75rem; }
        .metric-mini .value { font-size: 1.5rem; font-weight: 700; color: #0d9488; line-height: 1; }
        .metric-mini .label { font-size: 0.75rem; color: #6c757d; margin-top: 0.25rem; }

        /* Select inline en tabla */
        .table .form-select-sm { font-size: 0.8rem; padding: 0.2rem 1.8rem 0.2rem 0.5rem; min-width: 150px; }
        .table .form-check-input { width: 1.2em; height: 1.2em; cursor: pointer; }

        /* Feedback visual de guardado */
        .saving { opacity: 0.6; pointer-events: none; }
        .saved-ok td { animation: flashGreen 0.6s ease; }
        .saved-err td { animation: flashRed 0.6s ease; }
        @keyframes flashGreen { 0% { background-color: #d1fae5; } 100% { background-color: transparent; } }
        @keyframes flashRed { 0% { background-color: #fee2e2; } 100% { background-color: transparent; } }

        /* Botón copiar acceso */
        .btn-copy-access { font-size: 0.7rem; padding: 0.1rem 0.35rem; }
    </style>
</head>

<body>
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="loading-content">
            <div class="spinner"></div>
            <p class="mb-0">Cargando...</p>
        </div>
    </div>

    <div class="container-fluid">
        
        <!-- BREADCRUMBS -->
        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="../../dashboard.html"><i class="bi bi-house me-1"></i>Dashboard</a></li>
                <li class="breadcrumb-item"><a href="index.html">Servicios y Eventos</a></li>
                <li class="breadcrumb-item active" aria-current="page">Accesos y Servicios Estudiantiles</li>
            </ol>
        </nav>

        <!-- HEADER -->
        <div class="row mb-4">
            <div class="col">
                <h1 class="h3">
                    <i class="bi bi-person-lines-fill me-2" style="color: #0d9488;"></i>
                    Accesos y Servicios Estudiantiles
                </h1>
                <p class="text-muted">Asignar tipo de acceso (entrada y salida) y servicios de cafetería y refrigerio por estudiante.</p>
            </div>
        </div>

        <div id="alertContainer"></div>

        <!-- FILTROS -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row g-3 align-items-end">
                    <div class="col-12 col-md-4">
                        <label class="form-label fw-semibold">Grado</label>
                        <select class="form-select" id="filtro-grado" onchange="onCambioGrado()">
                            <option value="">Seleccionar grado...</option>
                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <label class="form-label fw-semibold">Curso</label>
                        <select class="form-select" id="filtro-curso" onchange="onCambioCurso()" disabled>
                            <option value="">Seleccionar curso...</option>
                        </select>
                    </div>
                    <div class="col-12 col-md-4">
                        <label class="form-label fw-semibold">Filtrar por</label>
                        <select class="form-select" id="filtro-estado" onchange="aplicarFiltroEstado()">
                            <option value="todos">Todos los estudiantes</option>
                            <option value="sin-acceso-am">Sin acceso mañana</option>
                            <option value="sin-acceso-pm">Sin acceso tarde</option>
                            <option value="cafeteria">Con cafetería</option>
                            <option value="refrigerio">Con refrigerio</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- MÉTRICAS COMPACTAS -->
        <div class="row g-3 mb-4" id="metricas-section" style="display: none;">
            <div class="col-4 col-lg">
                <div class="card"><div class="metric-mini">
                    <div class="value" id="m-total">0</div>
                    <div class="label">Estudiantes</div>
                </div></div>
            </div>
            <div class="col-4 col-lg">
                <div class="card"><div class="metric-mini">
                    <div class="value" id="m-acceso-am">0</div>
                    <div class="label">Acceso mañana</div>
                </div></div>
            </div>
            <div class="col-4 col-lg">
                <div class="card"><div class="metric-mini">
                    <div class="value" id="m-acceso-pm">0</div>
                    <div class="label">Acceso tarde</div>
                </div></div>
            </div>
            <div class="col-6 col-lg">
                <div class="card"><div class="metric-mini">
                    <div class="value" id="m-cafeteria">0</div>
                    <div class="label">Cafetería</div>
                </div></div>
            </div>
            <div class="col-6 col-lg">
                <div class="card"><div class="metric-mini">
                    <div class="value" id="m-refrigerio">0</div>
                    <div class="label">Refrigerio</div>
                </div></div>
            </div>
        </div>

        <!-- ACCIONES MASIVAS -->
        <div class="d-flex gap-2 mb-3 flex-wrap" id="acciones-masivas" style="display: none !important;">
            <button class="btn btn-outline-secondary btn-sm" onclick="abrirModalMasivo('morning')">
                <i class="bi bi-sunrise me-1"></i>Asignar acceso mañana a todos
            </button>
            <button class="btn btn-outline-secondary btn-sm" onclick="abrirModalMasivo('afternoon')">
                <i class="bi bi-sunset me-1"></i>Asignar acceso tarde a todos
            </button>
            <button class="btn btn-outline-secondary btn-sm" onclick="copiarMañanaATarde()">
                <i class="bi bi-arrow-right me-1"></i>Copiar mañana → tarde (todos)
            </button>
        </div>

        <!-- TABLA DE ESTUDIANTES -->
        <div class="card">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Código</th>
                                <th>Estudiante</th>
                                <th>Acceso Mañana</th>
                                <th></th>
                                <th>Acceso Tarde</th>
                                <th class="text-center">Cafetería</th>
                                <th class="text-center">Refrigerio</th>
                            </tr>
                        </thead>
                        <tbody id="tbody-estudiantes">
                            <tr><td colspan="7" class="empty-state"><i class="bi bi-funnel"></i>Selecciona un grado y curso para ver los estudiantes</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div><!-- /container -->

    <!-- ================================================================= -->
    <!-- MODAL ASIGNACIÓN MASIVA -->
    <!-- ================================================================= -->
    <div class="modal fade" id="modal-masivo" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modal-masivo-title">Asignación masiva</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label fw-semibold">Tipo de acceso</label>
                    <select class="form-select" id="masivo-acceso">
                        <option value="">Sin asignar</option>
                    </select>
                    <input type="hidden" id="masivo-momento">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-module btn-sm" onclick="ejecutarAsignacionMasiva()">Aplicar a todos</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../../assets/js/config.js"></script>

    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        let currentUser = null;
        let cacheGrados = [];
        let cacheCursos = [];
        let cacheAccesos = [];
        let cacheEstudiantes = [];
        let modalMasivo;

        // ==========================================
        // INICIALIZACIÓN
        // ==========================================
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                const hasAccess = await validatePageAccess('Accesos y servicios estudiantiles');
                if (!hasAccess) return;

                const session = getStoredSession();
                if (!session || !session.user) {
                    showMessage('Sesión no válida. Redirigiendo...', 'warning');
                    setTimeout(() => window.location.href = '../../login.html', 1500);
                    return;
                }
                currentUser = session.user;

                await inicializarPagina();
            } catch (error) {
                console.error('❌ Error:', error);
                showMessage('Error de validación: ' + error.message, 'danger');
            }
        });

        async function inicializarPagina() {
            try {
                mostrarLoading();

                modalMasivo = new bootstrap.Modal(document.getElementById('modal-masivo'));

                // Cargar catálogos en paralelo
                await Promise.all([
                    cargarGrados(),
                    cargarTiposAcceso()
                ]);

                ocultarLoading();
                console.log('✅ Página de accesos y servicios cargada');
            } catch (error) {
                console.error('❌ Error inicializando:', error);
                showMessage('Error al cargar: ' + error.message, 'danger');
                ocultarLoading();
            }
        }

        // ==========================================
        // CARGA DE CATÁLOGOS
        // ==========================================
        async function cargarGrados() {
            try {
                const data = await supabaseRequest('/grades?select=grade_id,grade_name,grade_order&grade_status=eq.active&order=grade_order.asc.nullslast,grade_name.asc');
                cacheGrados = data || [];
        
                const select = document.getElementById('filtro-grado');
                select.innerHTML = '<option value="">Seleccionar grado...</option>' +
                    cacheGrados.map(g => `<option value="${g.grade_id}">${g.grade_name}</option>`).join('');
            } catch (e) {
                console.error('❌ Error cargando grados:', e);
            }
        }

        
        async function cargarTiposAcceso() {
            try {
                const data = await supabaseRequest('/svc_access_types?select=*&is_active=eq.true&order=display_order.asc.nullslast,access_type_name.asc');
                cacheAccesos = data || [];
            } catch (e) {
                console.error('❌ Error cargando tipos de acceso:', e);
            }
        }

        // ==========================================
        // EVENTOS DE FILTROS
        // ==========================================
        async function onCambioGrado() {
            const gradoId = document.getElementById('filtro-grado').value;
            const selectCurso = document.getElementById('filtro-curso');

            // Resetear curso y tabla
            selectCurso.innerHTML = '<option value="">Seleccionar curso...</option>';
            selectCurso.disabled = true;
            cacheEstudiantes = [];
            renderEstudiantes();
            ocultarMetricasYAcciones();

            if (!gradoId) return;

            try {
                const data = await supabaseRequest('/courses?select=course_id,course_name&grade_id=eq.' + gradoId + '&course_status=eq.active&order=course_name.asc');
                cacheCursos = data || [];

                selectCurso.innerHTML = '<option value="">Seleccionar curso...</option>' +
                    cacheCursos.map(c => `<option value="${c.course_id}">${c.course_name}</option>`).join('');
                selectCurso.disabled = false;
            } catch (e) {
                console.error('❌ Error cargando cursos:', e);
            }
        }

        async function onCambioCurso() {
            const cursoId = document.getElementById('filtro-curso').value;
            cacheEstudiantes = [];
            renderEstudiantes();
            ocultarMetricasYAcciones();

            if (!cursoId) return;

            try {
                mostrarLoading();
                const data = await supabaseRequest('/students?select=student_id,student_code,student_first_name,student_last_name_1,student_last_name_2,morning_access_type_id,afternoon_access_type_id,uses_cafeteria_service,uses_snack_service,student_status(status_description)&course_id=eq.' + cursoId + '&order=student_last_name_1.asc,student_last_name_2.asc');
                cacheEstudiantes = data || [];
                renderEstudiantes();
                actualizarMetricas();
                mostrarMetricasYAcciones();
                ocultarLoading();
            } catch (e) {
                console.error('❌ Error cargando estudiantes:', e);
                showMessage('Error al cargar estudiantes: ' + e.message, 'danger');
                ocultarLoading();
            }
        }

        // ==========================================
        // RENDERIZADO DE TABLA
        // ==========================================
        function renderEstudiantes() {
            const tbody = document.getElementById('tbody-estudiantes');

            if (cacheEstudiantes.length === 0) {
                const cursoId = document.getElementById('filtro-curso').value;
                const msg = cursoId
                    ? '<i class="bi bi-people"></i>No hay estudiantes en este curso'
                    : '<i class="bi bi-funnel"></i>Selecciona un grado y curso para ver los estudiantes';
                tbody.innerHTML = `<tr><td colspan="7" class="empty-state">${msg}</td></tr>`;
                return;
            }

            const optionsAcceso = '<option value="">— Sin asignar —</option>' +
                cacheAccesos.map(a => `<option value="${a.access_type_id}">${a.access_type_name}</option>`).join('');

            tbody.innerHTML = cacheEstudiantes.map(est => {
                const nombre = `${est.student_last_name_1}${est.student_last_name_2 ? ' ' + est.student_last_name_2 : ''}, ${est.student_first_name}`;
                const statusDesc = est.student_status?.status_description || '';
                const statusBadge = statusDesc && statusDesc.toLowerCase() !== 'activo' && statusDesc.toLowerCase() !== 'active'
                    ? ` <span class="badge bg-secondary" style="font-size:0.65rem;">${statusDesc}</span>`
                    : '';

                return `
                <tr id="row-${est.student_id}" data-student-id="${est.student_id}">
                    <td><small class="text-muted">${est.student_code}</small></td>
                    <td><strong>${nombre}</strong>${statusBadge}</td>
                    <td>
                        <select class="form-select form-select-sm" onchange="guardarAccesoIndividual(${est.student_id}, 'morning_access_type_id', this.value)">
                            ${optionsAcceso.replace(`value="${est.morning_access_type_id || ''}"`, `value="${est.morning_access_type_id || ''}" selected`)}
                        </select>
                    </td>
                    <td class="text-center">
                        <button class="btn btn-outline-secondary btn-copy-access" title="Copiar mañana → tarde" onclick="copiarAccesoIndividual(${est.student_id})">
                            <i class="bi bi-arrow-right"></i>
                        </button>
                    </td>
                    <td>
                        <select class="form-select form-select-sm" id="pm-${est.student_id}" onchange="guardarAccesoIndividual(${est.student_id}, 'afternoon_access_type_id', this.value)">
                            ${optionsAcceso.replace(`value="${est.afternoon_access_type_id || ''}"`, `value="${est.afternoon_access_type_id || ''}" selected`)}
                        </select>
                    </td>
                    <td class="text-center">
                        <input class="form-check-input" type="checkbox" ${est.uses_cafeteria_service ? 'checked' : ''} onchange="guardarServicioIndividual(${est.student_id}, 'uses_cafeteria_service', this.checked)">
                    </td>
                    <td class="text-center">
                        <input class="form-check-input" type="checkbox" ${est.uses_snack_service ? 'checked' : ''} onchange="guardarServicioIndividual(${est.student_id}, 'uses_snack_service', this.checked)">
                    </td>
                </tr>`;
            }).join('');

            aplicarFiltroEstado();
        }

        // ==========================================
        // FIX: SELECT CON VALOR CORRECTO
        // ==========================================
        // El replace simple no funciona bien cuando el value es vacío.
        // Usamos un approach post-render para setear los selects.
        function setSelectValues() {
            cacheEstudiantes.forEach(est => {
                const row = document.getElementById('row-' + est.student_id);
                if (!row) return;
                const selects = row.querySelectorAll('select');
                if (selects[0]) selects[0].value = est.morning_access_type_id || '';
                if (selects[1]) selects[1].value = est.afternoon_access_type_id || '';
            });
        }

        // Override renderEstudiantes para llamar setSelectValues después
        const _originalRender = renderEstudiantes;
        renderEstudiantes = function() {
            _originalRender();
            // Setear valores correctos después del render
            setTimeout(setSelectValues, 0);
        };

        // ==========================================
        // GUARDADO INDIVIDUAL — ACCESO
        // ==========================================
        async function guardarAccesoIndividual(studentId, campo, valor) {
            const row = document.getElementById('row-' + studentId);
            row.classList.add('saving');

            const payload = {};
            payload[campo] = valor || null;

            try {
                await supabaseRequest('/students?student_id=eq.' + studentId, { method: 'PATCH', body: JSON.stringify(payload) });

                // Actualizar caché
                const est = cacheEstudiantes.find(e => e.student_id === studentId);
                if (est) est[campo] = valor || null;

                row.classList.remove('saving');
                row.classList.add('saved-ok');
                setTimeout(() => row.classList.remove('saved-ok'), 600);
                actualizarMetricas();
            } catch (err) {
                row.classList.remove('saving');
                row.classList.add('saved-err');
                setTimeout(() => row.classList.remove('saved-err'), 600);
                showMessage('Error al guardar: ' + err.message, 'danger');
            }
        }

        // ==========================================
        // GUARDADO INDIVIDUAL — SERVICIO (BOOLEAN)
        // ==========================================
        async function guardarServicioIndividual(studentId, campo, valor) {
            const row = document.getElementById('row-' + studentId);
            row.classList.add('saving');

            const payload = {};
            payload[campo] = valor;

            try {
                await supabaseRequest('/students?student_id=eq.' + studentId, { method: 'PATCH', body: JSON.stringify(payload) });

                // Actualizar caché
                const est = cacheEstudiantes.find(e => e.student_id === studentId);
                if (est) est[campo] = valor;

                row.classList.remove('saving');
                row.classList.add('saved-ok');
                setTimeout(() => row.classList.remove('saved-ok'), 600);
                actualizarMetricas();
            } catch (err) {
                row.classList.remove('saving');
                row.classList.add('saved-err');
                setTimeout(() => row.classList.remove('saved-err'), 600);
                showMessage('Error al guardar: ' + err.message, 'danger');
            }
        }

        // ==========================================
        // COPIAR ACCESO MAÑANA → TARDE (INDIVIDUAL)
        // ==========================================
        function copiarAccesoIndividual(studentId) {
            const row = document.getElementById('row-' + studentId);
            const selects = row.querySelectorAll('select');
            const valorManana = selects[0].value;
            selects[1].value = valorManana;
            guardarAccesoIndividual(studentId, 'afternoon_access_type_id', valorManana);
        }

        // ==========================================
        // ASIGNACIÓN MASIVA
        // ==========================================
        function abrirModalMasivo(momento) {
            document.getElementById('masivo-momento').value = momento;
            const titulo = momento === 'morning' ? 'Acceso mañana — todos' : 'Acceso tarde — todos';
            document.getElementById('modal-masivo-title').textContent = titulo;

            const select = document.getElementById('masivo-acceso');
            select.innerHTML = '<option value="">— Sin asignar —</option>' +
                cacheAccesos.map(a => `<option value="${a.access_type_id}">${a.access_type_name}</option>`).join('');
            select.value = '';

            modalMasivo.show();
        }

        async function ejecutarAsignacionMasiva() {
            const momento = document.getElementById('masivo-momento').value;
            const valor = document.getElementById('masivo-acceso').value;
            const campo = momento === 'morning' ? 'morning_access_type_id' : 'afternoon_access_type_id';

            modalMasivo.hide();
            mostrarLoading();

            let exitos = 0;
            let errores = 0;

            for (const est of cacheEstudiantes) {
                try {
                    const payload = {};
                    payload[campo] = valor || null;
                    await supabaseRequest('/students?student_id=eq.' + est.student_id, { method: 'PATCH', body: JSON.stringify(payload) });
                    est[campo] = valor || null;
                    exitos++;
                } catch (e) {
                    errores++;
                }
            }

            renderEstudiantes();
            actualizarMetricas();
            ocultarLoading();

            if (errores > 0) {
                showMessage(`Asignación completada: ${exitos} exitosos, ${errores} con error`, 'warning');
            } else {
                showMessage(`Acceso asignado a ${exitos} estudiantes correctamente`, 'success');
            }
        }

        // ==========================================
        // COPIAR MAÑANA → TARDE (TODOS)
        // ==========================================
        async function copiarMañanaATarde() {
            if (cacheEstudiantes.length === 0) return;

            const confirmar = confirm(`¿Copiar el acceso de la mañana al de la tarde para los ${cacheEstudiantes.length} estudiantes?`);
            if (!confirmar) return;

            mostrarLoading();
            let exitos = 0;
            let errores = 0;

            for (const est of cacheEstudiantes) {
                try {
                    const payload = { afternoon_access_type_id: est.morning_access_type_id || null };
                    await supabaseRequest('/students?student_id=eq.' + est.student_id, { method: 'PATCH', body: JSON.stringify(payload) });
                    est.afternoon_access_type_id = est.morning_access_type_id || null;
                    exitos++;
                } catch (e) {
                    errores++;
                }
            }

            renderEstudiantes();
            actualizarMetricas();
            ocultarLoading();

            if (errores > 0) {
                showMessage(`Copiado completado: ${exitos} exitosos, ${errores} con error`, 'warning');
            } else {
                showMessage(`Acceso copiado a ${exitos} estudiantes correctamente`, 'success');
            }
        }

        // ==========================================
        // FILTRO POR ESTADO
        // ==========================================
        function aplicarFiltroEstado() {
            const filtro = document.getElementById('filtro-estado').value;
            const rows = document.querySelectorAll('#tbody-estudiantes tr[data-student-id]');

            rows.forEach(row => {
                const id = parseInt(row.dataset.studentId);
                const est = cacheEstudiantes.find(e => e.student_id === id);
                if (!est) return;

                let visible = true;
                switch (filtro) {
                    case 'sin-acceso-am': visible = !est.morning_access_type_id; break;
                    case 'sin-acceso-pm': visible = !est.afternoon_access_type_id; break;
                    case 'cafeteria': visible = est.uses_cafeteria_service === true; break;
                    case 'refrigerio': visible = est.uses_snack_service === true; break;
                }

                row.style.display = visible ? '' : 'none';
            });
        }

        // ==========================================
        // MÉTRICAS
        // ==========================================
        function actualizarMetricas() {
            const total = cacheEstudiantes.length;
            const am = cacheEstudiantes.filter(e => e.morning_access_type_id).length;
            const pm = cacheEstudiantes.filter(e => e.afternoon_access_type_id).length;
            const caf = cacheEstudiantes.filter(e => e.uses_cafeteria_service).length;
            const ref = cacheEstudiantes.filter(e => e.uses_snack_service).length;

            document.getElementById('m-total').textContent = total;
            document.getElementById('m-acceso-am').textContent = am;
            document.getElementById('m-acceso-pm').textContent = pm;
            document.getElementById('m-cafeteria').textContent = caf;
            document.getElementById('m-refrigerio').textContent = ref;
        }

        function mostrarMetricasYAcciones() {
            document.getElementById('metricas-section').style.display = '';
            document.getElementById('acciones-masivas').style.cssText = '';
        }

        function ocultarMetricasYAcciones() {
            document.getElementById('metricas-section').style.display = 'none';
            document.getElementById('acciones-masivas').style.cssText = 'display: none !important;';
        }

        // ==========================================
        // UTILIDADES
        // ==========================================
        function mostrarLoading() {
            document.getElementById('loading-overlay')?.classList.remove('hidden');
        }

        function ocultarLoading() {
            document.getElementById('loading-overlay')?.classList.add('hidden');
        }

        console.log('✅ Accesos y servicios estudiantiles cargado');
    </script>
</body>
</html>
